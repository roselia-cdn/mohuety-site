webpackJsonp([1],{0:function(t,e){},"3Kqa":function(t,e){},"3fo/":function(t,e){},"4W6u":function(t,e){},"7/bn":function(t,e){},"7zck":function(t,e){},A09j:function(t,e){},BY7X:function(t,e){},ETNL:function(t,e){},HYlc:function(t,e){},JgGX:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("7+uW"),s={name:"App",mounted:function(){this.$Progress.finish()},created:function(){var t=this;this.$Progress.start(),this.$router.beforeEach(function(e,n,a){if(void 0!==e.meta.progress){var s=e.meta.progress;t.$Progress.parseMeta(s)}t.$Progress.start(),a()}),this.$router.afterEach(function(e,n){t.$Progress.finish()})},computed:{isNight:function(){var t=(new Date).getHours();return!(t>6&&t<18)}}},o={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("div",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:this.$route.meta.title,expression:"$route.meta.title"}]}),this._v(" "),e("v-app",{attrs:{dark:this.isNight}},[e("v-content",[e("v-fade-transition",[e("router-view")],1)],1)],1),this._v(" "),e("vue-progress-bar"),this._v(" "),e("go-top-btn")],1)},staticRenderFns:[]};var r=n("VU/8")(s,o,!1,function(t){n("Tq+r")},null,null).exports,i=n("/ocq"),l=n("Dd8w"),c=n.n(l),u={title:"Mohuety",motto:"Do what you want to do, be who you want to be.",apiBase:"https://roselia.moe/blog/api",theme:{primary:"#0288d1",secondary:"#6292E9",accent:"#E08696",error:"#FB5458",warning:"#FE9952",info:"#95CAEE",success:"#61BF99"},roseliaScript:!1,urlPrefix:"/blog"},d=n("d7EF"),v=n.n(d),h=n("Gu7T"),f=n.n(h),p=n("c/Tr"),m=n.n(p),g=n("woOf"),_=n.n(g),w=n("//Fk"),b=n.n(w),y=n("mvHQ"),x=n.n(y),k=n("mtWM"),D=n.n(k).a.create();D.interceptors.request.use(function(t){return de.$Progress.start(),t}),D.interceptors.response.use(function(t){return 200===t.status?de.$Progress.finish():de.$Progress.fail(),t},function(t){return de.$Progress.fail(),b.a.reject(t)});var C,P,T,S=D,$=n("M4fF"),U=n.n($),E={};E.apiBase=u.apiBase,E.getArguments=function(){return this.$route.query},E.setRedirect=function(t){window.sessionStorage.setItem("redirectURL",x()(t||E.getAbsPath()))},E.getRedirect=function(){return JSON.parse(window.sessionStorage.getItem("redirectURL"))},E.cleanRedirect=function(){window.sessionStorage.removeItem("redirectURL")},E.getAbsPath=function(){return window.location.pathname+window.location.search+window.location.hash},E.redirectTo=function(t){Qt.push(t||"./")},E.getLoginData=function(){return window.localStorage.loginData?JSON.parse(window.localStorage.loginData):null},E.setLoginData=function(t){window.localStorage.loginData=x()(t)},E.removeLoginData=function(){return window.localStorage.loginData&&window.localStorage.removeItem("loginData")},E.saveSUToken=function(t){window.sessionStorage.setItem("suToken",t)},E.getSUToken=function(){return window.sessionStorage.getItem("suToken")},E.removeSUToken=function(){window.sessionStorage.removeItem("suToken")},E.getPosts=function(t){return this.fetchJSON(this.apiFor("posts")).then(t)},E.refreshToken=function(t){if(!t){var e=E.getLoginData();t=e&&e.rftoken}return t?E.fetchJSON(E.apiFor("login","token","refresh"),"POST",{token:t},!1,!1).then(function(t){if(t.success){var e=E.getLoginData();return e&&(e.token=t.token)&&E.setLoginData(e),e}return E.removeLoginData(),b.a.reject(t.msg)}):b.a.reject("No token")},E.getPostsData=function(){return JSON.parse(window.localStorage.postData||"null")},E.deleteDraft=function(){return window.localStorage.removeItem("postDraft")},E.setPosts=function(t){window.localStorage.postData=x()(t)},E.apiFor=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return E.apiBase+"/"+e.join("/")},E.encodeArgs=function(t){return U.a.map(t,function(t,e){return e+"="+t}).join("&")},E.processPosts=function(t){var e=window.localStorage.postData;return e?t(JSON.parse(e)):E.getPosts(t),!1},E.ajaxPromised=function(t){return S(t).then(function(t){return t.data})},E.fetchJSON=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=this.getLoginData(),r=o?o.token:"";e=e.toUpperCase(),s&&(n.__timestamp=(new Date).getTime());var i=a?_()({},n,{token:r}):n;return"GET"===e&&(i={params:i}),S[e.toLowerCase()](t,i).then(function(t){return t.data}).catch(function(t){return b.a.reject(t)})},E.fetchJSONWithSuccess=function(){return this.fetchJSON.apply(this,arguments).then(function(t){return t.success?t.result||t.data:b.a.reject(t.msg)})},C=function(t){var e=m()(document.querySelectorAll(t));return{css:function(t){return e.forEach(function(e){U.a.map(t,function(t,n){e.style[n]=t})}),this}}},E.colorUtils={splitRGB:function(t){return t.match(/\d+/g)},getYIQ:function(t){var e=this.splitRGB(t);return(299*e[0]+587*e[1]+114*e[2])/1e3},getNormalizedTextColor:function(t,e,n){return this.getYIQ(t)>=128?n:e},apply:function(t){var e=U.a.extend({},{changeText:!1,textColors:{light:"#fff",dark:"#000"},exclude:["rgb(0,0,0)"],target:"body",text:null},t),n=document.querySelector(e.selector),a=this;this.RGBaster.colors(n,{paletteSize:20,exclude:e.exclude,success:function(t){var n=a.splitRGB(t.dominant)?t.dominant:t.palette.find(function(t){return a.splitRGB(t)})||"rgb(255,255,255)";C(e.target).css({transition:"background-color 1800ms ease"}).css({backgroundColor:n}),e.changeText&&C(e.text||e.target).css({transition:"color 1800ms ease"}).css({color:a.getNormalizedTextColor(n,e.textColors.light,e.textColors.dark)})}})}},
//! function(n){"use strict";var t=function(){return document.createElement("canvas").getContext("2d")},e=function(n,e){var a=new Image,o=n||n.src;"data:"!==o.substring(0,5)&&(a.crossOrigin="Anonymous"),a.onload=function(){var n=t("2d");n.drawImage(a,0,0);var o=n.getImageData(0,0,a.width,a.height);e&&e(o.data)},a.src=o},a=function(n){return["rgb(",n,")"].join("")},o=function(n){return n.map(function(n){return a(n.name)})},r=5,i=10,c={};c.colors=function(n,t){t=t||{};var c=t.exclude||[],u=t.paletteSize||i;e(n,function(e){for(var i=n.width*n.height||e.length,m={},s="",d=[],f={dominant:{name:"",count:0},palette:Array.apply(null,new Array(u)).map(Boolean).map(function(){return{name:"0,0,0",count:0}})},l=0;i>l;){if(d[0]=e[l],d[1]=e[l+1],d[2]=e[l+2],s=d.join(","),m[s]=s in m?m[s]+1:1,-1===c.indexOf(a(s))){var g=m[s];g>f.dominant.count?(f.dominant.name=s,f.dominant.count=g):f.palette.some(function(n){return g>n.count?(n.name=s,n.count=g,!0):void 0})}l+=4*r}if(t.success){var p=o(f.palette);t.success({dominant:a(f.dominant.name),secondary:p[0],palette:p})}})},n.RGBaster=n.RGBaster||c}(utils.colorUtils);
function(t){var e=function(t,e){var n=new Image,a=t.src||t;"data:"!==a.substring(0,5)&&(n.crossOrigin="Anonymous"),n.onload=function(){var t,a,s,o=(t=n.width,a=n.height,(s=document.createElement("canvas")).setAttribute("width",t),s.setAttribute("height",a),s.getContext("2d"));o.drawImage(n,0,0);var r=o.getImageData(0,0,n.width,n.height);e&&e(r.data)},n.src=a},n=function(t){return["rgb(",t,")"].join("")},a=function(t,e){return{name:n(t),count:e}},s={};s.colors=function(t,s){var o=(s=s||{}).exclude||[],r=s.paletteSize||10;e(t,function(t){for(var e={},i="",l=[],c=0;c<t.length;c+=4)l[0]=t[c],l[1]=t[c+1],l[2]=t[c+2],i=l.join(","),-1===l.indexOf(void 0)&&0!==t[c+3]&&-1===o.indexOf(n(i))&&(e[i]=i in e?e[i]+1:1);if(s.success){var u=function(t,e){if(t.length>e)return t.slice(0,e);for(var n=t.length-1;n<e-1;n++)t.push(a("0,0,0",0));return t}(function(t){var e=[];for(var n in t)e.push(a(n,t[n]));return e.sort(function(t,e){return e.count-t.count}),e}(e),r+1);s.success({dominant:u[0].name,secondary:u[1].name,palette:u.map(function(t){return t.name}).slice(1)})}})},t.RGBaster=s}(E.colorUtils),E.debounce=function(t,e){var n=void 0;return function(){for(var a=arguments.length,s=Array(a),o=0;o<a;o++)s[o]=arguments[o];clearTimeout(n),n=setTimeout(function(){return t.apply(void 0,s)},e)}},E.throttle=function(t,e){var n=0,a=void 0;return function(){for(var s=arguments.length,o=Array(s),r=0;r<s;r++)o[r]=arguments[r];var i=new Date;clearTimeout(a),i-n<e?a=setTimeout(function(){return t.apply(void 0,o)},e):(n=i,t.apply(void 0,o))}},E.LazyLoad=(P={extend:U.a.extend,deepExtend:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.extend.apply(this,[!0].concat(f()(e)))},render:E.render,partition:function(t,e){var n=[[],[]];return t.forEach(function(t){return n[1^e(t)].push(t)}),n},debounce:E.debounce,throttle:E.throttle},(T=function(t){var e={load:!0,placeHolder:"",renderPlaceHolder:!1,selector:"#content img",changePlaceHolder:!0,prefix:"roselia",onscrolledimg:null,delim:["{{","}}"],backupSrc:!0,throttleRate:500};this.alive=!1;var n=this.options=P.deepExtend({},e,t);this.setOption=function(n){return this.options=P.deepExtend({},e,t),this},this.load=function(){this.alive&&this.destroy(),this.alive=!0,this.pics=m()(document.querySelectorAll(n.selector)),this.options.changePlaceHolder&&this.pics.forEach(function(t){var e=n.prefix+"-src";n.backupSrc&&t.setAttribute(e,t.src),t.src=n.changePlaceHolder?P.render(n.placeHolder,t,n.delim):n.placeHolder}),this.handler(),addEventListener("scroll",this.handler)},this.handler=P.throttle(function(t){var e=this,n=document.documentElement.scrollTop+window.innerHeight;return new b.a(function(t){t(P.partition(e.pics,function(t){return n>=t.y}))}).then(function(t){var n=v()(t,2),a=n[0],s=n[1];return a.forEach(function(t){t.src=t.getAttribute(e.options.prefix+"-src")||t.src}),e.pics=s,s}).then(function(t){return t.length||e.destroy(),t}).then(function(t){return e.options.onscrolledimg&&e.options.onscrolledimg(t)})}.bind(this),n.throttleRate),this.destroy=function(){this.alive=!1,removeEventListener("scroll",this.handler)},this.options.load&&this.load()}).of=function(t){return new T(t)},T.utils=P,T),E.setUpEvents=function(t,e){(t=t||this).hooks=t.hooks||{},t.events=e&&e.map(function(t){return t.toLowerCase()})||["load","unload","render"],["on","once"].forEach(function(e,n){t[e]=function(t,e){for(var a=arguments.length,s=Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return this.hooks=this.hooks||{},this.hooks[t]=this.hooks[t]||[],this.hooks[t].push({f:e,args:s,once:n>0})}}),t.remove=function(t,e){this.hooks[t]&&this.hooks[t].splice(e,1)},t.trigger=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];this.hooks&&this.hooks[t]&&(this.hooks[t].forEach(function(t){return t&&t.f&&t.f.apply(t,f()(t.args).concat(n))}),this.hooks[t]=this.hooks[t].filter(function(t){return!t.once}))},["on","once","trigger","remove"].forEach(function(e){return t.events.forEach(function(n){t[e+n.replace(/\b\w/g,function(t){return t.toUpperCase()})]=function(a){for(var s,o=arguments.length,r=Array(o>1?o-1:0),i=1;i<o;i++)r[i-1]=arguments[i];return(s=t)[e].apply(s,[n,a].concat(r))}})}),Qt.afterEach(function(){return t.trigger("unload")})},E.showToast=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.toast.show=!1,this.toast.text=t.toString(),this.toast.color=e,this.toast.show=!0},E.getToastOption=function(){return{show:!1,text:"",color:""}};var L=E,R={name:"HelloWorld",data:function(){return{title:u.title,motto:u.motto,loading:!0,isFirstRun:!1}},methods:{getFirstRunData:function(){var t=this;L.fetchJSONWithSuccess(L.apiFor("firstrun")).then(function(e){t.isFirstRun=!0,L.setLoginData(c()({},e,{su_token:void 0})),L.saveSUToken(e.su_token)}).finally(function(e){t.loading=!1})}},mounted:function(){this.getFirstRunData()}},O={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:"","grid-list-md":"","text-xs-center":"","fill-height":""}},[n("v-responsive",[n("v-layout",{attrs:{row:"",wrap:"","justify-center":"","align-center":""}},[n("v-flex",{attrs:{xs12:""}},[n("h3",{staticClass:"display-3"},[t._v("Welcome to "),n("strong",{staticClass:"primary--text"},[t._v(t._s(t.title))])]),t._v(" "),n("span",{staticClass:"subheading"},[t._v(t._s(t.motto))]),t._v(" "),n("v-divider",{staticClass:"my-3"}),t._v(" "),t.loading?n("div",[n("div",{staticClass:"title mb-3"},[t._v("Please standby...")]),t._v(" "),n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):t.isFirstRun?n("div",[n("div",{staticClass:"title mb-3"},[t._v("Add first user to continue.")]),t._v(" "),n("v-btn",{staticClass:"mx-0",attrs:{color:"primary",large:"",to:{name:"userManagement",params:{firstRun:!0}}}},[t._v("\n            Add user\n          ")])],1):n("div",[n("div",{staticClass:"title mb-3"},[t._v("Great! You are now prepared to "),n("strong",{staticClass:"primary--text"},[t._v(t._s(t.title))])]),t._v(" "),n("v-btn",{staticClass:"mx-0",attrs:{color:"secondary",large:"",to:{name:"index"}}},[t._v("\n            Go to "+t._s(t.title)+"\n          ")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var F=n("VU/8")(R,O,!1,function(t){n("bh+O")},"data-v-508a14b1",null).exports,N={name:"blog-index",data:function(){return{currentPage:0,prevPage:0,nextPage:0,pages:0,userData:L.getLoginData(),toast:L.getToastOption(),posts:[],meta:u,realTitle:"",realSubtitle:""}},methods:{makeDirect:function(t){L.setRedirect(L.getAbsPath()),this.$router.push(t)},getTag:function(){return this.getArguments().tag||null},getArguments:function(){return this.$route.query},getPageOffset:function(t){var e=(parseInt(this.getArguments().page)||1)+t;return e>0&&e<=this.pages?e:-1},shiftPage:function(t){var e=this.getPageOffset(t);-1!==e&&(this.$vuetify.goTo(0),this.$router.push({name:"index",params:{page:e}}))},showToast:L.showToast,changeToast:function(t){this.toast.show=t},getPostsOnContex:function(t){return t=t||this.getArguments(),this.getPosts(t.page,!1,t.tag)},getPosts:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments[2],s={page:t=t||1,limit:6};a?(document.title=this.meta.title+" - Tag: "+a,this.realTitle=a,this.realSubtitle="Posts for tag: "+a,s.tag=a):(this.realTitle="",this.realSubtitle="",document.title=this.meta.title+" - #"+t),L.fetchJSON(L.apiFor("posts"),"GET",s).then(function(a){if(!a.valid&&e.userData&&!n)return L.refreshToken().then(function(n){e.userData=n,e.getPosts(t,!0)}).catch(function(t){e.showToast(t,"warning"),e.userData=null,L.removeLoginData()});e.posts=a.data.map(function(t){return t.deleted=!1,t}),e.pages=parseInt(a.pages),e.currentPage=parseInt(t),e.nextPage=e.getPageOffset(1),e.prevPage=e.getPageOffset(-1),e.$emit("roselia-load")}).catch(function(t){console.log(t)})}},mounted:function(){var t=this;this.getPostsOnContex(),window.addEventListener("storage",function(e){"loginData"===e.key&&(t.userData=L.getLoginData())})},watch:{userData:function(){this.getPosts()}},beforeRouteUpdate:function(t,e,n){this.$vuetify.goTo(0);var a=t.query;this.getPostsOnContex(a),n()}},A={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("nav-bar",{attrs:{userData:t.userData,route:this.$route.fullPath}}),t._v(" "),n("v-parallax",{attrs:{dark:"",src:"static/img/bg_n3.jpg"}},[n("v-layout",{attrs:{"align-center":"",column:"","justify-center":""}},[n("h1",{staticClass:"display-2 font-weight-thin mb-3"},[t._v(t._s(t.realTitle||t.meta.title))]),t._v(" "),n("h4",{staticClass:"subheading"},[t._v(t._s(t.realSubtitle||t.meta.motto))])])],1),t._v(" "),n("v-layout",[n("v-container",{attrs:{fluid:"","grid-list-lg":""}},[n("v-layout",{attrs:{row:"",wrap:""}},t._l(t.posts,function(e){return n("v-flex",{key:e.id,attrs:{xs12:"",sm8:"","offset-sm2":""}},[n("v-card",{attrs:{hover:"",to:{name:"post",params:{p:e.id},query:{p:e.id}}}},[e.img?n("v-img",{attrs:{src:e.img,ripple:"true"}},[n("v-container",{attrs:{"fill-height":"",fluid:""}},[n("v-layout",{attrs:{"align-end":"","fill-height":""}},[n("v-flex",{attrs:{xs12:"","align-end":"",flexbox:""}},t._l(e.tags,function(e){return n("router-link",{key:e,attrs:{to:{name:"index",params:{tag:e},query:{tag:e}}}},[n("v-chip",[t._v(t._s(e))])],1)}))],1)],1)],1):t._e(),t._v(" "),n("v-card-title",{attrs:{"primary-title":""}},[n("div",[n("div",{staticClass:"headline"},[t._v(t._s(e.title))]),t._v(" "),n("span",{staticClass:"grey--text"},[t._v(t._s(e.subtitle))])]),t._v(" "),n("v-spacer"),t._v(" "),n("span",{staticClass:"right"},[t._v(t._s(e.date))])],1),t._v(" "),t.userData&&t.userData.role&&t.userData.role+1>=e.secret?n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{small:"",fab:"",color:"error",to:{name:"edit",query:{post:e.id},params:{deletePost:!0,title:e.title}}}},[n("v-icon",[t._v("delete")])],1),t._v(" "),n("v-btn",{attrs:{small:"",fab:"",color:"primary",to:{name:"edit",query:{post:e.id}}}},[n("v-icon",[t._v("mode_edit")])],1)],1):t._e()],1)],1)}))],1)],1),t._v(" "),n("v-container",[n("v-flex",{attrs:{row:"",xs12:"",sm10:"","offset-sm1":""}},[n("v-layout",[-1!==t.prevPage?n("v-btn",{attrs:{color:"primary",fab:"",small:"",to:{name:"index",query:{page:t.prevPage}}}},[n("v-icon",[t._v("chevron_left")])],1):t._e(),t._v(" "),n("v-spacer"),t._v("\n        "+t._s(t.currentPage)+" / "+t._s(t.pages)+"\n        "),n("v-spacer"),t._v(" "),-1!==t.nextPage?n("v-btn",{attrs:{color:"primary",fab:"",small:"",to:{name:"index",query:{page:t.nextPage}}}},[n("v-icon",[t._v("chevron_right")])],1):t._e()],1)],1)],1),t._v(" "),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1)),t._v(" "),n("blog-footer")],1)},staticRenderFns:[]};var q=n("VU/8")(N,A,!1,function(t){n("7/bn")},"data-v-669b64fe",null).exports,I={data:function(){return{loading:!1,title:u.title,toast:{show:!1,text:"",color:""},username:"",password:"",rules:[function(t){return!!t||"Required"},function(t){return t&&t.length>4&&t.length<20||"Length is not valid"}],valid:!1,loginCode:"",scannedUsername:"",focusAt:!1}},props:{source:String},methods:{login:function(){var t=this;this.valid&&(this.$emit("beforeLogin"),this.loading=!0,L.fetchJSON(L.apiFor("login"),"POST",{username:this.username,password:this.password},!1).then(function(e){if(!e.success)return b.a.reject(e.msg);L.setLoginData({username:t.username,token:e.token,role:e.role,rftoken:e.rftoken}),L.redirectTo(t.redirection)}).catch(function(e){t.showToast(e,"error"),t.loading=!1}))},showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.toast.show=!1,this.toast.text=t.toString(),this.toast.color=e,this.toast.show=!0},changeToast:function(t){this.toast.show=t},cleanUp:function(){L.cleanRedirect(),window.sessionStorage.removeItem("message")},tokenLogin:function(t){var e=this;this.loading=!0,L.fetchJSON(L.apiFor("login","token"),"POST",{token:t},!1).then(function(n){if(!n.success)return b.a.reject(n.msg);L.setLoginData({username:n.payload.username,token:t,role:n.payload.role}),L.redirectTo(e.redirection)}).catch(function(t){e.loading=!1,e.showToast(t,"error")}).finally(this.cleanUp)},getLoginCode:function(){return L.fetchJSON(L.apiFor("login","code","gen")).then(function(t){return t.code})},codeLoginTriggers:function(){var t=this;this.codeChecker=setInterval(function(){t.loginCode&&L.fetchJSON(L.apiFor("login","code",t.loginCode),"POST",{},!1).then(function(e){if(e.success){var n=e.data;n.username&&(t.scannedUsername=n.username),n.token&&(L.setLoginData({username:n.username,role:n.role,token:n.token}),L.redirectTo(t.redirection))}})},3e3),this.codeLoginCleaner=setTimeout(function(){return t.codeLoginCleanUp()},6e4)},codeLogin:function(){var t=this;this.loading=!0,this.loginCode="Loading...",this.getLoginCode().then(function(e){t.loginCode=(Array(6).join("0")+e).slice(-6)}).then(function(e){t.codeLoginTriggers()}).catch(function(e){t.loginCode="Please retry"})},codeLoginCleanUp:function(){this.codeChecker&&clearInterval(this.codeChecker),this.codeLoginCleaner&&clearTimeout(this.codeLoginCleaner),this.loading=!1,this.loginCode="",this.scannedUsername=""},focusPassword:function(){var t=this;this.rules.map(function(e){return e(t.username)}).every(function(t){return!0===t})&&this.$refs.passWord.focus()}},computed:{redirection:function(){return this.$route.params.redirect||this.$route.query.redirect||L.getRedirect()||"/"},message:function(){return window.sessionStorage.getItem("message")||this.$route.params.message||"Login"}},mounted:function(){var t=this;L.getLoginData()&&(this.$route.params.logout?(L.removeLoginData(),this.showToast("Logged out!")):L.redirectTo(this.redirection)),addEventListener("storage",function(e){"loginData"===e.key&&e.newValue&&L.redirectTo(t.redirection)}),L.getArguments.call(this).token&&this.tokenLogin()},destroyed:function(){this.cleanUp(),this.codeLoginCleanUp()}},J={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-layout",{attrs:{"align-center":"","justify-center":""}},[n("v-flex",{attrs:{xs12:"",sm8:"",md4:""}},[n("v-card",{staticClass:"elevation-12"},[n("v-toolbar",{attrs:{dark:"",color:"primary"}},[this.$route.query.ported?n("v-btn",{attrs:{flat:"",fab:"",onclick:"window.self.close()"}},[n("v-icon",[t._v("close")])],1):n("v-btn",{attrs:{flat:"",fab:"",to:"/"}},[n("v-icon",[t._v("arrow_back")])],1),t._v(" "),n("v-toolbar-title",[t._v(t._s(t.title))]),t._v(" "),n("v-spacer")],1),t._v(" "),n("v-card-text",[n("h2",{staticClass:"flex text--secondary"},[t._v(t._s(t.message))]),t._v(" "),t.loading&&!t.loginCode?n("h3",{staticClass:"display-1"},[t._v("Loading...")]):t._e(),t._v(" "),t.loading||t.loginCode?t._e():n("v-form",{model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{"prepend-icon":"person",name:"username",label:"Username",type:"text",autofocus:"",rules:t.rules},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.focusPassword(e):null}},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),t._v(" "),n("v-text-field",{ref:"passWord",attrs:{id:"password","prepend-icon":"lock",name:"password",label:"Password",type:"password",rules:t.rules},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.login(e):null}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1),t._v(" "),t.loginCode?n("v-container",[n("v-layout",{attrs:{"align-center":"","justify-center":""}},[t.scannedUsername?n("div",[n("h6",{staticClass:"display-1"},[t._v("Welcome, please confirm:")]),t._v(" "),n("h1",{staticClass:"info--text display-3"},[t._v(t._s(t.scannedUsername))])]):n("div",[n("h6",{staticClass:"display-1"},[t._v("Your login code:")]),t._v(" "),n("h1",{staticClass:"primary--text display-3"},[t._v(t._s(t.loginCode))])])])],1):t._e()],1),t._v(" "),n("v-card-actions",[t.loginCode?n("v-btn",{attrs:{color:"info"},on:{click:t.codeLoginCleanUp}},[t._v("With username")]):n("v-btn",{attrs:{color:"secondary"},on:{click:t.codeLogin}},[t._v("With access code")]),t._v(" "),n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"primary",loading:t.loading,disabled:!t.valid},on:{click:t.login}},[t._v("Login")])],1)],1)],1)],1),t._v(" "),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1))],1)},staticRenderFns:[]},B=n("VU/8")(I,J,!1,null,null,null).exports,M=n("Xxa5"),j=n.n(M),H=n("exGp"),W=n.n(H),V=n("0lrd"),z=n.n(V),G={name:"blog-digest-nav",data:function(){return{}},props:{items:Array},methods:{onCreate:function(){var t=this;this.$nextTick(function(e){return t.processDigest()})},processDigest:function(){var t=document.querySelectorAll(".scrollspy"),e=document.getElementById("content");this.instance=z.a.ScrollSpy.init(t),z.a.Pushpin.init(document.querySelectorAll(".pushpin"),{top:e.offsetTop,offset:150,bottom:e.offsetHeight+e.offsetTop-this.$refs.digestNav.offsetHeight})},getInstance:function(){return z.a.ScrollSpy.getInstance(this.targetElements())}},computed:{targetElements:function(){return this.items.map(function(t){return t.element})}},mounted:function(){this.onCreate()},destroyed:function(){this.getInstance().destroy()},watch:{items:function(){this.onCreate()}}},Y={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"digestNav",staticClass:"hide-on-small-only pushpin",attrs:{id:"digest-nav"}},[n("ul",{staticClass:"section table-of-contents"},t._l(t.items,function(e){var a=e.hash,s=e.title;return n("li",{key:a},[n("a",{attrs:{href:"#"+a,to:{hash:a,query:t.$route.query}}},[t._v(t._s(s))])])}))])},staticRenderFns:[]};var X=n("VU/8")(G,Y,!1,function(t){n("3Kqa"),n("z6qg")},"data-v-5ebfe774",null).exports,K=n("wxAW"),Q=n.n(K),Z=n("dxoA"),tt=n.n(Z),et=n("XFB5"),nt=n.n(et),at=n("Zrlr"),st=n.n(at);function ot(t){var e=document.createElement("div");return e.innerHTML=t.replace(/<em>(.*?)<\/em>/,function(t,e){return"*"+e+"*"}),e.innerText||e.textContent}var rt=function t(e,n){st()(this,t),this.template=e,this.returnValue=n};function it(t,e){var n=new nt.a;if(e){e.forEach(function(e){return t[e]=new Proxy({},{get:function(){return null}})})}return new Proxy(t,{get:function(t,e){var a=tt()(t,e);return U.a.isFunction(a)?(n.has(a)||n.set(a,a.bind(t)),n.get(a)):a}})}var lt=function(){function t(e){st()(this,t),this.app=e,this.context=it(new ct(e),["window","document","fetch"])}return Q()(t,[{key:"render",value:function(t){return function(t,e,n){return t.replace(new RegExp((n||["{{","}}"]).join("\\s*?(.*?)\\s*?"),"gms"),function(t,n){try{var a=/([a-zA-Z_$]+[a-zA-Z_0-9]*){([\s\S]+)}/.exec(n),s=void 0;if(a){var o=v()(a,3),r=(o[0],o[1]),i=o[2];s=(e[r]||e.functions[r])(ot(i))}else n=ot(n),s=new Function("data",function(t){return"with(data || {}) { with(data.functions) {return ("+t+");}}"}(n))(e);return s instanceof rt?s.template:U.a.isNumber(s)||U.a.isString(s)?s:""}catch(t){return console.log("On rendering:",n),console.error(t),n}})}(t,this.context,["(?:Roselia|roselia|r|R){{","}}"])}}]),t}(),ct=function(){function t(e){var n=this;st()(this,t),this.Y=function(t){return(e=function(e){return t(function(t){return e(e)(t)})})(e);var e},this.app=e,this.customFunctions={app:null},this.functions=it(this.customFunctions),this.app.$on("postUnload",function(){n.customFunctions={app:null},n.functions=it(n.customFunctions)})}return Q()(t,[{key:"then",value:function(t){this.app.$nextTick(t)}},{key:"music",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(t){if(!window.APlayer){var e=document.createElement("script"),n=document.createElement("link");n.rel="stylesheet",n.href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css",e.async=!0,e.onload=t||null,e.src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js",document.head.appendChild(n),document.body.appendChild(e)}}(function(){return e.app.$emit("aPlayerLoaded")});var s=this.randomID(),o=void 0;return this.then(function(r){var i=function(){var e=document.getElementById(s);(o=new window.APlayer({container:e,narrow:!1,autoplay:n,mutex:!0,theme:u.theme.accent,mode:"circulation",showlrc:1,preload:"metadata",audio:t})).on("loadstart",function(){m()(e.getElementsByClassName("aplayer-title")).forEach(function(t){t.style.color=u.theme.secondary}),a&&a(o)})};window.APlayer?e.then(i):e.app.$once("aPlayerLoaded",function(){e.then(i)}),e.app.$once("postUnload",function(){o.destroy()})}),new rt('<div id="'+s+'"></div>',o)}},{key:"heimu",value:function(t){return'<span class="heimu">'+t+"</span>"}},{key:"cite",value:function(t,e){return'<a href="post?p='+e+'">'+t+"</a>"}},{key:"randomID",value:function(t){return Number(Math.random().toString().substring(3,t)+Date.now()).toString(36)}},{key:"onceLoad",value:function(t){this.app.$once("postLoaded",t)}},{key:"onceUnload",value:function(t){this.app.$once("postUnload",t)}},{key:"btn",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=this.randomID();return U.a.isArray(n)&&(n=n.join(" ")),e&&this.then(function(){document.getElementById(a).addEventListener("click",e)}),new rt('<button id="'+a+'" class="v-btn '+n+'">'+t+"</button>",a)}},{key:"toast",value:function(t,e){this.app.showToast(t,e||"info")}},{key:"formula",value:function(t){return"$ "+t+" $"}},{key:"formulation",value:function(t){return"$$ "+t+" $$"}},{key:"formulationEscape",value:function(){var t=this;[["$$","$$"],["$","$"],["\\(","\\)"]].map(function(t){return t.map(function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}).join("\\s*(.*?)\\s*")}).map(function(t){return new RegExp(t,"gms")}).forEach(function(e){t.app.postData.content=t.app.postData.content.replace(e,function(t,e){return ot(e)})})}},{key:"importJS",value:function(t,e){var n=document.createElement("script");n.onload=e,n.async=!0,n.src=t,document.body.appendChild(n)}},{key:"def",value:function(t,e){if(e instanceof rt)return this.customFunctions[t]=e.returnValue,e.template;this.customFunctions[t]=e}},{key:"audio",value:function(t){var e=this.randomID();return new rt("<audio id='"+e+"' src='"+t+"' hidden='true'>",e)}},{key:"getElement",value:function(t){return document.getElementById(t in this.functions?this.functions[t]:t)}},{key:"raw",value:function(t){return"<pre>Roselia{{"+t+"}}</pre>"}},{key:"previewColor",value:function(t){var e=this,n=this.app.preview.color;this.app.preview.color=t,this.onceUnload(function(){e.app.preview.color=n})}}]),t}(),ut=function(t){return new lt(t)},dt={components:{BlogDigestNav:X},name:"blog-post",props:{p:Number},data:function(){return{postData:{img:"",id:-1,content:"<p>Loading, please wait...</p>",next:-1,prev:-1,secret:0,title:"Loading...",subtitle:"",tags:[""],date:(new Date).toDateString()},userData:L.getLoginData(),postDigest:[],preview:{show:!1,loading:!1,current:0,title:"",subtitle:"",attach:"",origin:"center center",img:"",cacheData:null,color:"secondary"},cachedData:!1,renderer:null,toast:L.getToastOption()}},methods:{showToast:L.showToast,changeToast:function(t){this.toast.show=t},getArguments:L.getArguments,loadContent:function(t,e){var n=this;if(t=t||this.getPostNum(),(e=e||this.$route)&&e.params.data){var a=e.params.data;if("preview"===a.id||a.id==t)return this.postData=c()({},this.notFoundData(),a),this.cachedData=!0,void this.processContent()}this.cachedData=!1,-1!==t?L.fetchJSON(L.apiFor("post",t)).then(function(t){if(!t)return b.a.reject(ReferenceError("NPE"));n.postData=t,n.processContent()}).catch(function(t){n.postData=n.notFoundData()}):this.postData=this.notFoundData()},processContent:function(){var t,e=this;this.postData.content=this.renderer.render(this.postData.content),this.$nextTick((t=W()(j.a.mark(function t(n){var a,s;return j.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:L.colorUtils.apply({selector:"#main-pic img",text:"#title,#subtitle,#date,.digest-nav-el,#digest-nav",changeText:!0}),a=e.$refs.content.querySelectorAll("img"),m()(a).forEach(function(t){t.classList.add("responsive-img")}),z.a.Materialbox.init(a),e.setDigest(),s=new RegExp(location.host+"/.*\\?p=(\\d+)"),m()(e.$refs.content.querySelectorAll("a")).filter(function(t){return t.href&&t.host===location.host}).forEach(function(t){var n=t.href,a=s.exec(n);if(a){var o=a[1],r=t.hash;t.addEventListener("click",function(n){n.preventDefault(),r?e.$vuetify.goTo(document.getElementById(t.hash.substring(1)),{offset:-200}):e.$router.push({name:"post",query:{p:o},params:{data:e.preview.current==o&&!e.preview.loading&&e.preview.cacheData||void 0}})},!0),t.addEventListener("mouseover",function(n){if(e.preview.show=!0,e.preview.attach=t,r){e.preview.cacheData=null,e.preview.current=o;var a=document.getElementById(t.hash.substring(1));return e.preview.title=a.innerText,e.preview.img="",void(-1!==t.hash.indexOf("ref")?e.preview.subtitle=a.parentElement.innerText:e.preview.subtitle="")}e.preview.current!==o||e.preview.loading||!e.preview.cacheData?(e.preview.current=o,e.preview.loading=!0,e.preview.img="",L.fetchJSON(L.apiFor("post",o)).then(function(t){if(!t)return e.preview.loading=!1,e.preview.title="Oops! :(",e.preview.subtitle="This is a secret",void(e.preview.img="");e.preview.cacheData=t,e.preview.loading=!1,e.preview.title=t.title,e.preview.subtitle=t.subtitle,e.preview.img=t.img}).catch(function(t){e.preview.loading=!1,e.preview.cacheData=null,e.preview.title=":(",e.preview.subtitle=t.message,e.preview.img=""})):e.preview.current=o}),t.addEventListener("mouseout",function(t){e.preview.show=!1})}}),e.renderWithMathJax(),e.$emit("postLoaded");case 9:case"end":return t.stop()}},t,e)})),function(e){return t.apply(this,arguments)}))},renderWithMathJax:function(){window.MathJax&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,"output"])},getPostNum:function(){return this.getArguments().p||-1},notFoundData:function(){return{img:"",id:-1,content:"<p>There might be some problem here. Please check your input</p><p>Or maybe you know why.</p>",next:-1,prev:-1,secret:0,title:"Page Not Found",subtitle:"Please check your post-id. Or try to login.",tags:["404"],date:(new Date).toDateString()}},setDigest:function(){this.postDigest=m()(this.$refs.content.querySelectorAll("h1,h2,h3")).map(function(t,e){return t.classList.add("scrollspy"),t.classList.add("section"),t.id=t.id||"section-"+e,{hash:t.id,title:t.innerHTML,element:t}})}},computed:{hasDigest:function(){return this.postDigest.length>0}},mounted:function(){var t=this;if(this.renderer=ut(this),this.loadContent(),window.addEventListener("storage",function(e){"loginData"===e.key&&(t.userData=L.getLoginData())}),this.renderer=ut(this),!window.MathJax){var e=document.createElement("script");e.async=!0,e.src="https://cdn.bootcss.com/mathjax/2.7.3/latest.js?config=TeX-MML-AM_CHTML";var n=document.createElement("script");n.type="text/x-mathjax-config",n.innerHTML="MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});",document.body.appendChild(n),document.body.appendChild(e)}},beforeRouteUpdate:function(t,e,n){if(t.query.p===e.query.p)return n();this.$vuetify.goTo(0),this.$emit("postUnload"),this.loadContent(t.query.p,t),n()},destroyed:function(){this.$emit("postUnload")},watch:{userData:function(){!this.userData&&this.postData.secret&&(this.postData=this.notFoundData()),-1===this.postData.id&&this.loadContent()},"window.MathJax":function(){this.renderWithMathJax()}}},vt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"post"}},[n("nav-bar",{attrs:{userData:t.userData,route:this.$route.fullPath}}),t._v(" "),n("v-parallax",{attrs:{id:"main-pic",dark:"",src:t.postData.img||"static/img/nest.png"}},[n("v-layout",{attrs:{"align-center":"",column:"","justify-center":""}},[n("h1",{staticClass:"display-2 font-weight-thin mb-3",attrs:{id:"title"}},[t._v(t._s(t.postData.title))]),t._v(" "),n("h4",{staticClass:"subheading",attrs:{id:"subtitle"}},[t._v(t._s(t.postData.subtitle))]),t._v(" "),n("h4",{staticClass:"subheading",attrs:{id:"date"}},[t._v(t._s(t.postData.date))])])],1),t._v(" "),n("v-container",{attrs:{"grid-list-md":"",fluid:"","fill-height":""}},[n("v-layout",[n("v-flex",{attrs:{wrap:"",row:"",xs12:"",sm10:"","offset-sm2":""}},[n("v-layout",{attrs:{row:""}},t._l(t.postData.tags,function(e){return n("router-link",{key:e,attrs:{to:{name:"index",params:{tag:e},query:{tag:e}}}},[n("v-chip",[t._v(t._s(e))])],1)})),t._v(" "),n("v-flex",{attrs:{xs10:"",offset:"",xs2:""}},[t.cachedData?n("v-btn",{attrs:{color:"secondary",fab:"",small:""},on:{click:function(e){t.$router.go(-1)}}},[n("v-icon",[t._v("arrow_back")])],1):t._e(),t._v(" "),"preview"!==t.postData.id&&-1!==t.postData.id&&t.userData&&t.userData.role&&t.userData.role+1>=t.postData.secret?n("v-layout",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"error",fab:"",small:"",to:{name:"edit",params:{deletePost:!0,title:t.postData.title},query:{post:t.postData.id}}}},[n("v-icon",[t._v("delete")])],1),t._v(" "),n("v-btn",{attrs:{color:"primary",fab:"",small:"",to:{name:"edit",query:{post:t.postData.id}}}},[n("v-icon",[t._v("mode_edit")])],1)],1):t._e()],1),t._v(" "),n("v-layout",[n("v-flex",{class:{sm8:t.hasDigest,sm10:!t.hasDigest}},[n("div",{ref:"content",staticClass:"flow-text responsive-img",attrs:{id:"content"},domProps:{innerHTML:t._s(t.postData.content)}})]),t._v(" "),t.hasDigest?n("v-flex",{attrs:{sm2:""}},[n("blog-digest-nav",{attrs:{items:t.postDigest,offset:"500",threshold:"500"}})],1):t._e()],1),t._v(" "),n("div",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:t.postData.title,expression:"postData.title"}]})],1)],1)],1),t._v(" "),n("v-container",[n("v-flex",{attrs:{row:"",xs12:"",sm10:"","offset-sm1":""}},[n("v-layout",[-1!==t.postData.next?n("v-btn",{attrs:{color:"primary",fab:"",small:"",to:{name:"post",query:{p:t.postData.next}}}},[n("v-icon",[t._v("chevron_left")])],1):t._e(),t._v(" "),n("v-spacer"),t._v(" "),-1!==t.postData.prev?n("v-btn",{attrs:{color:"primary",fab:"",small:"",to:{name:"post",query:{p:t.postData.prev}}}},[n("v-icon",[t._v("chevron_right")])],1):t._e()],1)],1)],1),t._v(" "),n("v-dialog",{attrs:{"hide-overlay":"",width:"300",lazy:!0,attach:t.preview.attach,origin:t.preview.origin},model:{value:t.preview.show,callback:function(e){t.$set(t.preview,"show",e)},expression:"preview.show"}},[n("v-card",{attrs:{color:t.preview.color,dark:""}},[t.preview.img?n("v-img",{attrs:{src:t.preview.img}}):t._e(),t._v(" "),n("v-card-text",[t.preview.loading?t._e():n("div",[n("h1",{staticClass:"title"},[n("strong",[t._v(t._s(t.preview.title))])]),t._v(" "),n("v-spacer"),t._v(" "),n("h6",{staticClass:"subheading text-truncate"},[t._v(t._s(t.preview.subtitle))])],1),t._v(" "),t.preview.loading?n("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}}):t._e()],1)],1)],1),t._v(" "),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1)),t._v(" "),n("blog-footer")],1)},staticRenderFns:[]};var ht=n("VU/8")(dt,vt,!1,function(t){n("kCAO")},"data-v-d9e6a3e0",null).exports,ft={name:"blog-toolbar",props:["userData","route"],data:function(){return{title:u.title}},methods:{setRedirect:function(){L.setRedirect(this.route)},portedLogin:function(t){t.preventDefault();var e=window.open(this.$router.resolve({name:"login",query:{ported:!0}}).href,"loginWindow","height=400,width=400,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no"),n=this.$watch("userData",function(t){t&&(e.close(),n())});e.addEventListener("close",n)}}},pt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-toolbar",{staticClass:"white--text",attrs:{color:"primary"}},[t._t("default"),t._v(" "),n("v-toolbar-title",[n("router-link",{staticClass:"white--text no-deco",attrs:{to:{name:"index"}}},[t._v(t._s(t.title))])],1),t._v(" "),n("v-spacer"),t._v(" "),n("v-toolbar-items",[n("v-btn",{attrs:{dark:"",flat:"",to:"/"}},[t._v("Index")]),t._v(" "),t.userData?n("v-btn",{attrs:{dark:"",flat:"",to:"/userspace"}},[t._v(t._s(t.userData.username))]):n("v-btn",{attrs:{dark:"",flat:"",tag:"a",to:{name:"login"}},on:{contextmenu:function(e){t.portedLogin(e)}},nativeOn:{click:function(e){return t.setRedirect(e)}}},[t._v("Login")])],1)],2)},staticRenderFns:[]};var mt=n("VU/8")(ft,pt,!1,function(t){n("HYlc")},"data-v-50e33b50",null).exports,gt=n("V8mf"),_t=n.n(gt),wt=n("5x2J"),bt=n.n(wt),yt=n("vOQ7"),xt=n.n(yt),kt={name:"markdown-editor",props:{value:String,previewClass:String,autoinit:{type:Boolean,default:function(){return!0}},highlight:{type:Boolean,default:function(){return!1}},sanitize:{type:Boolean,default:function(){return!1}},configs:{type:Object,default:function(){return{}}}},mounted:function(){this.autoinit&&this.initialize()},activated:function(){var t=this.simplemde;t&&((t.isSideBySideActive()||t.isPreviewActive())&&t.toggleFullScreen())},methods:{initialize:function(){var t=Object.assign({element:this.$el.firstElementChild,initialValue:this.value,renderingConfig:{}},this.configs);t.initialValue&&this.$emit("input",t.initialValue),this.highlight&&(t.renderingConfig.codeSyntaxHighlighting=!0),xt.a.setOptions({sanitize:this.sanitize}),this.simplemde=new bt.a(t);var e=this.previewClass||"";this.addPreviewClass(e),this.bindingEvents()},bindingEvents:function(){var t=this;this.simplemde.codemirror.on("change",function(){t.$emit("input",t.simplemde.value())})},addPreviewClass:function(t){var e=this.simplemde.codemirror.getWrapperElement(),n=document.createElement("div");e.nextSibling.className+=" "+t,n.className="editor-preview "+t,e.appendChild(n)}},destroyed:function(){this.simplemde=null},watch:{value:function(t){t!==this.simplemde.value()&&this.simplemde.value(t)}}},Dt={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"markdown-editor"},[e("textarea")])}]};var Ct=n("VU/8")(kt,Dt,!1,function(t){n("4W6u")},null,null).exports;n("xUBe"),n("ETNL"),n("ragL");window.hljs=_t.a;var Pt={components:{BlogToolbar:mt,markdownEditor:Ct},name:"post-edit",data:function(){return{postData:{img:"",id:0,content:"",secret:0,title:"",subtitle:"",tags:[]},toast:{show:!1,text:"",color:""},deleteDialog:!1,valid:!0,markdown:!0,addPost:0,userData:L.getLoginData(),loading:!1,configs:{spellChecker:!1},uploadImages:[],doNotSave:!1}},methods:{showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.toast.text=t,this.toast.color=e,this.toast.show=!0},changeToast:function(t){this.toast.show=t},makeRedirect:function(t){L.setRedirect(this.$route.fullPath),L.redirectTo(t)},changeTags:function(){this.postData.tags=this.postData.tags.map(function(t){return t.replace(/ /g,"-")})},getPostNum:function(){return this.$route.query.post},getPostData:function(){return this.changeTags(),{markdown:this.markdown,data:this.postData,uploadImages:this.uploadImages}},getPostDraft:function(t){return JSON.parse(window.localStorage.getItem("postDraft#"+(t||0)))},saveDraft:function(){window.localStorage.setItem("postDraft#"+(this.postData.id||0),x()(this.getPostData())),this.showToast("Draft saved!")},deleteDraft:function(){window.localStorage.removeItem("postDraft#"+(this.postData.id||0))},getRequestForm:function(){var t=c()({},this.postData,{id:void 0,next:void 0,prev:void 0});return{postID:this.addPost?void 0:this.postData.id,data:t,markdown:this.markdown}},loadDraft:function(){var t=this.getPostNum()||0,e=this.getPostDraft(t);return e&&(this.markdown=e.markdown,this.postData=e.data),!!e},preload:function(){var t=this.loadDraft();return t&&this.showToast("Draft loaded!"),t},loadContent:function(){var t=this,e=this.getPostNum();e&&(this.loading=!0,L.fetchJSON(L.apiFor("post",e),"GET",{markdown:this.markdown}).then(function(e){t.loading=!1,e?t.postData=e:t.addPost=!0}).catch(function(e){t.showToast(e,"error")}))},doEditPost:function(){var t=this;return this.loading=!0,L.fetchJSONWithSuccess(L.apiFor("add"),"POST",this.getRequestForm()).then(function(e){t.showToast("Success!","success"),t.leave()}).catch(function(e){if(t.$Progress.fail(),"expired"===e)return L.refreshToken().then(function(e){return t.doEditPost()}).catch(function(e){t.showToast("Token Expired!","warning"),t.makeRedirect({name:"login"})});t.showToast(e,"error")}).finally(function(){t.deleteDialog=!1,t.loading=!1})},deletePost:function(){var t=this,e=this.getPostNum();if(e){var n=L.getLoginData();n&&n.role?L.fetchJSONWithSuccess(L.apiFor("remove"),"POST",{postID:e}).then(function(e){t.showToast("Success!","success"),t.leave(!0)}).catch(function(e){"expired"===e?(t.showToast("Token Expired!","warning"),t.$router.push({name:"login"})):t.showToast(e,"error")}):this.showToast("You are not supposed to do this.","warning")}},reloadPost:function(){this.markdown=!0,this.loadContent()},doNotDelete:function(){this.deleteDialog=!1,this.leave()},leave:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&this.deleteDraft(),this.doNotSave=t,this.$route.params.deletePost?this.$router.go(-1):L.redirectTo({name:"index"})},simplemde:function(){var t=this.$refs.markdownEditor;return t?t.simplemde:{markdown:function(t){return t}}},getPreviewData:function(){return c()({},this.postData,{id:"preview",content:this.simplemde().markdown(this.postData.content)})}},computed:{realTitle:function(){return this.addPost?"Add a post":"Edit: "+this.postData.title},operationVerb:function(){return this.addPost?"add":"edit"}},mounted:function(){var t=this;if(!this.userData)return this.makeRedirect({name:"login",params:{logout:!0,message:"Login to "+this.operationVerb+" a post"}});if(!this.userData.role)return this.showToast("You are not supposed to do this."),void L.redirectTo({name:"index"});if(this.$route.params.deletePost){this.deleteDialog=!0,this.postData.title=this.$route.params.title;var e=this.$watch("deleteDialog",function(n){e(),t.doNotDelete()})}else{this.addPost=!this.getPostNum(),this.preload()||this.addPost||this.loadContent(),addEventListener("storage",function(e){"loginData"===e.key&&(e.newValue||t.makeRedirect({name:"login"}))}),window.addEventListener("beforeunload",function(e){return t.saveDraft()})}},beforeDestroy:function(){this.doNotSave||this.saveDraft()},destroyed:function(){var t=this;removeEventListener("beforeunload",function(e){return t.saveDraft()})}},Tt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("blog-toolbar",{attrs:{userData:t.userData}}),t._v(" "),n("v-container",{attrs:{"grid-list-md":"",fluid:"","fill-height":""}},[n("v-layout",[n("v-flex",{attrs:{xs12:"",sm8:"","offset-sm2":""}},[n("h1",{staticClass:"display-3"},[t._v(t._s(t.realTitle))]),t._v(" "),n("v-layout",[n("v-spacer"),t._v(" "),n("v-tooltip",{attrs:{bottom:""}},[n("v-btn",{attrs:{slot:"activator",color:"secondary",fab:"",small:"",to:{name:"post",params:{data:t.getPreviewData()}}},slot:"activator"},[n("v-icon",[t._v("visibility")])],1),t._v(" "),n("span",[t._v("Preview the post. Note that the link can be used only once.")])],1)],1),t._v(" "),n("v-form",{ref:"form",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{label:"Title","prepend-icon":"title",required:"",rules:[function(t){return!!t||"Title is required"}]},model:{value:t.postData.title,callback:function(e){t.$set(t.postData,"title",e)},expression:"postData.title"}}),n("v-text-field",{attrs:{label:"Subtitle","prepend-icon":"subtitles"},model:{value:t.postData.subtitle,callback:function(e){t.$set(t.postData,"subtitle",e)},expression:"postData.subtitle"}}),t._v(" "),n("span",[t._v("Language")]),t._v(" "),n("v-switch",{attrs:{color:"accent",label:t.markdown?"Markdown":"HTML"},model:{value:t.markdown,callback:function(e){t.markdown=e},expression:"markdown"}}),t._v(" "),t.markdown||t.addPost?t._e():n("v-btn",{attrs:{color:"info"},on:{click:t.loadContent}},[t._v("Edit raw HTML")]),t._v(" "),n("v-slider",{attrs:{step:"1",min:"0",max:t.userData.role+1,ticks:"","thumb-label":"",label:"Secret level","prepend-icon":"lock"},model:{value:t.postData.secret,callback:function(e){t.$set(t.postData,"secret",e)},expression:"postData.secret"}}),t._v(" "),n("v-combobox",{attrs:{"hide-selected":"",label:"Tags","prepend-icon":"label",multiple:"",chips:"","deletable-chips":""},on:{input:t.changeTags},model:{value:t.postData.tags,callback:function(e){t.$set(t.postData,"tags",e)},expression:"postData.tags"}}),t._v(" "),n("v-text-field",{attrs:{label:"Banner Image","prepend-icon":"image"},model:{value:t.postData.img,callback:function(e){t.$set(t.postData,"img",e)},expression:"postData.img"}}),t._v(" "),n("span",[t._v("Content")]),t._v(" "),n("v-app",{attrs:{dark:!1}},[n("markdown-editor",{ref:"markdownEditor",attrs:{id:"markdownEditor",highlight:!0,configs:t.configs},model:{value:t.postData.content,callback:function(e){t.$set(t.postData,"content",e)},expression:"postData.content"}})],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),t.loading?n("div",[n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):n("div",[n("v-layout",[t.addPost?t._e():n("v-btn",{attrs:{color:"info"},on:{click:t.reloadPost}},[n("v-icon",[t._v("refresh")])],1),t._v(" "),t.addPost?t._e():n("v-btn",{attrs:{color:"error"},on:{click:function(e){t.deleteDialog=!0}}},[n("v-icon",[t._v("delete")])],1),t._v(" "),n("v-btn",{attrs:{color:"secondary",loading:t.loading},on:{click:t.saveDraft}},[n("v-icon",[t._v("archive")])],1),t._v(" "),n("v-btn",{attrs:{color:"primary",loading:t.loading,disabled:!t.valid},on:{click:t.doEditPost}},[n("v-icon",[t._v("cloud_upload")])],1)],1)],1)],1)],1)],1)],1),t._v(" "),n("div",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:t.realTitle,expression:"realTitle"}]}),t._v(" "),n("v-dialog",{attrs:{"max-width":"500"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v("Are you sure?")]),t._v(" "),n("v-card-text",[t._v("\r\n          You are deleting "+t._s(t.postData.title)+"\r\n          "),n("br"),t._v("\r\n          This post will be deleted, and can NOT be undone.\r\n        ")]),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"info",flat:"flat"},on:{click:function(e){t.deleteDialog=!1}}},[t._v("\r\n            No\r\n          ")]),t._v(" "),n("v-btn",{attrs:{color:"error",flat:"flat",loading:t.loading},on:{click:t.deletePost}},[t._v("\r\n            Yes, delete\r\n          ")])],1)],1)],1)],1),t._v(" "),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1)),t._v(" "),n("blog-footer")],1)},staticRenderFns:[]};var St=n("VU/8")(Pt,Tt,!1,function(t){n("ouHh")},"data-v-2eec9102",null).exports,$t={name:"blog-error",data:function(){return{errorCode:"404NotFound",errorTaunt:"Maybe Marisa has stolen something important",title:u.title,motto:u.motto,link:this.$router.resolve({name:"index"}),path:this.$route.fullPath,method:"GET"}}},Ut={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"top-details"},[n("aside",{staticClass:"exception-logo"}),t._v(" "),n("header",{staticClass:"exception-info"},[n("h5",{staticClass:"struct blog-text"},[t._v("\n        RoseliaBlog.Router."+t._s(t.errorCode)+"Error\n        "),n("small",[t._v("at "+t._s(t.method))]),t._v(" "),n("small",{staticClass:"path"},[t._v(t._s(t.path))])]),t._v(" "),n("h1",{staticClass:"title blog-text"},[t._v("an error found for "+t._s(t.method)+" "+t._s(t.path)+" (RoseliaBlog.Router)")])]),t._v(" "),n("div",{staticClass:"code-explorer"},[n("div",{staticClass:"code-snippets"},[n("div",{staticClass:"frame-info -active",attrs:{"data-index":"0",role:"stack-trace-details"}},[t._m(0),t._v(" "),n("pre",{staticClass:"black--text code code-block"},[t._m(1),t._v("\n                      "),t._m(2),t._v("\n                      "),t._m(3),t._v("\n                      "),t._m(4),t._v("\n                      "),t._m(5),t._v("\n                      "),t._m(6),t._v("\n                      "),n("span",{staticClass:"line -highlight"},[n("span",{staticClass:"ln"},[t._v("666")]),n("span",{staticClass:"code"},[t._v('    case "'+t._s(t.path)+'" => '+t._s(t.errorTaunt))])]),t._v("\n                      "),t._m(7),t._v("\n                      "),t._m(8),t._v("\n                  ")]),t._v(" "),t._m(9)])]),t._v(" "),n("div",{staticClass:"stack-trace"},[n("ul",{staticClass:"stack-trace-list -show-all",attrs:{role:"stack-trace-list"}},[t._m(10),t._v(" "),n("li",[n("router-link",{staticClass:"stack-trace-item",attrs:{to:"/",role:"stack-trace-item","data-index":"0"}},[n("span",{staticClass:"left"},[n("span",{staticClass:"app"},[t._v("RoseliaBlog")]),t._v(" "),n("span",{staticClass:"filename"},[t._v("\n                                  Bring me back\n                              ")])]),t._v(" "),n("span",{staticClass:"info"},[t._v('_ => RoseliaBlog.Router.route("index")')])])],1)])])])]),t._v(" "),n("div",{staticClass:"conn-info"},[n("details",{staticClass:"conn-details"},[n("summary",[t._v("Known info")]),t._v(" "),n("dl",[n("dt",[t._v("Instance:")]),t._v(" "),n("dd",{staticClass:"code-quote"},[t._v(t._s(t.title))])]),t._v(" "),n("dl",[n("dt",[t._v("URI:")]),t._v(" "),n("dd",{staticClass:"code-quote"},[t._v(t._s(t.path))])]),t._v(" "),n("dl",[n("dt",[t._v("Description:")]),t._v(" "),n("dd",{staticClass:"code-quote"},[t._v(t._s(t.motto))])]),t._v(" "),n("dl",[n("dt",[t._v("Error:")]),t._v(" "),n("dd",{staticClass:"code-quote"},[t._v(t._s(t.errorCode)+" - "+t._s(t.errorTaunt))])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"file"},[e("a",{attrs:{href:""}},[this._v("lib/roselia_blog/router")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"line"},[e("span",{staticClass:"ln"},[this._v("1")]),e("span",{staticClass:"code"},[this._v("class RoseliaBlog.Router extends Router{")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"line "},[e("span",{staticClass:"ln"},[this._v("2")]),e("span",{staticClass:"code"},[this._v("  ...")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"line "},[e("span",{staticClass:"ln"},[this._v("3")]),e("span",{staticClass:"code"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"line "},[e("span",{staticClass:"ln"},[this._v("233")]),e("span",{staticClass:"code"},[this._v("  def route(path: String): Request => Response = path match {")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"line "},[e("span",{staticClass:"ln"},[this._v("234")]),e("span",{staticClass:"code"},[this._v('    case "/" => Controller.index')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"line "},[e("span",{staticClass:"ln"},[this._v("235")]),e("span",{staticClass:"code"},[this._v("    ...")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"line "},[e("span",{staticClass:"ln"},[this._v("667")]),e("span",{staticClass:"code"},[this._v("  }")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"line "},[e("span",{staticClass:"ln"},[this._v("668")]),e("span",{staticClass:"code"},[this._v("  def scope(scop: String)(f: Request => Response): Request => Response = {")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"meta"},[e("div",{staticClass:"frame-mfa"},[this._v("\n              RoseliaBlog.Router.route: (path: String): Request => Response\n\n              "),e("a",{staticClass:"docs right blog-text",attrs:{href:"/"}},[this._v("index")]),this._v(" "),e("span",{staticClass:"app right"},[this._v("RoseliaBlog")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("button",{staticClass:"stack-trace-item -app -active",attrs:{role:"stack-trace-item","data-index":"0"}},[e("span",{staticClass:"left"},[e("span",{staticClass:"app"},[this._v("RoseliaBlog")]),this._v(" "),e("span",{staticClass:"filename"},[this._v("\n                                  lib/roselia_blog/router"),e("span",{staticClass:"line"},[this._v(":666")])])]),this._v(" "),e("span",{staticClass:"info"},[this._v("RoseliaBlog.Router.route: (path: String): Request => Response")])])])}]};var Et,Lt=n("VU/8")($t,Ut,!1,function(t){n("BY7X"),n("qmN2")},"data-v-457a2dde",null).exports,Rt=(Et=L.getLoginData(),function(){return Et||(Et=L.getLoginData())||{}}),Ot={components:{BlogToolbar:mt},name:"blog-user-space",data:function(){return{userData:Rt(),toast:{show:!1,text:"",color:""},drawer:null,dark:r.computed.isNight(),items:[{icon:"home",text:"Home",to:{name:"console-index"}},{divider:!0},{icon:"add_circle",text:"Write a new post",to:{name:"edit"},cond:Rt().role},{icon:"delete",text:"Remove all drafts",click:this.removeAllDraft},{divider:!0},{heading:"Management"},{icon:"lock",text:"Change password",to:{name:"changePassword"}},{icon:"people",text:"Manage User",to:{name:"userManagement"},cond:Rt().role},{divider:!0},{icon:"refresh",text:"Token Refresh",click:this.refreshToken,cond:Rt().rftoken},{icon:"verified_user",text:"Remote Login",to:{name:"remoteLogin"}},{divider:!0},{icon:"exit_to_app",text:"Log Out",to:{name:"login",params:{logout:!0}}}].filter(function(t){return!t.hasOwnProperty("cond")||t.cond})}},methods:{showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.toast=this.toast||{},this.toast.show=!1,this.toast.text=t.toString(),this.toast.color=e,this.toast.show=!0},changeToast:function(t){this.toast.show=t},makeRedirect:function(t){L.setRedirect(this.$route.fullPath),L.redirectTo(t)},removeAllDraft:function(){var t=window.localStorage;m()(Array(t.length).keys()).map(t.key.bind(t)).filter(function(t){return t.startsWith("postDraft")}).forEach(function(e){t.removeItem(e)}),this.showToast("Draft Cleaned!")},refreshToken:function(){var t=this;L.refreshToken().then(function(e){t.showToast("+1h O..O","success")}).catch(function(e){t.showToast(e,"error"),t.makeRedirect({name:"login"})})}},mounted:function(){var t=this;if(!this.userData)return this.showToast("Please login first","warning"),this.makeRedirect({name:"login",params:{logout:!0,message:"Login to manage"}});window.addEventListener("storage",function(e){"loginData"===e.key&&(t.userData=L.getLoginData())})},destroyed:function(){L.removeSUToken()}},Ft={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{attrs:{dark:t.dark}},[n("blog-toolbar",{attrs:{userData:t.userData}},[n("v-toolbar-side-icon",{attrs:{dark:""},nativeOn:{click:function(e){t.drawer=!t.drawer}}})],1),t._v(" "),n("v-navigation-drawer",{attrs:{fixed:"",clipped:"",app:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[n("v-list",{attrs:{dense:""}},[t._l(t.items,function(e,a){return[e.heading?n("v-layout",{key:a,attrs:{row:"","align-center":""}},[n("v-flex",{attrs:{xs6:""}},[e.heading?n("v-subheader",[t._v("\n              "+t._s(e.heading)+"\n            ")]):t._e()],1)],1):e.divider?n("v-divider",{key:a,staticClass:"my-3",attrs:{dark:""}}):e.click?n("v-list-tile",{key:a,attrs:{ripple:""},on:{click:e.click}},[n("v-list-tile-action",[n("v-icon",[t._v(t._s(e.icon))])],1),t._v(" "),n("v-list-tile-content",[n("v-list-tile-title",{staticClass:"grey--text"},[t._v("\n              "+t._s(e.text)+"\n            ")])],1)],1):n("v-list-tile",{key:a,attrs:{ripple:"",to:e.to}},[n("v-list-tile-action",[n("v-icon",[t._v(t._s(e.icon))])],1),t._v(" "),n("v-list-tile-content",[n("v-list-tile-title",{staticClass:"grey--text"},[t._v("\n              "+t._s(e.text)+"\n            ")])],1)],1)]})],2)],1),t._v(" "),n("v-content",[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-layout",{attrs:{"justify-center":"","align-center":""}},[n("v-flex",{attrs:{shrink:""}},[n("router-view",{attrs:{userData:t.userData,toast:t.showToast}})],1)],1)],1)],1),t._v(" "),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1))],1)},staticRenderFns:[]};var Nt=n("VU/8")(Ot,Ft,!1,function(t){n("i6we")},"data-v-ba345f24",null).exports,At=n("YqKu"),qt=n.n(At),It=[function(t){return!!t||"Required"},function(t){return t&&t.length>4&&t.length<20||"Length is not valid"}],Jt={name:"change-password",props:["userData","toast"],data:function(){var t=this;return{loading:!1,oldPassword:"",newPassword:"",repeatPassword:"",valid:!1,rules:It,repeatRules:It.concat([function(e){return e===t.newPassword||"Repeat password should equal to new password"}])}},methods:{changePassword:function(){var t=this;this.$refs.form.validate()&&(this.loading=!0,L.fetchJSONWithSuccess(L.apiFor("user","change"),"POST",{username:this.userData.username,oldPassword:this.oldPassword,newPassword:this.newPassword},!1).then(function(e){t.toast("Success!","success"),t.$router.go(-1)}).catch(function(e){t.toast(e,"error")}).finally(function(e){t.loading=!1}))}}},Bt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card-action",[n("h2",{staticClass:"flex text--secondary"},[t._v("Change Password for "+t._s(t.userData.username))]),t._v(" "),n("v-form",{ref:"form",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{name:"oldPassword",label:"Old Password",type:"password",autofocus:"",rules:t.rules},model:{value:t.oldPassword,callback:function(e){t.oldPassword=e},expression:"oldPassword"}}),t._v(" "),n("v-text-field",{attrs:{name:"newPassword",label:"New Password",type:"password",rules:t.rules},model:{value:t.newPassword,callback:function(e){t.newPassword=e},expression:"newPassword"}}),t._v(" "),n("v-text-field",{attrs:{name:"repeatPassword",label:"Repeat Password",type:"password",rules:t.repeatRules},model:{value:t.repeatPassword,callback:function(e){t.repeatPassword=e},expression:"repeatPassword"}})],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"warning",loading:t.loading,disabled:!t.valid},on:{click:t.changePassword}},[t._v("Change")])],1)],1)},staticRenderFns:[]};var Mt=n("VU/8")(Jt,Bt,!1,function(t){n("nttl")},"data-v-0b0d7844",null).exports,jt={name:"remote-login",props:["userData","toast"],data:function(){return{loginCode:"",valid:!1,loading:!1,rules:[function(t){return!!t||"Required"},function(t){return[].every.call(t,function(t){return!isNaN(parseInt(t))})||"Code should be digits"},function(t){return t&&6===t.length||"Length should be 6"}],dialog:!1,loginMeta:{os:"",browser:"",ip:""}}},methods:{scanCode:function(){var t=this;this.$refs.form.validate()&&(this.loading=!0,L.fetchJSON(L.apiFor("login","code","scan",this.loginCode),"POST").then(function(e){if(!e.success)return t.toast(e.msg,"error"),void(t.loading=!1);t.loginMeta=e.msg,t.dialog=!0,t.loading=!1}).catch(function(e){t.loading=!1,t.toast("Network error.","error")}))},confirmCode:function(){var t=this;this.loading=!0,L.fetchJSON(L.apiFor("login","code","confirm",this.loginCode),"POST").then(function(e){e.success||t.toast(e.msg,"error"),t.toast("I assume that you are teleported to another device","success"),t.dialog=!1,L.redirectTo({name:"userspace"})}).catch(function(e){t.toast("Network error","error")})}},watch:{dialog:function(t){t||(this.loading=!1)}}},Ht={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card-action",[n("h2",{staticClass:"flex text--secondary"},[t._v("Remote Login")]),t._v(" "),n("v-form",{ref:"form",on:{submit:function(t){t.preventDefault()}},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{name:"loginCode",label:"Login Code",type:"number",autofocus:"",rules:t.rules},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.scanCode(e):null}},model:{value:t.loginCode,callback:function(e){t.loginCode=e},expression:"loginCode"}})],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"primary",loading:t.loading,disabled:!t.valid},on:{click:t.scanCode}},[t._v("Login")])],1),t._v(" "),n("v-dialog",{attrs:{persistent:"","max-width":"500"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v("Remote Login")]),t._v(" "),n("v-card-text",[t._v("Will login at "+t._s(t.loginMeta.os)+" "+t._s(t.loginMeta.browser)+" device on "+t._s(t.loginMeta.ip))]),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"error",flat:""},nativeOn:{click:function(e){t.dialog=!1}}},[t._v("Nope")]),t._v(" "),n("v-btn",{attrs:{color:"info",flat:""},on:{click:t.confirmCode}},[t._v("OK")])],1)],1)],1)],1)},staticRenderFns:[]};var Wt=n("VU/8")(jt,Ht,!1,function(t){n("lbTm")},"data-v-bf5df548",null).exports,Vt={name:"user-management",props:["userData","toast"],data:function(){var t=this;return{suToken:"",loading:!1,userList:[],headers:[{text:"Username",align:"left",sortable:!0,value:"username"},{text:"Role Level",value:"role"},{text:"Action"}],loginForm:!1,addUser:{form:!1,username:"",password:"",role:0,items:m()(Array(this.userData.role).keys()).map(function(t,e){return{text:"Level "+e,value:e}}),rules:[function(t){return!!t||"Required"},function(t){return t&&t.length>4&&t.length<20||"Length is not valid"}],valid:!1},setPassword:{form:!1,valid:!1,username:"",password:""},deleteUser:{form:!1,valid:!1,username:"",typedUsername:"",rules:[function(e){return e&&e.toLowerCase()===t.deleteUser.username.toLowerCase()||"Username should be same to target user"}]},loginPassword:""}},methods:{leave:function(){this.$router.go(-1)},getSUToken:function(){var t=this;this.loading=!0,L.fetchJSON(L.apiFor("user","su"),"POST",{password:this.loginPassword}).then(function(e){if(t.loading=!1,!e.success)return t.toast("Wrong Password","error"),void(t.loginPassword="");t.loginForm=!1,t.suToken=e.token,L.saveSUToken(e.token),t.loadUser()})},loadUser:function(){var t=this;this.loading=!0,L.fetchJSONWithSuccess(L.apiFor("user","list")).then(function(e){t.loading=!1,t.userList=e}).catch(function(e){t.toast(e,"error"),t.leave()})},doAddUser:function(){var t=this;this.loading=!0,L.fetchJSONWithSuccess(L.apiFor("user","add"),"POST",{username:this.addUser.username,password:this.addUser.password,role:this.addUser.role,token:this.suToken},!1).then(function(e){t.addUser.form=!1,t.addUser.username="",t.addUser.password="",t.loadUser()}).catch(function(e){t.toast(e,"error")}).finally(function(e){t.loading=!1})},setPasswordForm:function(t){this.setPassword.username=t,this.setPassword.form=!0},doSetPassword:function(){var t=this;this.setPassword.valid&&(this.loading=!0,L.fetchJSONWithSuccess(L.apiFor("user","change"),"POST",{username:this.setPassword.username,newPassword:this.setPassword.password,token:this.suToken},!1).then(function(e){t.toast("Why must you change the password?","success"),t.setPassword.form=!1}).catch(function(e){t.toast(e,"error")}).finally(function(e){t.loading=!1}))},deleteUserForm:function(t){this.deleteUser.username=t,this.deleteUser.form=!0},doDeleteUser:function(){var t=this;this.deleteUser.valid&&(this.loading=!0,L.fetchJSONWithSuccess(L.apiFor("user","remove"),"POST",{username:this.deleteUser.username,token:this.suToken},!1).then(function(e){t.toast("Success!","success"),t.deleteUser.form=!1,t.loadUser()}).catch(function(e){t.toast(e,"error")}).finally(function(e){t.loading=!1}))}},mounted:function(){var t=L.getSUToken();if(!this.userData.role)return this.toast("You are not supposed to do this.","warning"),this.leave();this.suToken=t,t?this.loadUser():this.loginForm=!0,this.$route.params.firstRun&&(this.addUser.form=!0)},watch:{"setPassword.form":function(){this.setPassword.password=""},"deleteUser.form":function(){this.deleteUser.password=""}}},zt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-btn",{attrs:{flat:""},nativeOn:{click:function(e){t.addUser.form=!0}}},[n("v-icon",[t._v("person_add")])],1),t._v(" "),n("v-data-table",{staticClass:"elevation-1",attrs:{items:t.userList,loading:t.loading,headers:t.headers},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[t._v(t._s(e.item.username))]),t._v(" "),n("td",{staticClass:"text-xs-right"},[t._v(t._s(e.item.role))]),t._v(" "),n("td",{staticClass:"text-xs-right"},[n("v-btn",{attrs:{small:"",color:"secondary"},on:{click:function(n){t.setPasswordForm(e.item.username)}}},[n("v-icon",[t._v("edit")])],1),t._v(" "),n("v-btn",{attrs:{small:"",color:"error"},on:{click:function(n){t.deleteUserForm(e.item.username)}}},[n("v-icon",[t._v("delete")])],1)],1)]}}])},[n("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1),t._v(" "),n("v-layout",{attrs:{row:"","justify-center":""}},[n("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:t.addUser.form,callback:function(e){t.$set(t.addUser,"form",e)},expression:"addUser.form"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[t._v("Add User")])]),t._v(" "),n("v-card-text",[n("v-form",{model:{value:t.addUser.valid,callback:function(e){t.$set(t.addUser,"valid",e)},expression:"addUser.valid"}},[n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{rules:t.addUser.rules,label:"Username",required:""},model:{value:t.addUser.username,callback:function(e){t.$set(t.addUser,"username",e)},expression:"addUser.username"}})],1),t._v(" "),n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{rules:t.addUser.rules,label:"Password",type:"password",required:""},model:{value:t.addUser.password,callback:function(e){t.$set(t.addUser,"password",e)},expression:"addUser.password"}})],1),t._v(" "),n("v-flex",{attrs:{xs12:"",sm6:""}},[n("v-select",{attrs:{items:t.addUser.items,label:"Permission Level",required:""},model:{value:t.addUser.role,callback:function(e){t.$set(t.addUser,"role",e)},expression:"addUser.role"}})],1)],1)],1)],1)],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){t.addUser.form=!1}}},[t._v("Close")]),t._v(" "),n("v-btn",{attrs:{color:"blue darken-1",flat:"",disabled:!t.addUser.valid,loading:t.loading},on:{click:t.doAddUser}},[t._v("Add")])],1)],1)],1),t._v(" "),n("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:t.loginForm,callback:function(e){t.loginForm=e},expression:"loginForm"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[t._v("Enter Password")])]),t._v(" "),n("v-card-text",[n("h4",[t._v("For your safety, please input your password.")]),t._v(" "),n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{label:"Password",type:"password",required:""},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.getSUToken(e):null}},model:{value:t.loginPassword,callback:function(e){t.loginPassword=e},expression:"loginPassword"}})],1)],1)],1)],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"primary",flat:""},on:{click:t.leave}},[t._v("Close")]),t._v(" "),n("v-btn",{attrs:{color:"info",flat:""},on:{click:t.getSUToken}},[t._v("OK")])],1)],1)],1)],1),t._v(" "),n("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:t.setPassword.form,callback:function(e){t.$set(t.setPassword,"form",e)},expression:"setPassword.form"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[t._v("Set Password of "+t._s(t.setPassword.username))])]),t._v(" "),n("v-card-text",[n("v-form",{on:{submit:function(t){t.preventDefault()}},model:{value:t.setPassword.valid,callback:function(e){t.$set(t.setPassword,"valid",e)},expression:"setPassword.valid"}},[n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{rules:t.addUser.rules,label:"Password",type:"password",required:""},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.doSetPassword(e):null}},model:{value:t.setPassword.password,callback:function(e){t.$set(t.setPassword,"password",e)},expression:"setPassword.password"}})],1)],1)],1)],1)],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){t.setPassword.form=!1}}},[t._v("Close")]),t._v(" "),n("v-btn",{attrs:{color:"blue darken-1",flat:"",disabled:!t.setPassword.valid,loading:t.loading},on:{click:t.doSetPassword}},[t._v("Set")])],1)],1)],1),t._v(" "),n("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:t.deleteUser.form,callback:function(e){t.$set(t.deleteUser,"form",e)},expression:"deleteUser.form"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline error--text"},[t._v("Delete "+t._s(t.deleteUser.username))])]),t._v(" "),n("v-card-text",[n("span",[t._v("Please make sure by retyping username")]),t._v(" "),n("v-form",{on:{submit:function(t){t.preventDefault()}},model:{value:t.deleteUser.valid,callback:function(e){t.$set(t.deleteUser,"valid",e)},expression:"deleteUser.valid"}},[n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{rules:t.deleteUser.rules,label:"Retype Username",required:""},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.doDeleteUser(e):null}},model:{value:t.deleteUser.typedUsername,callback:function(e){t.$set(t.deleteUser,"typedUsername",e)},expression:"deleteUser.typedUsername"}})],1)],1)],1)],1)],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){t.deleteUser.form=!1}}},[t._v("Close")]),t._v(" "),n("v-btn",{attrs:{color:"error",flat:"",disabled:!t.deleteUser.valid,loading:t.loading},on:{click:t.doDeleteUser}},[t._v("Delete")])],1)],1)],1)],1)},staticRenderFns:[]};var Gt=n("VU/8")(Vt,zt,!1,function(t){n("A09j")},"data-v-5d96688e",null).exports,Yt={name:"ConsoleIndex",props:["userData","toast"],data:function(){return{posts:"Loading..."}},methods:{loadPostCount:function(){var t=this;L.fetchJSON(L.apiFor("posts"),"GET",{limit:1}).then(function(e){t.posts=e.total})}},mounted:function(){this.loadPostCount()}},Xt={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card-action",[n("h1",{staticClass:"primary--text display-1"},[t._v("Well met, "+t._s(t.userData.username)+"!")]),t._v(" "),n("p",[t._v("There are "+t._s(t.posts)+" posts from your perspective.")]),t._v(" "),n("p",[t._v("Take it easy casuse I will NOT break your legs in this page.")])])},staticRenderFns:[]},Kt=n("VU/8")(Yt,Xt,!1,null,null,null).exports;a.default.use(i.a),a.default.use(qt.a);var Qt=new i.a({mode:"history",base:u.urlPrefix,routes:[{path:"/hello",name:"HelloWorld",component:F},{path:"/",name:"index",component:q,meta:{title:u.title}},{path:"/login",name:"login",component:B,meta:{title:"Login"}},{path:"/post",name:"post",component:ht},{path:"/edit",alias:"/add",name:"edit",component:St},{path:"/userspace",alias:"/me",name:"userspace",component:Nt,meta:{title:"Console"},children:[{path:"change-password",name:"changePassword",component:Mt},{path:"remote-login",name:"remoteLogin",component:Wt},{path:"user-management",name:"userManagement",component:Gt},{path:"/",name:"console-index",component:Kt}]},{path:"*",name:"notFound",alias:"/404",component:Lt,meta:{title:"404 Not Found"}}]}),Zt=n("3EgV"),te=n.n(Zt),ee=(n("gJtD"),n("7zck"),{render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-snackbar",{attrs:{color:t.color,top:"",right:"",timeout:6e3},model:{value:t.showSelf,callback:function(e){t.showSelf=e},expression:"showSelf"}},[t._v("\n  "+t._s(t.text)+"\n  "),n("v-btn",{attrs:{flat:""},on:{click:function(e){t.showSelf=!1}}},[t._v("\n    Close\n  ")])],1)},staticRenderFns:[]});var ne=n("VU/8")({name:"toast",props:["show","text","color"],computed:{showSelf:{get:function(){return this.show},set:function(t){this.$emit("showChange",t)}}}},ee,!1,function(t){n("3fo/")},"data-v-d26a61ba",null).exports,ae={name:"blog-footer",data:function(){return{year:(new Date).getFullYear(),title:u.title,motto:u.motto}}},se={render:function(){var t=this.$createElement,e=this._self._c||t;return e("v-footer",{attrs:{height:"auto",color:"primary lighten-1"}},[e("v-layout",{attrs:{"justify-center":"",row:"",wrap:""}},[e("v-flex",{attrs:{primary:"","lighten-2":"","py-3":"","text-xs-center":"","white--text":"",xs12:""}},[this._v("\n      ©"+this._s(this.year)+" — "),e("strong",[this._v("Somainer")])])],1)],1)},staticRenderFns:[]};var oe=n("VU/8")(ae,se,!1,function(t){n("JgGX")},"data-v-40d4b905",null).exports,re=n("zYko"),ie=n.n(re),le={name:"gotop-button",data:function(){return{height:0,offsetTop:0}},methods:{recordHeight:function(){this.height=window.innerHeight},recordScroll:function(){this.offsetTop=window.pageYOffset||document.documentElement.scrollTop},goTop:function(){this.$vuetify.goTo(0)}},mounted:function(){this.recordHeight(),this.recordScroll()},computed:{showButton:function(){return this.offsetTop>=this.height}}},ce={render:function(){var t=this.$createElement,e=this._self._c||t;return e("v-layout",{directives:[{name:"scroll",rawName:"v-scroll",value:this.recordScroll,expression:"recordScroll"},{name:"resize",rawName:"v-resize",value:this.recordHeight,expression:"recordHeight"}]},[e("v-scale-transition",{attrs:{origin:"center center 0"}},[this.showButton?e("v-btn",{staticClass:"fixed-action-btn",style:{bottom:this.$vuetify.breakpoint.smOnly?"64px":""},attrs:{color:"secondary",fab:"",fixed:"",bottom:"",right:""},on:{click:this.goTop}},[e("v-icon",[this._v("keyboard_arrow_up")])],1):this._e()],1)],1)},staticRenderFns:[]};var ue=n("VU/8")(le,ce,!1,function(t){n("c7Xx")},"data-v-0542868a",null).exports;a.default.use(te.a,{theme:u.theme}),a.default.use(ie.a,{color:u.theme.secondary,failedColor:u.theme.error,thickness:"4px"}),a.default.component("toast",ne),a.default.component("nav-bar",mt),a.default.component("blog-footer",oe),a.default.component("go-top-btn",ue),a.default.directive("focus",{update:function(t,e){e.value&&t.focus()}}),a.default.config.productionTip=!1;var de=e.default=new a.default({el:"#app",router:Qt,components:{App:r},template:"<App/>"})},"Tq+r":function(t,e){},"bh+O":function(t,e){},c7Xx:function(t,e){},gJtD:function(t,e){},i6we:function(t,e){},kCAO:function(t,e){},lbTm:function(t,e){},nttl:function(t,e){},ouHh:function(t,e){},qmN2:function(t,e){},ragL:function(t,e){},xUBe:function(t,e){},z6qg:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.5025edf98c00b7d3a48b.js.map