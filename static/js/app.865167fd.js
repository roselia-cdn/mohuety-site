(function(t){function e(e){for(var a,s,i=e[0],c=e[1],l=e[2],d=0,h=[];d<i.length;d++)s=i[d],o[s]&&h.push(o[s][0]),o[s]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(h.length)h.shift()();return r.push.apply(r,l||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],a=!0,i=1;i<n.length;i++){var c=n[i];0!==o[c]&&(a=!1)}a&&(r.splice(e--,1),t=s(s.s=n[0]))}return t}var a={},o={app:0},r=[];function s(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=a,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)s.d(n,a,function(e){return t[e]}.bind(null,a));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"034f":function(t,e,n){"use strict";var a=n("1356"),o=n.n(a);o.a},"0353":function(t,e,n){"use strict";var a=n("4442"),o=n.n(a);o.a},"06ee":function(t,e,n){},"0a82":function(t,e,n){},1:function(t,e){},1356:function(t,e,n){},"1f35":function(t,e,n){},2738:function(t,e,n){},2984:function(t,e,n){"use strict";var a=n("42a9"),o=n.n(a);o.a},"315b":function(t,e,n){"use strict";var a=n("9e4d"),o=n.n(a);o.a},3964:function(t,e,n){},"3b21":function(t,e,n){},4190:function(t,e,n){},"42a9":function(t,e,n){},4442:function(t,e,n){},"4a96":function(t,e,n){"use strict";var a=n("3b21"),o=n.n(a);o.a},"61eb":function(t,e,n){"use strict";var a=n("06ee"),o=n.n(a);o.a},"6dc4":function(t,e,n){"use strict";var a=n("1f35"),o=n.n(a);o.a},7878:function(t,e,n){},"848e":function(t,e,n){"use strict";var a=n("fffe"),o=n.n(a);o.a},"86f9":function(t,e,n){"use strict";var a=n("7878"),o=n.n(a);o.a},"8cd6":function(t,e,n){"use strict";var a=n("efa2"),o=n.n(a);o.a},"8f84":function(t,e,n){"use strict";var a=n("b67e"),o=n.n(a);o.a},"9e4d":function(t,e,n){},aa00:function(t,e,n){"use strict";var a=n("d0f6"),o=n.n(a);o.a},ac4e:function(t,e,n){"use strict";var a=n("3964"),o=n.n(a);o.a},b67e:function(t,e,n){},c293:function(t,e,n){"use strict";var a=n("d8c9"),o=n.n(a);o.a},cd49:function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var a=n("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("div",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:t.$route.meta.title,expression:"$route.meta.title"}]}),n("v-app",{attrs:{dark:t.isNight}},[n("v-content",[n("v-slide-x-transition",{attrs:{"hide-on-leave":""}},[n("router-view",{on:{forceSwitchToLight:t.switchToLight}})],1)],1)],1),n("vue-progress-bar"),n("go-top-btn")],1)},r=[],s={name:"App",mounted:function(){this.$Progress.finish()},created:function(){var t=this;this.$Progress.start(),this.$router.beforeEach(function(e,n,a){if(void 0!==e.meta.progress){var o=e.meta.progress;t.$Progress.parseMeta(o)}t.$Progress.start(),a()}),this.$router.afterEach(function(e,n){t.$Progress.finish()})},methods:{switchToLight:function(t){this.forceLight=!!t}},data:function(){return{forceLight:!1,forceTitle:""}},computed:{isNight:function(){var t=(new Date).getHours(),e=t>6&&t<18;return!(this.forceLight||e)}}},i=s,c=(n("034f"),n("2877")),l=n("6544"),u=n.n(l),d=n("7496"),h=n("549c"),f=n("0789"),v=Object(c["a"])(i,o,r,!1,null,null,null);v.options.__file="App.vue";var p=v.exports;u()(v,{VApp:d["a"],VContent:h["a"],VSlideXTransition:f["e"]});var m=n("8c4f"),g=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:"","grid-list-md":"","text-xs-center":"","fill-height":""}},[n("v-responsive",[n("v-layout",{attrs:{row:"",wrap:"","justify-center":"","align-center":""}},[n("v-flex",{attrs:{xs12:""}},[n("h3",{staticClass:"display-3"},[t._v("Welcome to "),n("strong",{staticClass:"primary--text"},[t._v(t._s(t.title))])]),n("span",{staticClass:"subheading"},[t._v(t._s(t.motto))]),n("v-divider",{staticClass:"my-3"}),t.loading?n("div",[n("div",{staticClass:"title mb-3"},[t._v("Please standby...")]),n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):t.isFirstRun?n("div",[n("div",{staticClass:"title mb-3"},[t._v("Add first user to continue.")]),n("v-btn",{staticClass:"mx-0",attrs:{color:"primary",large:"",to:{name:"userManagement",params:{firstRun:!0}}}},[t._v("\n            Add user\n          ")])],1):n("div",[n("div",{staticClass:"title mb-3"},[t._v("Great! You are now prepared to "),n("strong",{staticClass:"primary--text"},[t._v(t._s(t.title))])]),n("v-btn",{staticClass:"mx-0",attrs:{color:"secondary",large:"",to:{name:"index"}}},[t._v("\n            Go to "+t._s(t.title)+"\n          ")])],1)],1)],1)],1)],1)},w=[],b=n("cebc"),k="Mohuety",y="Do what you want to do, be who you want to be.",_="https://roselia.moe/blog/api",x="/blog",D={primary:"#0288d1",secondary:"#6292E9",accent:"#E08696",error:"#FB5458",warning:"#FE9952",info:"#95CAEE",success:"#61BF99"},C={title:k,motto:y,apiBase:_,theme:D,enableRoseliaScript:!0,urlPrefix:x,images:{indexBannerImage:x+"/static/img/bg_n3.jpg",postBannerImage:x+"/static/img/nest.png",lazyloadImage:x+"/static/img/observe.jpg",timelineBannerImage:x+"/static/img/bg_n0.png"}},T=(n("6b54"),n("28a5"),n("5176")),P=n.n(T),S=n("795b"),L=n.n(S),V=(n("386d"),n("f499")),O=n.n(V),E=n("bc3a"),$=n.n(E),j=$.a.create();j.interceptors.request.use(function(t){return Po.$Progress.start(),t}),j.interceptors.response.use(function(t){return 200===t.status?Po.$Progress.finish():Po.$Progress.fail(),t},function(t){return Po.$Progress.fail(),L.a.reject(t)});var N=j,U=n("2ef0"),R=n.n(U),F={};F.apiBase=C.apiBase,F.getArguments=function(){return this.$route.query},F.setRedirect=function(t){window.sessionStorage.setItem("redirectURL",O()(t||F.getAbsPath()))},F.getRedirect=function(){return JSON.parse(window.sessionStorage.getItem("redirectURL"))},F.cleanRedirect=function(){window.sessionStorage.removeItem("redirectURL")},F.getAbsPath=function(){return window.location.pathname+window.location.search+window.location.hash},F.redirectTo=function(t){Xa.push(t||"./")},F.getLoginData=function(){return window.localStorage.loginData?JSON.parse(window.localStorage.loginData):null},F.setLoginData=function(t){window.localStorage.loginData=O()(t)},F.updateLoginData=function(t){return F.setLoginData(t(F.getLoginData()))},F.removeLoginData=function(){return window.localStorage.loginData&&window.localStorage.removeItem("loginData")},F.saveSUToken=function(t){window.sessionStorage.setItem("suToken",t)},F.getSUToken=function(){return window.sessionStorage.getItem("suToken")},F.removeSUToken=function(){window.sessionStorage.removeItem("suToken")},F.getPosts=function(t){return this.fetchJSON(this.apiFor("posts")).then(t)},F.refreshToken=function(t){if(!t){var e=F.getLoginData();t=e&&e.rftoken}return t?F.fetchJSON(F.apiFor("login","token","refresh"),"POST",{token:t},!1,!1).then(function(t){if(t.success){var e=F.getLoginData();return e&&(e.token=t.token)&&F.setLoginData(e),e}return F.removeLoginData(),L.a.reject(t.msg)}):L.a.reject("No token")},F.formatDate=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var n=new Date(t);return e?n.toLocaleString():n.toLocaleDateString()}catch(a){return}},F.getPostsData=function(){return JSON.parse(window.localStorage.postData||"null")},F.deleteDraft=function(){return window.localStorage.removeItem("postDraft")},F.setPosts=function(t){window.localStorage.postData=O()(t)},F.apiFor=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return"".concat(F.apiBase,"/").concat(e.join("/"))},F.encodeArgs=function(t){return R.a.map(t,function(t,e){return"".concat(e,"=").concat(t)}).join("&")},F.processPosts=function(t){var e=window.localStorage.postData;return e?t(JSON.parse(e)):F.getPosts(t),!1},F.ajaxPromised=function(t){return N(t).then(function(t){return t.data})},F.fetchJSON=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=this.getLoginData(),s=r?r.token:"";e=e.toUpperCase(),o&&(n["__timestamp"]=(new Date).getTime());var i=a?P()({},n,{token:s}):n;return"GET"===e&&(i={params:i}),N[e.toLowerCase()](t,i).then(function(t){return t.data}).catch(function(t){return L.a.reject(t)})},F.fetchJSONWithSuccess=function(){return this.fetchJSON.apply(this,arguments).then(function(t){return t.success?t.result||t.data||t:L.a.reject(t.msg)})},F.getTokenExpiryTime=function(t){try{var e=t.split(".")[0],n=JSON.parse(window.atob(e)),a=n.exp;return new Date(1e3*a)}catch(o){return console.error(o),new Date}},F.isTokenExpired=function(t){return F.getTokenExpiryTime(t||this.getLoginData().token)<new Date},F.showToast=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.toast.show=!1,this.toast.text=t.toString(),this.toast.color=e,this.toast.show=!0},F.getToastOption=function(){return{show:!1,text:"",color:""}};var A=F,I={name:"HelloWorld",data:function(){return{title:C.title,motto:C.motto,loading:!0,isFirstRun:!1}},methods:{getFirstRunData:function(){var t=this;A.fetchJSONWithSuccess(A.apiFor("firstrun")).then(function(e){t.isFirstRun=!0,A.setLoginData(Object(b["a"])({},e,{su_token:void 0})),A.saveSUToken(e.su_token)}).finally(function(e){t.loading=!1})}},mounted:function(){this.getFirstRunData()}},B=I,q=(n("aa00"),n("8336")),M=n("a523"),J=n("ce7e6"),W=n("0e8f"),H=n("a722"),Y=n("490a"),z=n("6b53"),G=Object(c["a"])(B,g,w,!1,null,"9c85b088",null);G.options.__file="HelloWorld.vue";var X=G.exports;u()(G,{VBtn:q["a"],VContainer:M["a"],VDivider:J["a"],VFlex:W["a"],VLayout:H["a"],VProgressCircular:Y["a"],VResponsive:z["a"]});var Z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("nav-bar",{attrs:{userData:t.userData,route:this.$route.fullPath}}),n("v-parallax",{attrs:{dark:"",src:t.meta.images.indexBannerImage}},[n("v-layout",{attrs:{"align-center":"",column:"","justify-center":""}},[n("h1",{staticClass:"display-2 font-weight-thin mb-3"},[t._v(t._s(t.realTitle||t.meta.title))]),n("h4",{staticClass:"subheading"},[t._v(t._s(t.realSubtitle||t.meta.motto))])])],1),n("v-layout",[n("v-container",{attrs:{fluid:"","grid-list-lg":""}},[n("v-layout",{attrs:{row:"",wrap:""}},t._l(t.posts,function(e){return n("v-flex",{key:e.id,attrs:{xs12:"",sm8:"","offset-sm2":""}},[n("v-card",{attrs:{hover:"",to:t.getRoute(e)}},[e.img?n("v-img",{attrs:{src:e.img,"lazy-src":t.meta.images.lazyloadBannerImage,ripple:"true"}},[n("v-container",{attrs:{"fill-height":"",fluid:""}},[n("v-layout",{attrs:{"align-end":"","fill-height":""}},[n("v-flex",{attrs:{xs12:"","align-end":"",flexbox:""}},[t._l(e.tags,function(e){return n("router-link",{key:e,attrs:{to:{name:"index",params:{tag:e},query:{tag:e}}}},[n("v-chip",[t._v(t._s(e))])],1)}),e.secret?n("v-chip",{attrs:{color:"success","text-color":"white"}},[n("v-avatar",[n("v-icon",[t._v("lock")]),t._v(t._s(e.secret)+"\n                      ")],1),t._v("\n                      Secret\n                    ")],1):t._e()],2)],1)],1)],1):t._e(),n("v-card-title",{attrs:{"primary-title":""}},[n("div",[n("div",{staticClass:"headline"},[t._v(t._s(e.title))]),n("span",{staticClass:"grey--text"},[t._v(t._s(e.subtitle))])]),n("v-spacer"),n("span",{staticClass:"right"},[t._v(t._s(t.formatDate(e.created)||e.date))])],1),n("v-card-title",[n("span",{staticClass:"grey--text"},[t._v(t._s(e.author.nickname))])]),t.userData&&t.userData.role&&t.userData.role>=e.author.role?n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{small:"",fab:"",color:"error",to:{name:"edit",query:{post:e.id},params:{deletePost:!0,title:e.title}}}},[n("v-icon",[t._v("delete")])],1),n("v-btn",{attrs:{small:"",fab:"",color:"primary",to:{name:"edit",query:{post:e.id}}}},[n("v-icon",[t._v("mode_edit")])],1)],1):t._e()],1)],1)}),1)],1)],1),n("v-container",[n("div",{staticClass:"text-xs-center"},[n("v-pagination",{attrs:{length:t.pages,circle:""},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1)]),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1)),n("blog-footer"),n("div",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:t.windowTitle,expression:"windowTitle"}]})],1)},K=[],Q=n("e814"),tt=n.n(Q),et=n("bd86"),nt=n("768b"),at=n("2d1f"),ot=n.n(at),rt=(n("a481"),function(t){return t.replace(/([A-Z])/g,"_$1").toLowerCase()}),st=function(t){return t.replace(/_([a-zA-Z])/g,function(t,e){return e.toUpperCase()})},it=function(t){return function(e){return ot()(e).map(function(e){var n=Object(nt["a"])(e,2),a=n[0],o=n[1];return t(a,o)})}},ct=function(t){return t.reduce(function(t,e){return Object(b["a"])({},t,Object(et["a"])({},e[0],e[1]))},{})},lt=function(t){return function(e){return ct(it(function(e,n){return[t(e),n]})(e))}},ut=lt(st),dt=lt(rt),ht=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce(function(t,e){return"undefined"===typeof t?void 0:t[e]},t)}},ft={name:"blog-index",data:function(){return{currentPage:1,prevPage:0,nextPage:0,pages:0,userData:A.getLoginData(),toast:A.getToastOption(),posts:[],meta:C,realTitle:"",realSubtitle:"",windowTitle:""}},methods:{makeDirect:function(t){A.setRedirect(A.getAbsPath()),this.$router.push(t)},getTag:function(){return this.getArguments().tag||null},getArguments:function(){return this.$route.query},getPageOffset:function(t){var e=tt()(this.getArguments().page)||1,n=e+t;return n>0&&n<=this.pages?n:-1},formatDate:function(t){return A.formatDate(t)},shiftPage:function(t){var e=this.getPageOffset(t);-1!==e&&(this.$vuetify.goTo(0),this.$router.push({name:"index",params:{page:e}}))},showToast:A.showToast,changeToast:function(t){this.toast.show=t},getPostsOnContex:function(t){return t=t||this.getArguments(),this.getPosts(t.page,!1,t.tag)},getPosts:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;t=t||1;var o={page:t,limit:6};a?(this.windowTitle="".concat(this.meta.title," - Tag: ").concat(a),this.realTitle=a,this.realSubtitle="Posts for tag: ".concat(a),o.tag=a):(this.realTitle="",this.realSubtitle="",this.windowTitle="".concat(this.meta.title," - #").concat(t)),A.fetchJSON(A.apiFor("posts"),"GET",o).then(function(a){if(!a.valid&&e.userData&&!n)return A.refreshToken().then(function(n){e.userData=n,e.getPosts(t,!0)}).catch(function(t){e.showToast(t,"warning"),e.userData=null,A.removeLoginData()});e.posts=a.data.map(function(t){return t.deleted=!1,t}),e.pages=tt()(a.pages),e.currentPage=tt()(t),e.nextPage=e.getPageOffset(1),e.prevPage=e.getPageOffset(-1),e.$emit("roselia-load")}).catch(function(t){console.log(t)})},getRoute:function(t){return t=ut(t),t.displayId?{name:"postWithEternalLink",params:{postLink:t.displayId}}:{name:"post",query:{p:t.id}}}},mounted:function(){var t=this;this.userData=A.getLoginData(),this.getPostsOnContex(),window.addEventListener("storage",function(e){"loginData"===e.key&&(t.userData=A.getLoginData())})},computed:{},watch:{userData:function(){this.getPosts()},currentPage:function(t){this.$router.push(Object(b["a"])({},this.$route,{query:Object(b["a"])({},this.$route.query,{page:1===t?void 0:t})}))}},beforeRouteUpdate:function(t,e,n){this.$vuetify.goTo(0);var a=t.query;this.getPostsOnContex(a),n()}},vt=ft,pt=(n("61eb"),n("8212")),mt=n("b0af"),gt=n("99d9"),wt=n("12b2"),bt=n("cc20"),kt=n("132d"),yt=n("adda"),_t=n("891e"),xt=n("8b9c"),Dt=n("9910"),Ct=Object(c["a"])(vt,Z,K,!1,null,"24eb2a20",null);Ct.options.__file="BlogIndex.vue";var Tt=Ct.exports;u()(Ct,{VAvatar:pt["a"],VBtn:q["a"],VCard:mt["a"],VCardActions:gt["a"],VCardTitle:wt["a"],VChip:bt["a"],VContainer:M["a"],VFlex:W["a"],VIcon:kt["a"],VImg:yt["a"],VLayout:H["a"],VPagination:_t["a"],VParallax:xt["a"],VSpacer:Dt["a"]});var Pt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-layout",{attrs:{"align-center":"","justify-center":""}},[n("v-flex",{attrs:{xs12:"",sm8:"",md4:""}},[n("v-card",{staticClass:"elevation-12"},[n("v-toolbar",{attrs:{dark:"",color:"primary"}},[this.$route.query.ported?n("v-btn",{attrs:{flat:"",fab:"",onclick:"window.self.close()"}},[n("v-icon",[t._v("close")])],1):n("v-btn",{attrs:{flat:"",fab:"",to:"/"}},[n("v-icon",[t._v("arrow_back")])],1),n("v-toolbar-title",[t._v(t._s(t.title))]),n("v-spacer")],1),n("v-card-text",[n("v-alert",{attrs:{type:t.toast.color,transition:"scale-transition",dismissible:""},model:{value:t.toast.show,callback:function(e){t.$set(t.toast,"show",e)},expression:"toast.show"}},[t._v("\n            "+t._s(t.toast.text)+"\n          ")]),n("h2",{staticClass:"flex text--secondary"},[t._v(t._s(t.message))]),n("v-window",{attrs:{value:t.currentLayer}},[n("v-window-item",{attrs:{value:2}},[t.loading&&!t.loginCode?n("div",[n("h3",{staticClass:"display-1"},[t._v("Please standby...")]),n("v-progress-linear",{attrs:{indeterminate:"",color:"accent"}})],1):t._e()]),n("v-window-item",{attrs:{value:0}},[t.loading||t.loginCode?t._e():n("v-form",{model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{"prepend-icon":"person",name:"username",label:"Username",type:"text",autofocus:"",rules:t.rules},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.focusPassword(e):null}},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),n("v-text-field",{ref:"passWord",attrs:{id:"password","prepend-icon":"lock",name:"password",label:"Password",type:"password",rules:t.rules},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.login(e):null}},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1)],1),n("v-window-item",{attrs:{value:1}},[t.loginCode?n("v-container",[n("v-layout",{attrs:{"align-center":"","justify-center":""}},[t.scannedUsername?n("div",[n("h6",{staticClass:"display-1"},[t._v("Welcome, please confirm:")]),n("h1",{staticClass:"info--text display-3"},[t._v(t._s(t.scannedUsername))])]):n("div",[n("h6",{staticClass:"display-1"},[t._v("Your login code:")]),n("h1",{staticClass:"primary--text display-3"},[t._v(t._s(t.loginCode))])])])],1):t._e()],1)],1),!t.loading&&t.hasOauthAdapter?n("v-layout",{attrs:{"align-center":"","justify-center":""}},[n("h4",[t._v("Login using")]),n("div",[n("div",{staticClass:"text-xs-center"},t._l(t.oauthLogin.adapters,function(e){return n("v-btn",{key:e,attrs:{round:"",color:"accent",dark:"",loading:t.oauthLogin.loading},on:{click:function(n){t.redirectOauthLogin(e)}}},[t.$vuetify.icons.brand[e]?n("v-icon",[t._v(t._s(t.$vuetify.icons.brand[e]))]):n("span",[t._v(t._s(e))])],1)}),1)])]):t._e()],1),n("v-card-actions",[t.oauthLogin.loading?t._e():n("div",[t.loginCode?n("v-btn",{attrs:{color:"info"},on:{click:t.codeLoginCleanUp}},[t._v("With username")]):n("v-btn",{attrs:{color:"secondary"},on:{click:t.codeLogin}},[t._v("With access code")])],1),n("v-spacer"),n("v-btn",{attrs:{color:"primary",loading:t.loading,disabled:!t.valid},on:{click:t.login}},[t._v("Login")])],1)],1)],1)],1),n("toast",t._b({directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],on:{showChange:t.changeToast}},"toast",t.toast,!1))],1)},St=[],Lt=n("a8db"),Vt={data:function(){return{loading:!1,title:C.title,toast:{show:!1,text:"",color:""},username:"",password:"",rules:[function(t){return!!t||"Required"},function(t){return t&&t.length>4&&t.length<20||"Length is not valid"}],valid:!1,loginCode:"",scannedUsername:"",focusAt:!1,oauthLogin:{loading:!1,adapters:[]}}},props:{source:String},methods:{login:function(){var t=this;this.valid&&(this.$emit("beforeLogin"),this.loading=!0,A.fetchJSON(A.apiFor("login"),"POST",{username:this.username,password:this.password},!1).then(function(e){if(!e.success)return L.a.reject(e.msg);t.setLoginData({username:t.username,token:e.token,role:e.role,rftoken:e.rftoken}).then(function(){return t.redirectBack()})}).catch(function(e){t.showToast(e,"error"),t.loading=!1}))},redirectBack:function(){this.$router.push(this.redirection)},showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.toast.show=!1,this.toast.text=t.toString(),this.toast.color=e,this.toast.show=!0},changeToast:function(t){this.toast.show=t},cleanUp:function(){A.cleanRedirect(),window.sessionStorage.removeItem("message")},setLoginData:function(t){var e=t.username,n=Object(Lt["a"])(t,["username"]);return A.fetchJSONWithSuccess(A.apiFor("user","nickname"),"GET",{username:e}).then(function(t){var a=t.nickname;A.setLoginData(Object(b["a"])({username:e,nickname:a},n))}).catch(function(t){A.setLoginData(Object(b["a"])({username:e,nickname:e},n))})},tokenLogin:function(t){var e=this;return this.loading=!0,A.fetchJSON(A.apiFor("login","token"),"POST",{token:t},!1).then(function(n){if(!n.success)return L.a.reject(n.msg);e.setLoginData({username:n.payload.username,token:t,role:n.payload.role}).then(function(){return e.redirectBack()})}).catch(function(t){return e.loading=!1,e.showToast(t,"error"),L.a.reject(t)}).finally(this.cleanUp)},getLoginCode:function(){return A.fetchJSON(A.apiFor("login","code","gen")).then(function(t){return t.code})},codeLoginTriggers:function(){var t=this;this.codeChecker=setInterval(function(){t.loginCode&&A.fetchJSON(A.apiFor("login","code",t.loginCode),"POST",{},!1).then(function(e){if(e.success){var n=e.data;n.username&&(t.scannedUsername=n.username),n.token&&t.setLoginData({username:n.username,role:n.role,token:n.token}).then(function(){return t.redirectBack()})}}).catch(function(e){t.showToast("Unstable network may affect remote login.","warning")})},3e3),this.codeLoginCleaner=setTimeout(function(){return t.codeLoginCleanUp()},6e4)},codeLogin:function(){var t=this;this.loading=!0,this.loginCode="Loading...",this.getLoginCode().then(function(e){t.loginCode=(Array(6).join("0")+e).slice(-6)}).then(function(e){t.codeLoginTriggers()}).catch(function(e){t.showToast(e,"error"),t.codeLoginCleanUp()})},codeLoginCleanUp:function(){this.codeChecker&&clearInterval(this.codeChecker),this.codeLoginCleaner&&clearTimeout(this.codeLoginCleaner),this.loading=!1,this.loginCode="",this.scannedUsername=""},focusPassword:function(){var t=this;this.rules.map(function(e){return e(t.username)}).every(function(t){return!0===t})&&this.$refs.passWord.focus()},getAdapters:function(){var t=this;A.fetchJSONWithSuccess(A.apiFor("login","oauth","adapters")).then(function(e){t.oauthLogin.adapters=e}).catch(function(e){t.showToast(e,"error")})},redirectOauthLogin:function(t){var e=this;this.oauthLogin.loading=!0,A.fetchJSONWithSuccess(A.apiFor("login","oauth",t,"url"),"GET",{base:window.location.href.split("?")[0],redirect:this.redirection}).then(function(t){e.loading=!0,window.location.href=t}).catch(function(t){e.oauthLogin.loading=!1,e.showToast(t,"error")})}},computed:{redirection:function(){return this.$route.params.redirect||this.$route.query.redirect||A.getRedirect()||"/"},message:function(){return window.sessionStorage.getItem("message")||this.$route.params.message||"Login"},hasOauthAdapter:function(){return this.oauthLogin.adapters.length>0},currentLayer:function(){var t=!!this.loading<<1|!!this.loginCode;return 1&t||2&t}},mounted:function(){var t=this;if(A.getLoginData()&&(this.$route.params.logout?(A.removeLoginData(),this.showToast("Logged out!")):this.redirectBack()),this.$route.params.alert){var e=this.$route.params.alert,n=e.color,a=e.text;this.showToast(a,n)}addEventListener("storage",function(e){"loginData"===e.key&&e.newValue&&t.redirectBack()});var o=A.getArguments.call(this).token;o&&this.tokenLogin(o).catch(function(e){t.getAdapters(),t.$router.replace(Object(b["a"])({},t.$route,{query:Object(b["a"])({},t.$route.query,{token:void 0})}))}),o||this.getAdapters()},destroyed:function(){this.oauthLogin.loading||this.cleanUp(),this.codeLoginCleanUp()}},Ot=Vt,Et=n("0798"),$t=n("4bd4"),jt=n("8e36"),Nt=n("2677"),Ut=n("71d9"),Rt=n("2a7f"),Ft=n("f665"),At=n("1e6c"),It=Object(c["a"])(Ot,Pt,St,!1,null,null,null);It.options.__file="BlogLogin.vue";var Bt=It.exports;u()(It,{VAlert:Et["a"],VBtn:q["a"],VCard:mt["a"],VCardActions:gt["a"],VCardText:gt["b"],VContainer:M["a"],VFlex:W["a"],VForm:$t["a"],VIcon:kt["a"],VLayout:H["a"],VProgressLinear:jt["a"],VSpacer:Dt["a"],VTextField:Nt["a"],VToolbar:Ut["a"],VToolbarTitle:Rt["b"],VWindow:Ft["a"],VWindowItem:At["a"]});var qt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"post"}},[n("nav-bar",{attrs:{userData:t.userData,route:this.$route.fullPath}}),n("v-parallax",{attrs:{id:"main-pic",dark:"",src:t.postData.img||t.config.images.postBannerImage}},[n("v-layout",{class:t.titleClass,attrs:{"align-center":"",column:"","justify-center":""}},[n("h1",{staticClass:"display-2 font-weight-thin mb-3",attrs:{id:"title"}},[t._v(t._s(t.postData.title))]),n("h4",{staticClass:"subheading",attrs:{id:"subtitle"}},[t._v(t._s(t.postData.subtitle))]),n("h4",{staticClass:"subheading",attrs:{id:"date"}},[t._v(t._s(t.formatDate(t.postData.created)||t.postData.date))]),n("h4",{staticClass:"subheading",attrs:{id:"author"}},[t._v(t._s(t.postData.author.nickname))])])],1),n("v-container",{attrs:{"grid-list-md":"",fluid:"","fill-height":""}},[n("v-layout",[n("v-flex",{attrs:{wrap:"",row:"",xs12:"",sm10:"","offset-sm2":""}},[n("v-layout",[t._l(t.postData.tags,function(e){return n("router-link",{key:e,attrs:{to:{name:"index",params:{tag:e},query:{tag:e}}}},[n("v-chip",[t._v(t._s(e))])],1)}),t.postData.secret?n("v-chip",{attrs:{color:"success","text-color":"white"}},[n("v-avatar",[n("v-icon",[t._v("lock")]),t._v(t._s(t.postData.secret)+"\n            ")],1),t._v("\n            Secret\n          ")],1):t._e(),-1===t.postData.id?n("v-chip",{attrs:{color:"warning","text-color":"white"}},[n("v-avatar",[n("v-icon",[t._v("error")])],1),t._v("\n            404\n          ")],1):t._e(),t.postData.hidden?n("v-chip",{attrs:{color:"grey","text-color":"white"}},[n("v-avatar",[n("v-icon",[t._v("visibility_off")])],1),t._v("\n            Hidden\n          ")],1):t._e()],2),n("v-flex",{attrs:{xs10:"",offset:"",xs2:""}},[t.cachedData?n("v-btn",{attrs:{color:"secondary",fab:"",small:""},on:{click:function(e){t.$router.go(-1)}}},[n("v-icon",[t._v("arrow_back")])],1):t._e(),"preview"!==t.postData.id&&-1!==t.postData.id&&t.isEditable?n("v-layout",[n("v-spacer"),n("v-btn",{attrs:{color:"error",fab:"",small:"",to:{name:"edit",params:{deletePost:!0,title:t.postData.title},query:{post:t.postData.id}}}},[n("v-icon",[t._v("delete")])],1),n("v-btn",{attrs:{color:"primary",fab:"",small:"",to:{name:"edit",query:{post:t.postData.id}}}},[n("v-icon",[t._v("mode_edit")])],1)],1):t._e()],1),n("v-layout",[n("v-flex",{class:{sm8:t.hasDigest,sm10:!t.hasDigest}},[n("div",{ref:"content",staticClass:"flow-text responsive-img",attrs:{id:"content"}},[t.rsRendered?n("div",{ref:"rhodonite"}):n("div",{domProps:{innerHTML:t._s(t.postData.content)}})]),t.postData.id<0?n("div",{staticClass:"flow-text"},[n("p",[t._v("Oops, we can not show you the post.")]),n("p",[n("strong",[t._v("This may because:")])]),n("ol",[n("li",[t._v("Your post ID is invalid.")]),n("li",[t._v("This post is secret"),t.userData?n("strong",[t._v(" and even beyond your permission level")]):t._e(),t._v(".")]),t.userData&&t.isTokenExpired?n("li",{staticClass:"warning--text"},[n("v-icon",{attrs:{color:"warning"}},[t._v("warning")]),t._v("Your session is expired.")],1):t._e(),n("li",[t._v("Your network condition is poor.")])]),n("p",[n("strong",[t._v("All you need to do is check your input, refresh your token or try to login again.")])])]):t._e()]),t.hasDigest?n("v-flex",{attrs:{sm2:""}},[n("blog-digest-nav",{attrs:{items:t.postDigest,offset:"500",threshold:"500"}})],1):t._e()],1),n("div",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:t.postData.title,expression:"postData.title"}]})],1)],1)],1),n("v-container",[n("div",{staticClass:"text-xs-center"},[n("h4",{staticClass:"subheading grey--text"},[t._v("Last edit at: "+t._s(t.formatDate(t.postData.lastEdit,!0)))])])]),n("v-container",[n("v-flex",{attrs:{row:"",xs12:"",sm10:"","offset-sm1":""}},[n("v-layout",[-1!==t.postData.next?n("v-btn",{attrs:{color:"primary",fab:"",small:"",to:{name:"post",query:{p:t.postData.next}}}},[n("v-icon",[t._v("chevron_left")])],1):t._e(),n("v-spacer"),-1!==t.postData.prev?n("v-btn",{attrs:{color:"primary",fab:"",small:"",to:{name:"post",query:{p:t.postData.prev}}}},[n("v-icon",[t._v("chevron_right")])],1):t._e()],1)],1),t.isPostFound?n("blog-comments",{attrs:{userData:t.userData,postData:t.postData,toast:t.showToast,renderer:t.renderer}}):t._e()],1),n("v-dialog",{attrs:{"hide-overlay":"",width:"300",lazy:!0,attach:t.preview.attach,origin:t.preview.origin},model:{value:t.preview.show,callback:function(e){t.$set(t.preview,"show",e)},expression:"preview.show"}},[n("v-card",{attrs:{color:t.preview.color,dark:""}},[t.preview.img?n("v-img",{attrs:{src:t.preview.img}}):t._e(),n("v-card-text",[t.preview.loading?t._e():n("div",[n("h1",{staticClass:"title"},[n("strong",[t._v(t._s(t.preview.title))])]),n("v-spacer"),n("h6",{staticClass:"subheading text-truncate"},[t._v(t._s(t.preview.subtitle))])],1),t.preview.loading?n("v-progress-linear",{staticClass:"mb-0",attrs:{indeterminate:"",color:"white"}}):t._e()],1)],1)],1),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1)),n("blog-footer")],1)},Mt=[],Jt=(n("3b2b"),n("774e")),Wt=n.n(Jt),Ht=(n("ac6a"),n("96cf"),n("3b8d")),Yt=(n("c5f6"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"digestNav",staticClass:"hide-on-small-only pushpin",attrs:{id:"digest-nav"}},[n("ul",{staticClass:"section table-of-contents"},t._l(t.items,function(e){var a=e.hash,o=e.title;return n("li",{key:a},[n("a",{attrs:{href:"#"+a,to:{hash:a,query:t.$route.query}}},[t._v(t._s(o))])])}),0)])}),zt=[],Gt=n("4d5c"),Xt=n.n(Gt),Zt={name:"blog-digest-nav",data:function(){return{}},props:{items:Array},methods:{onCreate:function(){var t=this;this.$nextTick(function(e){return t.processDigest()})},processDigest:function(){var t=document.querySelectorAll(".scrollspy"),e=document.getElementById("content");this.instance=Xt.a.ScrollSpy.init(t),Xt.a.Pushpin.init(document.querySelectorAll(".pushpin"),{top:e.offsetTop,offset:150,bottom:e.offsetHeight+e.offsetTop-this.$refs.digestNav.offsetHeight})},getInstance:function(){return Xt.a.ScrollSpy.getInstance(this.targetElements())}},computed:{targetElements:function(){return this.items.map(function(t){return t.element})}},mounted:function(){this.onCreate()},destroyed:function(){this.getInstance().destroy()},watch:{items:function(){this.onCreate()}}},Kt=Zt,Qt=(n("c389"),n("c293"),Object(c["a"])(Kt,Yt,zt,!1,null,"6e2088a0",null));Qt.options.__file="BlogDigestNav.vue";var te=Qt.exports,ee=(n("f559"),n("7f7f"),n("0a0d")),ne=n.n(ee),ae=n("2d7d"),oe=n.n(ae),re=n("d225"),se=n("b0b4"),ie=n("67bb"),ce=n.n(ie),le=n("6609"),ue=n.n(le),de=n("8feb"),he=n.n(de),fe=n("1b81"),ve=n.n(fe),pe=(n("aef6"),function t(e,n){Object(re["a"])(this,t),this.template=e,this.returnValue=n}),me=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{attrs:{row:"","justify-center":""}},[n("v-dialog",{attrs:{width:"400"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v(t._s(t.title))]),n("v-card-text",[t._v("\n        "+t._s(t.message)+"\n      ")]),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary"},on:{click:t.commitReject}},[t._v("\n          Disagree\n        ")]),n("v-btn",{attrs:{color:"primary",flat:""},on:{click:t.commitConfirm}},[t._v("\n          Agree\n        ")])],1)],1)],1)],1)},ge=[],we=n("308d"),be=n("6bb5"),ke=n("4e2b"),ye=n("9ab4"),_e=n("60a3"),xe=function(t){function e(){var t;return Object(re["a"])(this,e),t=Object(we["a"])(this,Object(be["a"])(e).apply(this,arguments)),t.dialog=!0,t.isConfirmed=!1,t}return Object(ke["a"])(e,t),Object(se["a"])(e,[{key:"onDialogChanged",value:function(t,e){e||(this.isConfirmed||this.onReject(),this.$destroy(),this.cleanUp&&this.cleanUp())}},{key:"commitConfirm",value:function(){this.isConfirmed=!0,this.onConfirm(),this.dialog=!1}},{key:"commitReject",value:function(){this.isConfirmed=!1,this.onReject(),this.dialog=!1}}]),e}(_e["c"]);ye["a"]([Object(_e["b"])(Function)],xe.prototype,"onConfirm",void 0),ye["a"]([Object(_e["b"])(Function)],xe.prototype,"onReject",void 0),ye["a"]([Object(_e["b"])(Function)],xe.prototype,"cleanUp",void 0),ye["a"]([Object(_e["b"])(String)],xe.prototype,"title",void 0),ye["a"]([Object(_e["b"])(String)],xe.prototype,"message",void 0),ye["a"]([Object(_e["d"])("dialog")],xe.prototype,"onDialogChanged",null),xe=ye["a"]([_e["a"]],xe);var De=xe,Ce=De,Te=n("169a"),Pe=Object(c["a"])(Ce,me,ge,!1,null,null,null);Pe.options.__file="CustomDialog.vue";var Se=Pe.exports;u()(Pe,{VBtn:q["a"],VCard:mt["a"],VCardActions:gt["a"],VCardText:gt["b"],VCardTitle:wt["a"],VDialog:Te["a"],VLayout:H["a"],VSpacer:Dt["a"]});var Le=function(t,e){return new a["default"]({render:function(e){return e(Se,{props:t})}}).$mount(e)};function Ve(t){if(!window.APlayer){var e=document.createElement("script"),n=document.createElement("link");n.rel="stylesheet",n.href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css",e.async=!0,e.onload=t||null,e.src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js",document.head.appendChild(n),document.body.appendChild(e)}}function Oe(t){var e=document.createElement("div");return e.innerHTML=t.replace(/<em>(.*?)<\/em>/,function(t,e){return"*".concat(e,"*")}),e.innerText||e.textContent}function Ee(t){return t instanceof Array?t.map(Ee).join(""):(t instanceof pe&&(t=t.template),t instanceof HTMLElement?t.outerHTML:U["isNumber"](t)||U["isString"](t)?t:"")}function $e(t,e,n){return t.replace(new RegExp((e||["{{","}}"]).join("\\s*?(([\\s\\S]+?))\\s*?"),"gm"),n)}function je(t,e,n){var a=function(t){return"with(data) { with(functions) {return (".concat(t,");}}")},o=function(t){if(!C.enableRoseliaScript)return"<pre><code>".concat(t,"</code></pre>");try{var n,o=/([a-zA-Z_$]+[a-zA-Z_0-9]*){([\s\S]+)}/.exec(t),r=!1;if(o){var s=Object(nt["a"])(o,3),i=(s[0],s[1]),c=s[2],l=e[i]||e.functions[i];U["isFunction"](l)&&(n=l(Oe(c)),r=!0)}return r||(t=Oe(t),n=new Function("data",a(t))(e)),Ee(n)}catch(u){return console.log("On rendering:",t),console.error(u),t}};return $e(t,n,function(t,e){var n=e.trim(),a=!n.endsWith(";"),r=a?n:n.substring(0,n.length-1),s=o(r);return a?s:""})}function Ne(t,e){var n=new ve.a;if(e){var a=function(t){return new Proxy({},{get:function(){return null}})};e.forEach(function(e){return t[e]=a(e)})}var o={get:function(t,e){var a=he()(t,e);return U["isFunction"](a)?(n.has(a)||n.set(a,a.bind(t)),n.get(a)):a}};return new Proxy(t,o)}function Ue(t){return new Proxy(t,{has:function(t,e){return!0},get:function(t,e){if(e!==ue.a)return he()(t,e)}})}var Re=ce()("yukina"),Fe=function(){function t(e){Object(re["a"])(this,t),this.app=e,this.scriptEvaluator=new Ae(e),this.context=Ue(Ne(this.scriptEvaluator))}return Object(se["a"])(t,[{key:"render",value:function(e){this.scriptEvaluator.pendingFunctions=[];try{this.toInject=this.app;var n=je(e,this.context,t.roseliaScriptDelim);return n}catch(a){return console.error(a),e}}},{key:"cleanScript",value:function(e){return $e(e,t.roseliaScriptDelim,function(t){return""})}},{key:"renderAsync",value:function(){var t=Object(Ht["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new L.a(function(t){return t(n.render(e))}).then(function(t){return t}));case 1:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"renderVue",value:function(t){var e=this,n=this.scriptEvaluator.randomID(),o=new a["default"]({template:'<div id="'.concat(n,'">')+this.render(t)+"</div>",data:this.scriptEvaluator.functions,delimiters:["v{{","}}"]});return this.toInject=o,Object.defineProperty(o,"aotoInject",{value:function(){o.$mount(document.getElementById(n)),o.$nextTick(function(){return e.injectEvents()})}}),o}},{key:"renderVueAsync",value:function(){var t=Object(Ht["a"])(regeneratorRuntime.mark(function t(e){var n=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new L.a(function(t){return t(n.renderVue(e))}));case 1:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}()},{key:"injectEvents",value:function(){this.scriptEvaluator.injectEventsOn(this.toInject)}},{key:"pushContext",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"context";return this.scriptEvaluator.def(n,t),function(){e.scriptEvaluator.undef(n)}}},{key:"pushMethod",value:function(t,e){var n=this;return this.pushContext(function(){return t(n.context).apply(void 0,arguments)},e)}}]),t}();Fe.roseliaScriptDelim=["(?:Roselia|roselia|r|R){{","}}"];var Ae=function(){function t(e){var n=this;Object(re["a"])(this,t),this.Y=function(t){return function(t){return t(t)}(function(e){return t(function(t){return e(e)(t)})})},this.request={get:function(t,e){return n.askForAccess("fetch","This post would like to fetch data","It wants to access ".concat(t,".")).then(function(){return N.get(t,{params:e}).then(function(t){return t.data})})}},this.app=e,this.customFunctions={app:null},this.functions=Ne(this.customFunctions),this.app.$on("postUnload",function(){n.customFunctions={app:null},n.functions=Ne(n.customFunctions),n.mounted=!1}),this.askAccess=new oe.a,this.pendingFunctions=[],this.mounted=!1}return Object(se["a"])(t,[{key:"then",value:function(t){this.mounted?this.app.$nextTick(t):this.pendingFunctions.push(t)}},{key:"injectEventsOn",value:function(t){this.pendingFunctions.forEach(function(){var e=Object(Ht["a"])(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",t.$nextTick(n));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),this.pendingFunctions=[],this.mounted=!0}},{key:"music",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0;Ve(function(){return e.app.$emit("aPlayerLoaded")});var o,r=this.randomID();return this.then(function(){var s=function(){var e=document.getElementById(r);o=new window.APlayer({container:e,narrow:!1,autoplay:n,mutex:!0,theme:C.theme.accent,mode:"circulation",showlrc:1,preload:"metadata",audio:t}),o.on("loadstart",function(){Wt()(e.getElementsByClassName("aplayer-title")).forEach(function(t){t&&(t.style.color=C.theme.secondary)}),a&&a(o)})};window.APlayer?e.then(s):e.app.$once("aPlayerLoaded",function(){e.then(s)}),e.app.$once("postUnload",function(){o.destroy()})}),new pe('<div id="'.concat(r,'"></div>'),o)}},{key:"heimu",value:function(t){var e=this.randomID();return new pe('<span class="heimu" id="'.concat(e,'">').concat(t,"</span>"),e)}},{key:"cite",value:function(t,e){return'<a href="post?p='.concat(e,'">').concat(t,"</a>")}},{key:"randomID",value:function(t){return Number(Math.random().toString().substring(3,t)+ne()()).toString(36)}},{key:"onceLoad",value:function(t){this.app.$once("postLoaded",t)}},{key:"onceUnload",value:function(t){this.app.$once("postUnload",t)}},{key:"extendAttributes",value:function(t,e){this.element(t).then(function(t){U["merge"](t,e)})}},{key:"btn",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3?arguments[3]:void 0,o=this.randomID();return n instanceof Array&&(n=n.join(" ")),e&&this.then(function(){document.getElementById(o).addEventListener("click",e)}),a&&this.extendAttributes(o,a),new pe('<button id="'.concat(o,'" class="v-btn ').concat(n,'">').concat(t,"</button>"),o)}},{key:"toast",value:function(t,e){this.app.showToast(t,e||"info")}},{key:"formula",value:function(t){return"$ ".concat(t," $")}},{key:"formulation",value:function(t){return"$$ ".concat(t," $$")}},{key:"formulationEscape",value:function(){var t=this,e=[["$$","$$"],["$","$"],["\\(","\\)"]];e.map(function(t){return t.map(function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}).join("\\s*(.*?)\\s*")}).map(function(t){return new RegExp(t,"gms")}).forEach(function(e){t.app.postData.content=t.app.postData.content.replace(e,function(t,e){return Oe(e)})})}},{key:"importJS",value:function(t,e){var n=document.createElement("script");n.onload=e,n.async=!0,n.src=t,document.body.appendChild(n)}},{key:"def",value:function(t,e){return e instanceof pe?(this.customFunctions[t]=e.returnValue,e.template):(this.customFunctions[t]=e,U["isString"](e)||e instanceof HTMLElement?e:void 0)}},{key:"undef",value:function(t){this.customFunctions[t]=void 0}},{key:"audio",value:function(t){var e=this.randomID();return new pe("<audio id='".concat(e,"' src='").concat(t,"' hidden='true'/>"),e)}},{key:"getElement",value:function(t){if(t instanceof HTMLElement&&(t=t.id),t instanceof pe&&(t=U["isString"](t.returnValue)?t.returnValue:t.template),U["isString"](t)){var e=/id=['"]([a-zA-Z0-9-]+)['"]/.exec(t);e&&(t=e[1])}t instanceof HTMLElement&&(t=t.id);var n=t in this.functions?this.functions[t]:t;return document.getElementById(n instanceof Element?n.id:n)}},{key:"raw",value:function(t){return"<pre>Roselia{{".concat(t,"}}</pre>")}},{key:"previewColor",value:function(t){var e=this,n=this.app.preview.color;this.app.preview.color=t,this.onceUnload(function(){e.app.preview.color=n})}},{key:"element",value:function(t){var e=this;return new L.a(function(n,a){e.then(function(){var o=e.getElement(t);o?n(o):a()})})}},{key:"createElement",value:function(t,e){var n=document.createElement(t);return n.id=this.randomID(),e&&this.extendAttributes(n,e),n}},{key:"setPreview",value:function(t,e){var n=this;this.element(t).then(function(t){t.addEventListener("mouseover",function(a){a.preventDefault(),n.app.preview.show=!0,n.app.preview.attach=t,n.app.preview.cacheData=null,n.app.preview.current=n.app.postData.id,["title","subtitle","img","color"].forEach(function(t){var a=e[t];U["isNil"](a)||(n.app.preview[t]=a)})}),t.addEventListener("mouseout",function(t){t.preventDefault(),n.app.preview.show=!1}),U["isNil"](e.goTo)||t.addEventListener("click",function(t){t.preventDefault(),n.app.$vuetify.goTo(U["isNumber"](e.goTo)?e.goTo:n.getElement(e.goTo),{offset:-200}).catch(function(t){U["isString"](e.goTo)?location.href=e.goTo:n.app.$router.push(e.goTo),console.error(t)})})})}},{key:"previewed",value:function(t,e){return this.setPreview(t,e),t}},{key:"doTo",value:function(t,e){return this.element(t).then(e),t}},{key:"icon",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(e instanceof Array&&(e=e.join(" ")),t.startsWith("fa")){var n=t.split("-"),a=Object(nt["a"])(n,2),o=a[0],r=a[1];return'<i aria-hidden="true" class="v-icon '.concat(o," fa-").concat(r," ").concat(e,'"></i>')}return'<i aria-hidden="true" class="v-icon material-icons '.concat(e,'">').concat(t,"</i>")}},{key:"askForAccess",value:function(t,e,n){var a=this;return new L.a(function(o,r){if(a.onceUnload(function(){return a.askAccess.clear()}),a.askAccess.has(t))a.askAccess.get(t)?o():r();else{var s=a.createElement("div");document.getElementById("content").appendChild(s),Le({onConfirm:function(){o(),a.askAccess.set(t,!0)},onReject:function(){r(),a.askAccess.set(t,!1)},cleanUp:function(){document.getElementById("content").removeChild(s)},title:e,message:n},s)}}).then(function(){a.toast("Operation ".concat(t," granted"),"success")}).catch(function(){return a.toast("Operation ".concat(t," rejected"),"error"),L.a.reject(new Error("User rejected"))})}},{key:"askForToken",value:function(){return this.askForAccess("token","This post wish to access your personal info","This post needs to access your token to make requests.")}},{key:"roseliaApi",value:function(){for(var t=this,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return function(){var e=Object(Ht["a"])(regeneratorRuntime.mark(function e(a){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.askForToken();case 2:return e.abrupt("return",A.fetchJSON(A.apiFor.apply(A,n),"GET",a));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},{key:"nil",value:function(){return null}},{key:"forceChangeTheme",value:function(t,e){e===Re&&P()(this.app.$vuetify.theme,t)}},{key:"currentTheme",value:function(){return Object(b["a"])({},this.app.$vuetify.theme)}},{key:"changeTheme",value:function(t){var e=this;this.askForAccess("theme","This post would like to change your theme","Changes will discard after refresh").then(function(){e.forceChangeTheme(t,Re)})}},{key:"changeThemeOnce",value:function(t){var e=this,n=this.currentTheme();P()(this.app.$vuetify.theme,t),this.onceUnload(function(){e.forceChangeTheme(n,Re)})}},{key:"resetTheme",value:function(){this.changeThemeOnce(C.theme)}},{key:"saveCurrentTheme",value:function(){var t=this,e=this.currentTheme();this.askForAccess("theme","This post would like to save your current theme.","Changes will discard after refresh").then(function(){t.onceUnload(function(){t.forceChangeTheme(e,Re)})})}}]),t}(),Ie={RoseliaRenderer:Fe,createRenderer:function(t){return new Fe(t)}},Be=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("lazy-component",{attrs:{text:"Load comment"}},[n("v-container",[t.canAddComment?n("v-flex",{attrs:{xs10:"",sm7:"","offset-sm2":""}},[n("v-badge",[t.commentCount?n("span",{attrs:{slot:"badge"},slot:"badge"},[t._v(t._s(t.commentCount))]):t._e(),n("v-icon",[t._v("\n          mode_comment\n        ")])],1),n("v-divider",{staticClass:"my-3"}),t.replyToComment?n("v-chip",{attrs:{close:"",color:"secondary",dark:""},model:{value:t.chip,callback:function(e){t.chip=e},expression:"chip"}},[t._v("\n        @"+t._s(t.atToNickname)+"\n      ")]):t._e(),n("v-textarea",{ref:"commentText",attrs:{"auto-grow":"",outline:"",placeholder:t.commentPlaceholer,color:"primary",label:"Leave a comment"},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}}),n("v-layout",{attrs:{row:"",wrap:""}},[n("v-flex",{attrs:{xs4:""}},[t.userData&&t.userData.nickname?n("span",[t._v(t._s(t.userData.nickname))]):n("v-text-field",{attrs:{small:"",label:"Nickname"},model:{value:t.nickname,callback:function(e){t.nickname=e},expression:"nickname"}})],1),n("v-spacer"),n("v-flex",{attrs:{xs2:""}},[n("v-btn",{attrs:{color:"primary",disabled:!this.isValid,loading:t.loading},on:{click:t.addComment}},[n("v-icon",[t._v("send")])],1)],1)],1)],1):t._e(),n("v-flex",{ref:"comments",attrs:{xs10:"",sm7:"","offset-sm2":""}},[n("v-timeline",{attrs:{dense:"",clipped:""}},[n("v-slide-x-transition",{attrs:{group:""}},t._l(t.commentList,function(e){return n("v-timeline-item",{key:e.id,staticClass:"mb-3",attrs:{color:e.color||(e.author?"accent":"#bbbbbb"),id:"comment-"+e.id}},[n("v-layout",{attrs:{"justify-space-between":""}},[n("v-flex",{attrs:{xs7:""}},[n("v-chip",{staticClass:"white--text ml-0",attrs:{color:e.color||(e.author?"secondary":"#bbbbbb"),label:"",small:""}},[t._v("\n                  "+t._s(e.nickname||e.author.nickname)+"\n                ")]),e.replyTo?n("v-card",{staticClass:"mt-3 mx-auto"},[n("v-card-title",[n("div",{staticClass:"title font-weight-light mb-2"},[t._v("@"+t._s(t.getCommentNickname(t.getCommentOrNotFound(e.replyTo))))])]),n("v-slide-y-transition",[n("v-card-text",{directives:[{name:"show",rawName:"v-show",value:e.showReply,expression:"item.showReply"}],staticClass:"pt-0"},[n("div",{staticClass:"subheading font-weight-light grey--text",domProps:{innerHTML:t._s(t.getCommentOrNotFound(e.replyTo).cleanedContent||t.getCommentOrNotFound(e.replyTo).content)}})])],1),n("v-divider",{staticClass:"my-2"}),n("v-card-actions",[n("v-btn",{attrs:{flat:"",icon:"",small:""},on:{click:function(t){e.showReply=!e.showReply}}},[n("v-icon",[t._v("keyboard_arrow_"+t._s(e.showReply?"up":"down"))])],1),n("v-btn",{attrs:{flat:"",icon:"",small:""},on:{click:function(n){t.$vuetify.goTo("#comment-"+t.getCommentOrNotFound(e.replyTo).id)}}},[n("v-icon",[t._v("mode_comment")])],1),n("v-spacer"),n("v-icon",{staticClass:"mr-2"},[t._v("\n                      date_range\n                    ")]),n("span",{staticClass:"caption grey--text font-weight-light"},[t._v(t._s(t.formatDate(t.getCommentOrNotFound(e.replyTo).createdAt)))])],1)],1):t._e(),n("div",{domProps:{innerHTML:t._s(e.content)}}),t.canAddComment?n("v-btn",{attrs:{flat:"",icon:""},on:{click:function(n){t.replyToComment=e.id}}},[n("v-icon",[t._v("reply")])],1):t._e()],1),n("v-flex",{attrs:{xs5:"","text-xs-right":""}},[t._v("\n                "+t._s(t.formatDate(e.createdAt))+"\n                "),t.canDeleteComment(e)?n("v-btn",{attrs:{fab:"",color:"error",small:""},on:{click:function(n){t.deleteComment(e.id)}}},[n("v-icon",[t._v("delete")])],1):t._e()],1)],1)],1)}),1)],1)],1),n("v-layout",{attrs:{"align-center":"",column:"","justify-center":""}},[n("v-chip",{staticClass:"white--text ml-0 center-align",attrs:{color:"secondary",label:"",small:""},on:{click:function(e){t.$vuetify.goTo(t.$refs.commentText)}}},[n("v-icon",[t._v("add_comment")])],1),t.currentPage<t.totalPages?n("div",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:t.loadNextPage,expression:"loadNextPage"}]},[n("v-btn",{attrs:{loading:t.loading,small:"",block:"",color:"secondary",dark:""},on:{click:t.loadNextPage}},[n("v-icon",[t._v("keyboard_arrow_down")])],1)],1):t.loading?n("div",[n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):n("div",[n("v-divider"),t._v("\n        Tiro finale\n      ")],1)],1)],1)],1)},qe=[],Me=n("2f62"),Je=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.visible?n("div",[t._t("default")],2):n("div",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:t.setVisible,expression:"setVisible"}]},[n("v-layout",{attrs:{"align-center":"","justify-center":""}},[n("v-btn",{on:{click:t.setVisible}},[t._v(t._s(this.text))])],1)],1)])},We=[],He={props:["text"],name:"lazy-component",data:function(){return{visible:!1}},methods:{setVisible:function(){this.visible=!0}}},Ye=He,ze=Object(c["a"])(Ye,Je,We,!1,null,null,null);ze.options.__file="lazyComponent.vue";var Ge=ze.exports;u()(ze,{VBtn:q["a"],VLayout:H["a"]});var Xe={components:{lazyComponent:Ge},props:["userData","postData","toast","renderer"],name:"blog-comment",data:function(){return{visible:!1,chip:!1,comment:"",nickname:"",commentLeft:!1,loading:!1,currentPage:0,totalPages:1,commentCount:0,commentList:[],replyToComment:void 0,hasUnsafedDraft:!1}},methods:Object(b["a"])({},Object(Me["b"])(["setCommentDraft","removeCommentDraft"]),{getCommentDraft:function(t){return this.$store.state.commentDraft[t]},setVisible:function(){this.visible=!0},formatDate:function(t){return A.formatDate(t)},addComment:function(){var t=this;this.loading=!0,A.fetchJSONWithSuccess(A.apiFor("comment","add"),"POST",this.addPostForm).then(function(e){t.toast("Well, you placed a comment!","success"),t.loading=!1,t.removeCommentDraft(t.postData.id),t.cleanUp(),t.loadNextPage()}).catch(function(e){t.toast(e,"error"),t.loading=!1})},cleanUp:function(){this.currentPage=0,this.totalPages=1,this.commentCount=0,this.commentList=[],this.comment="",this.replyToComment=void 0,this.commentLeft=!1},deleteComment:function(t){var e=this;A.fetchJSONWithSuccess(A.apiFor("comment","delete"),"POST",{comment:t}).then(function(n){e.commentList=e.commentList.filter(function(e){return e.id!==t}),--e.commentCount}).catch(function(t){e.toast("Oops! Failed.","error")})},canDeleteComment:function(t){return!!this.isLoggedIn&&(!t.author||t.author.role<=this.userData.role)},loadNextPage:function(){var t=this;this.loading||this.currentPage>=this.totalPages||(this.loading=!0,A.fetchJSON(A.apiFor("comment","comments"),"GET",{p:this.postData.id,page:this.currentPage+1,limit:10}).then(function(t){return t.success?t:L.a.reject("Invalid postid")}).then(function(e){t.commentList=t.commentList.concat(e.result.map(ut).map(function(t){return Object(b["a"])({},t,{showReply:!1})})),t.totalPages=e.pages,t.commentCount=e.total,++t.currentPage,t.loading=!1,t.renderScript(),t.$nextTick(function(){t.processComments(),t.hasUnsafedDraft=!1})}).catch(function(e){t.toast(e,"error"),t.loading=!1}))},getComment:function(t){return this.commentDict[t]},getCommentOrNotFound:function(t){var e=this.getComment(t);return e||(this.loadNextPage(),{id:0,nickname:"Anoymous",content:"This comment is gone.",createdAt:new Date})},getCommentNickname:function(t){return t.nickname||ht("author","nickname")(t)},processComments:function(){var t=this,e=Wt()(this.$refs.comments.querySelectorAll("a")).filter(function(t){return!!t.href}),n=["mohuety.com","roselia.moe","roselia.xyz","lisa.moe","roselia.app"].map(function(t){return new RegExp(t)});e.filter(function(t){return!t.getAttribute("roselia-prevented")}).filter(function(t){return t.host!==location.host&&!n.some(function(e){return e.exec(t.host)})}).forEach(function(){var e=Object(Ht["a"])(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n.setAttribute("roselia-prevented",!0),n.addEventListener("click",function(e){e.preventDefault(),t.renderer.context.askForAccess(n.host,"This link wish to visit an unknown host ".concat(n.host),"The link is ".concat(n.href," please make sure it is safe.")).then(function(){window.open(n.href)})});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var a=this.$refs.comments.querySelectorAll("img"),o=Wt()(a);o.forEach(function(t){t.classList.add("responsive-img")}),Xt.a.Materialbox.init(a)},renderScript:function(){var t=this;this.commentList.filter(function(t){return t.author}).filter(function(t){return!t.rendered}).forEach(function(e){var n=t.renderer.pushContext(e,"comment");e.cleanedContent=t.renderer.cleanScript(e.content);var a=t.renderer.render(e.content);e.content=a,e.rendered=!0,t.renderer.injectEvents(),n()})},onExit:function(t){this.hasUnsafedDraft&&this.setCommentDraft({commentId:t||this.postData.id,comment:{comment:this.comment,nickname:this.nickname}})},loadDraft:function(t){var e=this.getCommentDraft(t||this.postData.id);e&&(this.comment=e.comment||this.comment,this.nickname=e.nickname||this.nickname)}}),computed:{commentPlaceholer:function(){return this.commentLeft?"It is fine to keep silent, dear ".concat(this.currentNickname,"."):"Say something."},currentNickname:function(){return this.userData&&this.userData.nickname||this.nickname},isValid:function(){return this.comment&&this.currentNickname},isLoggedIn:function(){return!!this.userData},addPostForm:function(){return dt({toPost:this.postData.id,content:this.comment,nickname:this.isLoggedIn?void 0:this.currentNickname,toComment:this.replyToComment||void 0})},canAddComment:function(){return this.userData||this.postData.enableComment},commentDict:function(){return this.commentList.reduce(function(t,e){return Object(b["a"])({},t,Object(et["a"])({},e.id,e))},{})},atToNickname:function(){var t=this.getComment(this.replyToComment);return t&&this.getCommentNickname(t)}},watch:{comment:function(){this.commentLeft=!0,this.hasUnsafedDraft=!0},replyToComment:function(t){t&&(this.$vuetify.goTo(this.$refs.commentText),this.chip=!0)},chip:function(t){t||(this.$vuetify.goTo("#comment-"+this.replyToComment),this.replyToComment=void 0)},postData:function(t,e){this.onExit(e.id),this.cleanUp(),this.loadDraft(t.id)}},mounted:function(){this.loadDraft()},beforeDestroy:function(){this.onExit()}},Ze=Xe,Ke=n("4ca6"),Qe=n("a844"),tn=n("8414"),en=n("1e06"),nn=Object(c["a"])(Ze,Be,qe,!1,null,null,null);nn.options.__file="comments.vue";var an=nn.exports;u()(nn,{VBadge:Ke["a"],VBtn:q["a"],VCard:mt["a"],VCardActions:gt["a"],VCardText:gt["b"],VCardTitle:wt["a"],VChip:bt["a"],VContainer:M["a"],VDivider:J["a"],VFlex:W["a"],VIcon:kt["a"],VLayout:H["a"],VProgressCircular:Y["a"],VSlideXTransition:f["e"],VSlideYTransition:f["f"],VSpacer:Dt["a"],VTextField:Nt["a"],VTextarea:Qe["a"],VTimeline:tn["a"],VTimelineItem:en["a"]});var on={components:{BlogDigestNav:te,BlogComments:an},name:"blog-post",props:{p:Number},data:function(){return{postData:{img:"",id:0,displayId:"",content:"<p>Loading, please wait...</p>",author:{nickname:""},darkTitle:!1,next:-1,prev:-1,secret:0,title:"Loading...",subtitle:"",tags:[""],date:(new Date).toDateString()},userData:A.getLoginData(),postDigest:[],preview:{show:!1,loading:!1,current:0,title:"",subtitle:"",attach:"",origin:"center center",img:"",cacheData:null,color:"secondary"},cachedData:!1,renderer:null,toast:A.getToastOption(),rsRendered:!1}},methods:{showToast:A.showToast,changeToast:function(t){this.toast.show=t},getArguments:A.getArguments,formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return A.formatDate(t,e)},loadContent:function(t,e){var n=this;if(t=t||this.getPostNum(),e=e||this.$route,e&&e.params.data){var a=e.params.data;if("preview"===a.id||a.id==t)return this.postData=Object(b["a"])({},this.notFoundData(),a),this.cachedData=!0,void this.processContent()}var o=e&&e.params.postLink;o&&(t=e.params.postLink),this.cachedData=!1,-1!==t?A.fetchJSON(A.apiFor(o?"post-link":"post",t)).then(function(t){return t?(n.postData=ut(t),n.processContent()):L.a.reject(ReferenceError("NPE"))}).catch(function(t){n.postData=n.notFoundData()}):this.postData=this.notFoundData()},processContent:function(){var t=this;this.$route.query.p&&this.postData.displayId&&this.$router.replace({name:"postWithEternalLink",params:{postLink:this.postData.displayId,doNotLoad:!0}}),this.renderer.renderAsync(this.postData.content).then(function(e){t.postData.content=e,t.$nextTick(function(){return t.renderer.injectEvents()})}).then(function(){return t.$nextTick(Object(Ht["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",t.afterContentMounted());case 1:case"end":return e.stop()}},e,this)})))})},afterContentMounted:function(){var t=this,e=this.$refs.content.querySelectorAll("img");Wt()(e).forEach(function(t){t.classList.add("responsive-img")}),Xt.a.Materialbox.init(e),this.setDigest();var n=new RegExp("".concat(location.host,"/.*\\?p=(\\d+)")),a=Wt()(this.$refs.content.querySelectorAll("a")).filter(function(t){return!!t.href});a.filter(function(t){return t.host===location.host}).forEach(function(){var e=Object(Ht["a"])(regeneratorRuntime.mark(function e(a){var o,r,s,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:o=a.href,r=n.exec(o),r&&(s=r[1],i=a.hash,a.addEventListener("click",function(e){e.preventDefault(),i?t.$vuetify.goTo(document.getElementById(a.hash.substring(1)),{offset:-200}):t.$router.push({name:"post",query:{p:s},params:{data:t.preview.current==s&&!t.preview.loading&&t.preview.cacheData||void 0}})},!0),a.addEventListener("mouseover",function(){var e=Object(Ht["a"])(regeneratorRuntime.mark(function e(n){var o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t.preview.show=!0,t.preview.attach=a,!i){e.next=10;break}return t.preview.cacheData=null,t.preview.current=s,o=document.getElementById(a.hash.substring(1)),t.preview.title=o.innerText,t.preview.img="",-1!==a.hash.indexOf("ref")?t.preview.subtitle=o.parentElement.innerText:t.preview.subtitle="",e.abrupt("return");case 10:if(t.preview.current!==s||t.preview.loading||!t.preview.cacheData){e.next=13;break}return t.preview.current=s,e.abrupt("return");case 13:t.preview.current=s,t.preview.loading=!0,t.preview.img="",A.fetchJSON(A.apiFor("post",s)).then(function(e){if(!e)return t.preview.loading=!1,t.preview.title="Oops! :(",t.preview.subtitle="This is a secret",void(t.preview.img="");t.preview.cacheData=e,t.preview.loading=!1,t.preview.title=e.title,t.preview.subtitle=e.subtitle,t.preview.img=e.img}).catch(function(e){t.preview.loading=!1,t.preview.cacheData=null,t.preview.title=":(",t.preview.subtitle=e.message,t.preview.img=""});case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),a.addEventListener("mouseout",function(e){t.preview.show=!1}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),this.highlightLanguage(),this.renderWithMathJax(),this.$emit("postLoaded")},highlightLanguage:function(){window.hljs&&(window.hljs.initHighlighting.called=!1,window.hljs.initHighlighting())},renderWithMathJax:function(){window.MathJax&&window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,"output"])},getPostNum:function(){return this.getArguments().p||-1},notFoundData:function(){return{img:"",id:-1,content:"",next:-1,prev:-1,secret:0,title:"Page Not Found",subtitle:"Please check your post-id. Or try to login.",author:{nickname:""},darkTitle:!1,tags:[],created:new Date,lastEdit:new Date}},setDigest:function(){this.postDigest=Wt()(this.$refs.content.querySelectorAll("h1,h2,h3")).map(function(t,e){return t.classList.add("scrollspy"),t.classList.add("section"),t.id=t.id||"section-".concat(e),{hash:t.id,title:t.innerHTML,element:t}})}},computed:{hasDigest:function(){return this.postDigest.length>0},isTokenExpired:function(){return A.isTokenExpired(this.userData&&this.userData.token)},titleClass:function(){return"".concat(["white","black"][+this.postData.darkTitle],"--text")},isEditable:function(){return!(!this.postData.author||!this.userData)&&this.userData.role>=this.postData.author.role},isPostFound:function(){return this.postData.id>0}},mounted:function(){var t=this;if(this.renderer=Ie.createRenderer(this),this.loadContent(),window.addEventListener("storage",function(e){"loginData"===e.key&&(t.userData=A.getLoginData())}),!window.MathJax){var e=document.createElement("script");e.async=!0,e.src="https://cdn.bootcss.com/mathjax/2.7.3/latest.js?config=TeX-MML-AM_CHTML";var n=document.createElement("script");n.type="text/x-mathjax-config",n.innerHTML="MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']]}});",document.body.appendChild(n),document.body.appendChild(e)}},beforeRouteUpdate:function(t,e,n){return t.params.doNotLoad?n():t.query.p===e.query.p&&t.params.postLink==e.params.postLink?n():(this.$vuetify.goTo(0),this.$emit("postUnload"),this.loadContent(t.query.p,t),void n())},destroyed:function(){this.$emit("postUnload")},watch:{userData:function(){!this.userData&&this.postData.secret&&(this.postData=this.notFoundData()),-1===this.postData.id&&this.loadContent()},"window.MathJax":function(){this.renderWithMathJax()}}},rn=on,sn=(n("8f84"),Object(c["a"])(rn,qt,Mt,!1,null,"0734ae6d",null));sn.options.__file="BlogPost.vue";var cn=sn.exports;u()(sn,{VAvatar:pt["a"],VBtn:q["a"],VCard:mt["a"],VCardText:gt["b"],VChip:bt["a"],VContainer:M["a"],VDialog:Te["a"],VFlex:W["a"],VIcon:kt["a"],VImg:yt["a"],VLayout:H["a"],VParallax:xt["a"],VProgressLinear:jt["a"],VSpacer:Dt["a"]});var ln=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("blog-toolbar",{attrs:{userData:t.userData}}),n("v-container",{attrs:{"grid-list-md":"",fluid:"","fill-height":""}},[n("v-layout",[n("v-flex",{attrs:{xs12:"",sm8:"","offset-sm2":""}},[n("h1",{staticClass:"display-3"},[t._v(t._s(t.realTitle))]),n("v-layout",[n("v-spacer"),n("v-tooltip",{attrs:{bottom:""}},[n("v-btn",{attrs:{slot:"activator",color:"secondary",fab:"",small:"",to:{name:"post",params:{data:t.getPreviewData()}}},slot:"activator"},[n("v-icon",[t._v("visibility")])],1),n("span",[t._v("Preview the post. Note that the link can be used only once.")])],1)],1),n("v-form",{ref:"form",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{label:"Title","prepend-icon":"title",required:"",rules:[function(t){return!!t||"Title is required"}]},model:{value:t.postData.title,callback:function(e){t.$set(t.postData,"title",e)},expression:"postData.title"}}),n("v-text-field",{attrs:{label:"Subtitle","prepend-icon":"subtitles"},model:{value:t.postData.subtitle,callback:function(e){t.$set(t.postData,"subtitle",e)},expression:"postData.subtitle"}}),n("v-text-field",{attrs:{label:"Eternal link","prepend-icon":"link"},model:{value:t.postData.displayId,callback:function(e){t.$set(t.postData,"displayId",e)},expression:"postData.displayId"}}),n("span",[t._v("Language")]),n("v-switch",{attrs:{color:"accent",label:t.markdown?"Markdown":"HTML"},model:{value:t.markdown,callback:function(e){t.markdown=e},expression:"markdown"}}),t.markdown||t.addPost?t._e():n("v-btn",{attrs:{color:"info"},on:{click:t.loadContent}},[t._v("Edit raw HTML")]),n("v-slider",{attrs:{step:"1",min:"0",max:t.userData.role+1,ticks:"","thumb-label":"",label:"Secret level","prepend-icon":t.lockIcon},model:{value:t.postData.secret,callback:function(e){t.$set(t.postData,"secret",e)},expression:"postData.secret"}}),n("span",[n("v-icon",[t._v("visibility"+t._s(t.postData.hidden?"_off":""))]),t._v("\n            Hidden?\n          ")],1),n("v-switch",{attrs:{color:"accent",label:t.postData.hidden?"Hidden":"Public"},model:{value:t.postData.hidden,callback:function(e){t.$set(t.postData,"hidden",e)},expression:"postData.hidden"}}),n("span",[t._v("Comment")]),n("v-switch",{attrs:{color:"accent",label:t.postData.enableComment?"Enabled":"Disabled"},model:{value:t.postData.enableComment,callback:function(e){t.$set(t.postData,"enableComment",e)},expression:"postData.enableComment"}}),n("span",[t._v("Color of Title")]),n("v-switch",{attrs:{color:"accent",label:t.postData.darkTitle?"Dark":"Light"},model:{value:t.postData.darkTitle,callback:function(e){t.$set(t.postData,"darkTitle",e)},expression:"postData.darkTitle"}}),n("v-combobox",{attrs:{"hide-selected":"",label:"Tags","prepend-icon":"label",multiple:"",chips:"","deletable-chips":""},on:{input:t.changeTags},model:{value:t.postData.tags,callback:function(e){t.$set(t.postData,"tags",e)},expression:"postData.tags"}}),n("v-text-field",{attrs:{label:"Banner Image","prepend-icon":"image"},model:{value:t.postData.img,callback:function(e){t.$set(t.postData,"img",e)},expression:"postData.img"}}),n("span",[t._v("Content")]),n("markdown-editor",{ref:"markdownEditor",attrs:{id:"markdownEditor",highlight:!0,configs:t.configs},on:{keyup:function(e){return("button"in e||!t._k(e.keyCode,"s",void 0,e.key,void 0))&&e.ctrlKey?(e.preventDefault(),t.saveDraft(e)):null}},model:{value:t.postData.content,callback:function(e){t.$set(t.postData,"content",e)},expression:"postData.content"}}),n("v-card-actions",[n("v-spacer"),t.loading?n("div",[n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):n("div",[n("v-layout",[t.addPost?t._e():n("v-btn",{attrs:{color:"info"},on:{click:t.reloadPost}},[n("v-icon",[t._v("refresh")])],1),t.addPost?t._e():n("v-btn",{attrs:{color:"error"},on:{click:function(e){t.deleteDialog=!0}}},[n("v-icon",[t._v("delete")])],1),n("v-btn",{attrs:{color:"secondary",loading:t.loading},on:{click:t.saveDraft}},[n("v-icon",[t._v("archive")])],1),n("v-btn",{attrs:{color:"primary",loading:t.loading,disabled:!t.valid},on:{click:t.doEditPost}},[n("v-icon",[t._v("cloud_upload")])],1)],1)],1)],1)],1)],1)],1),n("div",{directives:[{name:"wechat-title",rawName:"v-wechat-title",value:t.realTitle,expression:"realTitle"}]}),n("v-dialog",{attrs:{"max-width":"500"},model:{value:t.deleteDialog,callback:function(e){t.deleteDialog=e},expression:"deleteDialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v("Are you sure?")]),n("v-card-text",[t._v("\n          You are deleting "+t._s(t.postData.title)+"\n          "),n("br"),t._v("\n          This post will be deleted, and can NOT be undone.\n        ")]),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"info",flat:"flat"},on:{click:function(e){t.deleteDialog=!1}}},[t._v("\n            No\n          ")]),n("v-btn",{attrs:{color:"error",flat:"flat",loading:t.loading},on:{click:t.deletePost}},[t._v("\n            Yes, delete"),n("v-icon",[t._v("delete")])],1)],1)],1)],1)],1),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1)),n("blog-footer")],1)},un=[],dn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-toolbar",{attrs:{color:"primary",dark:"","scroll-off-screen":""}},[t._t("default"),n("v-toolbar-title",[n("router-link",{staticClass:"white--text no-deco",attrs:{to:{name:"index"}}},[t._v(t._s(t.title))])],1),n("v-spacer"),n("v-toolbar-items",[n("v-btn",{attrs:{dark:"",flat:"",to:"/"}},[t._v("Index")]),n("v-btn",{attrs:{dark:"",flat:"",to:"/timeline"}},[t._v("Timeline")]),t.userData?n("v-btn",{attrs:{dark:"",flat:"",to:"/userspace"}},[t._v(t._s(t.userData.nickname))]):n("v-btn",{attrs:{dark:"",flat:"",tag:"a",to:{name:"login"}},on:{contextmenu:function(e){t.portedLogin(e)}},nativeOn:{click:function(e){return t.setRedirect(e)}}},[t._v("Login")])],1)],2)},hn=[],fn={name:"blog-toolbar",props:["userData","route","realTitle"],data:function(){return{title:this.realTitle||C.title}},methods:{setRedirect:function(){A.setRedirect(this.route)},portedLogin:function(t){t.preventDefault();var e=window.open(this.$router.resolve({name:"login",query:{ported:!0}}).href,"loginWindow","height=400,width=400,top=0,left=0,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no"),n=this.$watch("userData",function(t){t&&(e.close(),n())});e.addEventListener("close",n)}}},vn=fn,pn=(n("fe22"),Object(c["a"])(vn,dn,hn,!1,null,"3f5d7907",null));pn.options.__file="BlogToolbar.vue";var mn=pn.exports;u()(pn,{VBtn:q["a"],VSpacer:Dt["a"],VToolbar:Ut["a"],VToolbarItems:Rt["a"],VToolbarTitle:Rt["b"]});var gn=n("1487"),wn=n.n(gn),bn=n("bdfa");n("ebfb"),n("b116"),n("e4cb"),n("8159");window.hljs=wn.a;var kn={components:{BlogToolbar:mn,markdownEditor:bn["a"]},name:"post-edit",data:function(){return{postData:{img:"",id:0,content:"",secret:0,title:"",subtitle:"",hidden:!1,enableComment:!0,darkTitle:!1,displayId:"",tags:[]},toast:{show:!1,text:"",color:""},deleteDialog:!1,valid:!0,markdown:!0,addPost:0,userData:A.getLoginData(),loading:!1,configs:{spellChecker:!1,hideIcons:["guide"]},uploadImages:[],doNotSave:!1}},methods:{showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.toast.text=t,this.toast.color=e,this.toast.show=!0},changeToast:function(t){this.toast.show=t},makeRedirect:function(t){A.setRedirect(this.$route.fullPath),A.redirectTo(t)},changeTags:function(){this.postData.tags=this.postData.tags.map(function(t){return t.replace(/ /g,"-")})},getPostNum:function(){return this.$route.query.post},getPostData:function(){return this.changeTags(),{markdown:this.markdown,data:this.postData,uploadImages:this.uploadImages}},getPostDraft:function(t){return JSON.parse(window.localStorage.getItem("postDraft#".concat(t||0)))},saveDraft:function(){window.localStorage.setItem("postDraft#".concat(this.postData.id||0),O()(this.getPostData())),this.showToast("Draft saved!")},deleteDraft:function(){window.localStorage.removeItem("postDraft#".concat(this.postData.id||0))},getRequestForm:function(){var t=Object(b["a"])({},this.postData,{id:void 0,next:void 0,prev:void 0,lastEdit:void 0,author:void 0,created:void 0});return{postID:this.addPost?void 0:this.postData.id,data:dt(t),markdown:this.markdown}},loadDraft:function(){var t=this.getPostNum()||0,e=this.getPostDraft(t);return e&&(this.markdown=e.markdown,this.postData=e.data),!!e},preload:function(){var t=this.loadDraft();return t&&this.showToast("Draft loaded!"),t},loadContent:function(){var t=this,e=this.getPostNum();e&&(this.loading=!0,A.fetchJSON(A.apiFor("post",e),"GET",{markdown:this.markdown}).then(function(e){t.loading=!1,e?t.postData=ut(e):t.addPost=!0}).catch(function(e){t.showToast(e,"error")}))},doEditPost:function(){var t=this;return this.loading=!0,A.fetchJSONWithSuccess(A.apiFor("add"),"POST",this.getRequestForm()).then(function(e){t.showToast("Success!","success"),t.leave()}).catch(function(e){if(t.$Progress.fail(),"expired"===e)return A.refreshToken().then(function(e){return t.doEditPost()}).catch(function(e){t.showToast("Token Expired!","warning"),t.makeRedirect({name:"login"})});t.showToast(e,"error")}).finally(function(){t.deleteDialog=!1,t.loading=!1})},deletePost:function(){var t=this,e=this.getPostNum();if(e){var n=A.getLoginData();n&&n.role?A.fetchJSONWithSuccess(A.apiFor("remove"),"POST",{postID:e}).then(function(e){t.showToast("Success!","success"),t.leave(!0)}).catch(function(e){"expired"===e?(t.showToast("Token Expired!","warning"),t.$router.push({name:"login"})):t.showToast(e,"error")}):this.showToast("You are not supposed to do this.","warning")}},reloadPost:function(){this.markdown=!0,this.loadContent()},doNotDelete:function(){this.deleteDialog=!1,this.leave()},leave:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&this.deleteDraft(),this.doNotSave=t,this.$route.params.deletePost?this.$router.go(-1):A.redirectTo({name:"index"})},simplemde:function(){var t=this.$refs.markdownEditor;return t?t.simplemde:{markdown:function(t){return t}}},getPreviewData:function(){return Object(b["a"])({},this.postData,{id:"preview",content:this.markdown?this.simplemde().markdown(this.postData.content):this.postData.content})}},computed:{realTitle:function(){return this.addPost?"Add a post":"Edit: ".concat(this.postData.title)},operationVerb:function(){return this.addPost?"add":"edit"},lockIcon:function(){return this.postData.secret?"lock":"lock_open"}},mounted:function(){var t=this;if(!this.userData)return this.makeRedirect({name:"login",params:{logout:!0,message:"Login to ".concat(this.operationVerb," a post")}});if(!this.userData.role)return this.showToast("You are not supposed to do this."),void A.redirectTo({name:"index"});if(this.$route.params.deletePost){this.deleteDialog=!0,this.postData.title=this.$route.params.title;var e=this.$watch("deleteDialog",function(n){e(),t.doNotDelete()})}else{this.addPost=!this.getPostNum();var n=this.preload();n||this.addPost||this.loadContent(),addEventListener("storage",function(e){"loginData"===e.key&&(e.newValue||t.makeRedirect({name:"login"}))}),window.addEventListener("beforeunload",function(e){return t.saveDraft()}),this.$emit("forceSwitchToLight",!0)}},beforeDestroy:function(){this.doNotSave||this.saveDraft()},destroyed:function(){var t=this;this.$emit("forceSwitchToLight"),removeEventListener("beforeunload",function(e){return t.saveDraft()})}},yn=kn,_n=(n("ac4e"),n("2b5d")),xn=n("ba0d"),Dn=n("b73d"),Cn=n("3a2f"),Tn=Object(c["a"])(yn,ln,un,!1,null,"0d1df259",null);Tn.options.__file="PostEdit.vue";var Pn=Tn.exports;u()(Tn,{VBtn:q["a"],VCard:mt["a"],VCardActions:gt["a"],VCardText:gt["b"],VCardTitle:wt["a"],VCombobox:_n["a"],VContainer:M["a"],VDialog:Te["a"],VFlex:W["a"],VForm:$t["a"],VIcon:kt["a"],VLayout:H["a"],VProgressCircular:Y["a"],VSlider:xn["a"],VSpacer:Dt["a"],VSwitch:Dn["a"],VTextField:Nt["a"],VTooltip:Cn["a"]});var Sn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"top-details"},[n("aside",{staticClass:"exception-logo"}),n("header",{staticClass:"exception-info"},[n("h5",{staticClass:"struct blog-text"},[t._v("\n        RoseliaBlog.Router."+t._s(t.errorCode)+"Error\n        "),n("small",[t._v("at "+t._s(t.method))]),n("small",{staticClass:"path"},[t._v(t._s(t.path))])]),n("h1",{staticClass:"title blog-text"},[t._v("an error found for "+t._s(t.method)+" "+t._s(t.path)+" (RoseliaBlog.Router)")])]),n("div",{staticClass:"code-explorer"},[n("div",{staticClass:"code-snippets"},[n("div",{staticClass:"frame-info -active",attrs:{"data-index":"0",role:"stack-trace-details"}},[t._m(0),n("pre",{staticClass:"black--text code code-block"},[t._m(1),t._v("\n                      "),t._m(2),t._v("\n                      "),t._m(3),t._v("\n                      "),t._m(4),t._v("\n                      "),t._m(5),t._v("\n                      "),t._m(6),t._v("\n                      "),n("span",{staticClass:"line -highlight"},[n("span",{staticClass:"ln"},[t._v("666")]),n("span",{staticClass:"code"},[t._v('    case "'+t._s(t.path)+'" => '+t._s(t.errorTaunt))])]),t._v("\n                      "),t._m(7),t._v("\n                      "),t._m(8),t._v("\n                  ")]),t._m(9)])]),n("div",{staticClass:"stack-trace"},[n("ul",{staticClass:"stack-trace-list -show-all",attrs:{role:"stack-trace-list"}},[t._m(10),n("li",[n("router-link",{staticClass:"stack-trace-item",attrs:{to:"/",role:"stack-trace-item","data-index":"0"}},[n("span",{staticClass:"left"},[n("span",{staticClass:"app"},[t._v("RoseliaBlog")]),n("span",{staticClass:"filename"},[t._v("\n                                  Bring me back\n                              ")])]),n("span",{staticClass:"info"},[t._v('_ => RoseliaBlog.Router.route("index")')])])],1)])])])]),n("div",{staticClass:"conn-info"},[n("details",{staticClass:"conn-details"},[n("summary",[t._v("Known info")]),n("dl",[n("dt",[t._v("Instance:")]),n("dd",{staticClass:"code-quote"},[t._v(t._s(t.title))])]),n("dl",[n("dt",[t._v("URI:")]),n("dd",{staticClass:"code-quote"},[t._v(t._s(t.path))])]),n("dl",[n("dt",[t._v("Description:")]),n("dd",{staticClass:"code-quote"},[t._v(t._s(t.motto))])]),n("dl",[n("dt",[t._v("Error:")]),n("dd",{staticClass:"code-quote"},[t._v(t._s(t.errorCode)+" - "+t._s(t.errorTaunt))])])])])])},Ln=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"file"},[n("a",{attrs:{href:""}},[t._v("lib/roselia_blog/router")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"line"},[n("span",{staticClass:"ln"},[t._v("1")]),n("span",{staticClass:"code"},[t._v("class RoseliaBlog.Router extends Router{")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"line "},[n("span",{staticClass:"ln"},[t._v("2")]),n("span",{staticClass:"code"},[t._v("  ...")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"line "},[n("span",{staticClass:"ln"},[t._v("3")]),n("span",{staticClass:"code"})])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"line "},[n("span",{staticClass:"ln"},[t._v("233")]),n("span",{staticClass:"code"},[t._v("  def route(path: String): Request => Response = path match {")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"line "},[n("span",{staticClass:"ln"},[t._v("234")]),n("span",{staticClass:"code"},[t._v('    case "/" => Controller.index')])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"line "},[n("span",{staticClass:"ln"},[t._v("235")]),n("span",{staticClass:"code"},[t._v("    ...")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"line "},[n("span",{staticClass:"ln"},[t._v("667")]),n("span",{staticClass:"code"},[t._v("  }")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{staticClass:"line "},[n("span",{staticClass:"ln"},[t._v("668")]),n("span",{staticClass:"code"},[t._v("  def scope(scop: String)(f: Request => Response): Request => Response = {")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"meta"},[n("div",{staticClass:"frame-mfa"},[t._v("\n              RoseliaBlog.Router.route: (path: String): Request => Response\n\n              "),n("a",{staticClass:"docs right blog-text",attrs:{href:"/"}},[t._v("index")]),n("span",{staticClass:"app right"},[t._v("RoseliaBlog")])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("li",[n("button",{staticClass:"stack-trace-item -app -active",attrs:{role:"stack-trace-item","data-index":"0"}},[n("span",{staticClass:"left"},[n("span",{staticClass:"app"},[t._v("RoseliaBlog")]),n("span",{staticClass:"filename"},[t._v("\n                                  lib/roselia_blog/router"),n("span",{staticClass:"line"},[t._v(":666")])])]),n("span",{staticClass:"info"},[t._v("RoseliaBlog.Router.route: (path: String): Request => Response")])])])}],Vn={name:"blog-error",data:function(){return{errorCode:"404NotFound",errorTaunt:"Maybe Marisa has stolen something important",title:C.title,motto:C.motto,link:this.$router.resolve({name:"index"}),path:this.$route.fullPath,method:"GET"}}},On=Vn,En=(n("8cd6"),n("86f9"),Object(c["a"])(On,Sn,Ln,!1,null,"c4e27986",null));En.options.__file="BlogError.vue";var $n=En.exports,jn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{attrs:{dark:t.dark}},[n("blog-toolbar",{attrs:{userData:t.userData}},[n("v-toolbar-side-icon",{attrs:{dark:""},nativeOn:{click:function(e){t.drawer=!t.drawer}}})],1),n("v-navigation-drawer",{attrs:{fixed:"",clipped:"",app:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[n("v-list",{attrs:{dense:""}},[t._l(t.items,function(e,a){return[e.heading?n("v-layout",{key:a,attrs:{row:"","align-center":""}},[n("v-flex",{attrs:{xs6:""}},[e.heading?n("v-subheader",[t._v("\n              "+t._s(e.heading)+"\n            ")]):t._e()],1)],1):e.divider?n("v-divider",{key:a,staticClass:"my-3",attrs:{dark:""}}):e.click?n("v-list-tile",{key:a,attrs:{ripple:""},on:{click:e.click}},[n("v-list-tile-action",[n("v-icon",[t._v(t._s(e.icon))])],1),n("v-list-tile-content",[n("v-list-tile-title",{staticClass:"grey--text"},[t._v("\n              "+t._s(e.text)+"\n            ")])],1)],1):n("v-list-tile",{key:a,attrs:{ripple:"",to:e.to}},[n("v-list-tile-action",[n("v-icon",[t._v(t._s(e.icon))])],1),n("v-list-tile-content",[n("v-list-tile-title",{staticClass:"grey--text"},[t._v("\n              "+t._s(e.text)+"\n            ")])],1)],1)]})],2)],1),n("v-content",[n("v-container",{attrs:{fluid:"","fill-height":""}},[n("v-layout",{attrs:{"justify-center":"","align-center":""}},[n("v-flex",{attrs:{shrink:""}},[n("v-alert",{attrs:{type:t.toast.color,transition:"scale-transition"},model:{value:t.toast.show,callback:function(e){t.$set(t.toast,"show",e)},expression:"toast.show"}},[t._v("\n            "+t._s(t.toast.text)+"\n          ")]),n("v-slide-x-transition",{attrs:{"hide-on-leave":""}},[n("router-view",{attrs:{userData:t.userData,toast:t.showToast}})],1)],1)],1)],1)],1),n("toast",t._b({on:{showChange:t.changeToast}},"toast",t.toast,!1))],1)},Nn=[],Un=(function(){var t=A.getLoginData()}(),{components:{BlogToolbar:mn},name:"blog-user-space",data:function(){return{userData:null,toast:{show:!1,text:"",color:""},drawer:null,dark:p.computed.isNight()}},computed:{items:function(){return[{icon:"home",text:"Home",to:{name:"console-index"}},{divider:!0},{heading:"Writing posts"},{icon:"add_circle",text:"Write a new post",to:{name:"edit"},cond:this.userData.role},{icon:"delete",text:"Remove all drafts",click:this.removeAllDraft},{divider:!0},{heading:"My account"},{icon:"account_box",text:"Change Nickname",to:{name:"setNickname"}},{icon:"account_box",text:"OAuth accounts",to:{name:"oauthAccounts"},cond:!1},{divider:!0},{heading:"Management"},{icon:"lock",text:"Change password",to:{name:"changePassword"}},{icon:"people",text:"Manage User",to:{name:"userManagement"},cond:this.userData.role},{divider:!0},{heading:"My Session"},{icon:"refresh",text:"Token Refresh",to:{name:"tokenRefresh"},cond:this.userData.rftoken},{icon:"verified_user",text:"Remote Login",to:{name:"remoteLogin"}},{divider:!0},{icon:"exit_to_app",text:"Log Out",to:{name:"login",params:{logout:!0}}}].filter(function(t){return!t.hasOwnProperty("cond")||t.cond})}},methods:{showToast:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.toast=this.toast||{},this.toast.show=!1,this.toast.text=t.toString(),this.toast.color=e,this.toast.show=!0},changeToast:function(t){this.toast.show=t},makeRedirect:function(t){A.setRedirect(this.$route.fullPath),A.redirectTo(t)},removeAllDraft:function(){var t=window.localStorage;Wt()(Array(t.length).keys()).map(t.key.bind(t)).filter(function(t){return t.startsWith("postDraft")}).forEach(function(e){t.removeItem(e)}),this.showToast("Draft Cleaned!")}},mounted:function(){var t=this;if(this.userData=A.getLoginData(),!this.userData)return this.makeRedirect({name:"login",params:{logout:!0,message:"Login to manage",alert:{color:"warning",text:"Please login first"}}});window.addEventListener("storage",function(e){"loginData"===e.key&&(console.log(e),t.userData=A.getLoginData())})},destroyed:function(){A.removeSUToken()}}),Rn=Un,Fn=(n("ea98"),n("8860")),An=n("ba95"),In=n("40fe"),Bn=n("5d23"),qn=n("f774"),Mn=n("e0c7"),Jn=n("706c"),Wn=Object(c["a"])(Rn,jn,Nn,!1,null,"3fcf34d2",null);Wn.options.__file="BlogUserSpace.vue";var Hn=Wn.exports;u()(Wn,{VAlert:Et["a"],VApp:d["a"],VContainer:M["a"],VContent:h["a"],VDivider:J["a"],VFlex:W["a"],VIcon:kt["a"],VLayout:H["a"],VList:Fn["a"],VListTile:An["a"],VListTileAction:In["a"],VListTileContent:Bn["a"],VListTileTitle:Bn["b"],VNavigationDrawer:qn["a"],VSlideXTransition:f["e"],VSubheader:Mn["a"],VToolbarSideIcon:Jn["a"]});var Yn=n("7876"),zn=n.n(Yn),Gn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card-action",[n("h2",{staticClass:"flex text--secondary"},[t._v("Change Password for "+t._s(t.userData.username))]),n("v-form",{ref:"form",model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{name:"oldPassword",label:"Old Password",type:"password",autofocus:"",rules:t.rules},model:{value:t.oldPassword,callback:function(e){t.oldPassword=e},expression:"oldPassword"}}),n("v-text-field",{attrs:{name:"newPassword",label:"New Password",type:"password",rules:t.rules},model:{value:t.newPassword,callback:function(e){t.newPassword=e},expression:"newPassword"}}),n("v-text-field",{attrs:{name:"repeatPassword",label:"Repeat Password",type:"password",rules:t.repeatRules},model:{value:t.repeatPassword,callback:function(e){t.repeatPassword=e},expression:"repeatPassword"}})],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"warning",loading:t.loading,disabled:!t.valid},on:{click:t.changePassword}},[t._v("Change")])],1)],1)},Xn=[],Zn=[function(t){return!!t||"Required"},function(t){return t&&t.length>4&&t.length<20||"Length is not valid"}],Kn={name:"change-password",props:["userData","toast"],data:function(){var t=this;return{loading:!1,oldPassword:"",newPassword:"",repeatPassword:"",valid:!1,rules:Zn,repeatRules:Zn.concat([function(e){return e===t.newPassword||"Repeat password should equal to new password"}])}},methods:{changePassword:function(){var t=this;this.$refs.form.validate()&&(this.loading=!0,A.fetchJSONWithSuccess(A.apiFor("user","change"),"POST",{username:this.userData.username,oldPassword:this.oldPassword,newPassword:this.newPassword},!1).then(function(e){t.toast("Success!","success"),t.$router.go(-1)}).catch(function(e){t.toast(e,"error")}).finally(function(e){t.loading=!1}))}}},Qn=Kn,ta=(n("848e"),Object(c["a"])(Qn,Gn,Xn,!1,null,"d19c8c56",null));ta.options.__file="ChangePassword.vue";var ea=ta.exports;u()(ta,{VBtn:q["a"],VCardActions:gt["a"],VForm:$t["a"],VSpacer:Dt["a"],VTextField:Nt["a"]});var na=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card-action",[n("h2",{staticClass:"flex text--secondary"},[t._v("Remote Login")]),n("v-form",{ref:"form",on:{submit:function(t){t.preventDefault()}},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{name:"loginCode",label:"Login Code",type:"number",autofocus:"",rules:t.rules},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.scanCode(e):null}},model:{value:t.loginCode,callback:function(e){t.loginCode=e},expression:"loginCode"}})],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",loading:t.loading,disabled:!t.valid},on:{click:t.scanCode}},[t._v("Login")])],1),n("v-dialog",{attrs:{persistent:"","max-width":"500"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-card",[n("v-card-title",{staticClass:"headline"},[t._v("Remote Login")]),n("v-card-text",[t._v("Will login at "+t._s(t.loginMeta.os)+" "+t._s(t.loginMeta.browser)+" device on "+t._s(t.loginMeta.ip))]),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"error",flat:""},nativeOn:{click:function(e){t.dialog=!1}}},[t._v("Nope")]),n("v-btn",{attrs:{color:"info",flat:""},on:{click:t.confirmCode}},[t._v("OK")])],1)],1)],1)],1)},aa=[],oa={name:"remote-login",props:["userData","toast"],data:function(){return{loginCode:"",valid:!1,loading:!1,rules:[function(t){return!!t||"Required"},function(t){return[].every.call(t,function(t){return!isNaN(tt()(t))})||"Code should be digits"},function(t){return t&&6===t.length||"Length should be 6"}],dialog:!1,loginMeta:{os:"",browser:"",ip:""}}},methods:{scanCode:function(){var t=this;this.$refs.form.validate()&&(this.loading=!0,A.fetchJSON(A.apiFor("login","code","scan",this.loginCode),"POST").then(function(e){if(!e.success)return t.toast(e.msg,"error"),void(t.loading=!1);t.loginMeta=e.msg,t.dialog=!0,t.loading=!1}).catch(function(e){t.loading=!1,t.toast("Network error.","error")}))},confirmCode:function(){var t=this;this.loading=!0,A.fetchJSON(A.apiFor("login","code","confirm",this.loginCode),"POST").then(function(e){e.success||t.toast(e.msg,"error"),t.toast("I assume that you are teleported to another device","success"),t.dialog=!1,A.redirectTo({name:"userspace"})}).catch(function(e){t.toast("Network error","error")})}},watch:{dialog:function(t){t||(this.loading=!1)}}},ra=oa,sa=(n("6dc4"),Object(c["a"])(ra,na,aa,!1,null,"7289c896",null));sa.options.__file="RemoteLogin.vue";var ia=sa.exports;u()(sa,{VBtn:q["a"],VCard:mt["a"],VCardActions:gt["a"],VCardText:gt["b"],VCardTitle:wt["a"],VDialog:Te["a"],VForm:$t["a"],VSpacer:Dt["a"],VTextField:Nt["a"]});var ca=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("v-btn",{attrs:{flat:""},nativeOn:{click:function(e){t.addUser.form=!0}}},[n("v-icon",[t._v("person_add")])],1),n("v-data-table",{staticClass:"elevation-1",attrs:{items:t.userList,loading:t.loading,headers:t.headers},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[t._v(t._s(e.item.username))]),n("td",{staticClass:"text-xs-right"},[t._v(t._s(e.item.role))]),n("td",{staticClass:"text-xs-right"},[n("v-btn",{attrs:{small:"",color:"secondary"},on:{click:function(n){t.setPasswordForm(e.item.username)}}},[n("v-icon",[t._v("edit")])],1),n("v-btn",{attrs:{small:"",color:"error"},on:{click:function(n){t.deleteUserForm(e.item.username)}}},[n("v-icon",[t._v("delete")])],1)],1)]}}])},[n("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"})],1),n("v-layout",{attrs:{row:"","justify-center":""}},[n("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:t.addUser.form,callback:function(e){t.$set(t.addUser,"form",e)},expression:"addUser.form"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[t._v("Add User")])]),n("v-card-text",[n("v-form",{model:{value:t.addUser.valid,callback:function(e){t.$set(t.addUser,"valid",e)},expression:"addUser.valid"}},[n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{rules:t.addUser.rules,label:"Username",required:""},model:{value:t.addUser.username,callback:function(e){t.$set(t.addUser,"username",e)},expression:"addUser.username"}})],1),n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{rules:t.addUser.rules,label:"Password",type:"password",required:""},model:{value:t.addUser.password,callback:function(e){t.$set(t.addUser,"password",e)},expression:"addUser.password"}})],1),n("v-flex",{attrs:{xs12:"",sm6:""}},[n("v-select",{attrs:{items:t.addUser.items,label:"Permission Level",required:""},model:{value:t.addUser.role,callback:function(e){t.$set(t.addUser,"role",e)},expression:"addUser.role"}})],1)],1)],1)],1)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){t.addUser.form=!1}}},[t._v("Close")]),n("v-btn",{attrs:{color:"blue darken-1",flat:"",disabled:!t.addUser.valid,loading:t.loading},on:{click:t.doAddUser}},[t._v("Add")])],1)],1)],1),n("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:t.loginForm,callback:function(e){t.loginForm=e},expression:"loginForm"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[t._v("Enter Password")])]),n("v-card-text",[n("h4",[t._v("For your safety, please input your password.")]),n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{label:"Password",type:"password",required:""},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.getSUToken(e):null}},model:{value:t.loginPassword,callback:function(e){t.loginPassword=e},expression:"loginPassword"}})],1)],1)],1)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",flat:""},on:{click:t.leave}},[t._v("Close")]),n("v-btn",{attrs:{color:"info",flat:""},on:{click:t.getSUToken}},[t._v("OK")])],1)],1)],1)],1),n("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:t.setPassword.form,callback:function(e){t.$set(t.setPassword,"form",e)},expression:"setPassword.form"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline"},[t._v("Set Password of "+t._s(t.setPassword.username))])]),n("v-card-text",[n("v-form",{on:{submit:function(t){t.preventDefault()}},model:{value:t.setPassword.valid,callback:function(e){t.$set(t.setPassword,"valid",e)},expression:"setPassword.valid"}},[n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{rules:t.addUser.rules,label:"Password",type:"password",required:""},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.doSetPassword(e):null}},model:{value:t.setPassword.password,callback:function(e){t.$set(t.setPassword,"password",e)},expression:"setPassword.password"}})],1)],1)],1)],1)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){t.setPassword.form=!1}}},[t._v("Close")]),n("v-btn",{attrs:{color:"blue darken-1",flat:"",disabled:!t.setPassword.valid,loading:t.loading},on:{click:t.doSetPassword}},[t._v("Set")])],1)],1)],1),n("v-dialog",{attrs:{persistent:"","max-width":"500px"},model:{value:t.deleteUser.form,callback:function(e){t.$set(t.deleteUser,"form",e)},expression:"deleteUser.form"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline error--text"},[t._v("Delete "+t._s(t.deleteUser.username))])]),n("v-card-text",[n("span",[t._v("Please make sure by retyping username")]),n("v-form",{on:{submit:function(t){t.preventDefault()}},model:{value:t.deleteUser.valid,callback:function(e){t.$set(t.deleteUser,"valid",e)},expression:"deleteUser.valid"}},[n("v-container",{attrs:{"grid-list-md":""}},[n("v-layout",{attrs:{wrap:""}},[n("v-flex",{attrs:{xs12:""}},[n("v-text-field",{attrs:{rules:t.deleteUser.rules,label:"Retype Username",required:""},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.doDeleteUser(e):null}},model:{value:t.deleteUser.typedUsername,callback:function(e){t.$set(t.deleteUser,"typedUsername",e)},expression:"deleteUser.typedUsername"}})],1)],1)],1)],1)],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"blue darken-1",flat:""},nativeOn:{click:function(e){t.deleteUser.form=!1}}},[t._v("Close")]),n("v-btn",{attrs:{color:"error",flat:"",disabled:!t.deleteUser.valid,loading:t.loading},on:{click:t.doDeleteUser}},[t._v("Delete")])],1)],1)],1)],1)},la=[],ua={name:"user-management",props:["userData","toast"],data:function(){var t=this;return{suToken:"",loading:!1,userList:[],headers:[{text:"Username",align:"left",sortable:!0,value:"username"},{text:"Role Level",value:"role"},{text:"Action"}],loginForm:!1,addUser:{form:!1,username:"",password:"",role:0,items:Wt()(Array(this.userData.role).keys()).map(function(t,e){return{text:"Level ".concat(e),value:e}}),rules:[function(t){return!!t||"Required"},function(t){return t&&t.length>4&&t.length<20||"Length is not valid"}],valid:!1},setPassword:{form:!1,valid:!1,username:"",password:""},deleteUser:{form:!1,valid:!1,username:"",typedUsername:"",rules:[function(e){return e&&e.toLowerCase()===t.deleteUser.username.toLowerCase()||"Username should be same to target user"}]},loginPassword:""}},methods:{leave:function(){this.$router.go(-1)},getSUToken:function(){var t=this;this.loading=!0,A.fetchJSON(A.apiFor("user","su"),"POST",{password:this.loginPassword}).then(function(e){if(t.loading=!1,!e.success)return t.toast("Wrong Password","error"),void(t.loginPassword="");t.loginForm=!1,t.suToken=e.token,A.saveSUToken(e.token),t.loadUser()})},loadUser:function(){var t=this;this.loading=!0,A.fetchJSONWithSuccess(A.apiFor("user","list")).then(function(e){t.loading=!1,t.userList=e}).catch(function(e){t.toast(e,"error"),t.leave()})},doAddUser:function(){var t=this;this.loading=!0,A.fetchJSONWithSuccess(A.apiFor("user","add"),"POST",{username:this.addUser.username,password:this.addUser.password,role:this.addUser.role,token:this.suToken},!1).then(function(e){t.addUser.form=!1,t.addUser.username="",t.addUser.password="",t.loadUser()}).catch(function(e){t.toast(e,"error")}).finally(function(e){t.loading=!1})},setPasswordForm:function(t){this.setPassword.username=t,this.setPassword.form=!0},doSetPassword:function(){var t=this;this.setPassword.valid&&(this.loading=!0,A.fetchJSONWithSuccess(A.apiFor("user","change"),"POST",{username:this.setPassword.username,newPassword:this.setPassword.password,token:this.suToken},!1).then(function(e){t.toast("Why must you change the password?","success"),t.setPassword.form=!1}).catch(function(e){t.toast(e,"error")}).finally(function(e){t.loading=!1}))},deleteUserForm:function(t){this.deleteUser.username=t,this.deleteUser.form=!0},doDeleteUser:function(){var t=this;this.deleteUser.valid&&(this.loading=!0,A.fetchJSONWithSuccess(A.apiFor("user","remove"),"POST",{username:this.deleteUser.username,token:this.suToken},!1).then(function(e){t.toast("Success!","success"),t.deleteUser.form=!1,t.loadUser()}).catch(function(e){t.toast(e,"error")}).finally(function(e){t.loading=!1}))}},mounted:function(){var t=A.getSUToken();if(!this.userData.role)return this.toast("You are not supposed to do this.","warning"),this.leave();this.suToken=t,t?this.loadUser():this.loginForm=!0,this.$route.params.firstRun&&(this.addUser.form=!0)},watch:{"setPassword.form":function(){this.setPassword.password=""},"deleteUser.form":function(){this.deleteUser.password=""}}},da=ua,ha=(n("d565"),n("8fea")),fa=n("b56d"),va=Object(c["a"])(da,ca,la,!1,null,"407099c6",null);va.options.__file="UserManagement.vue";var pa=va.exports;u()(va,{VBtn:q["a"],VCard:mt["a"],VCardActions:gt["a"],VCardText:gt["b"],VCardTitle:wt["a"],VContainer:M["a"],VDataTable:ha["a"],VDialog:Te["a"],VFlex:W["a"],VForm:$t["a"],VIcon:kt["a"],VLayout:H["a"],VProgressLinear:jt["a"],VSelect:fa["a"],VSpacer:Dt["a"],VTextField:Nt["a"]});var ma=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card-action",[n("h1",{staticClass:"primary--text display-1"},[t._v("Well met, "+t._s(t.userData.nickname)+"("+t._s(t.userData.username)+")!")]),n("p",[t._v("There are "+t._s(t.posts)+" posts from your perspective.")]),n("p",[t._v("Take it easy casuse I will NOT break your legs in this page.")])])},ga=[],wa={name:"ConsoleIndex",props:["userData","toast"],data:function(){return{posts:"Loading..."}},methods:{loadPostCount:function(){var t=this;A.fetchJSON(A.apiFor("posts"),"GET",{limit:1}).then(function(e){t.posts=e.total})}},mounted:function(){this.loadPostCount()}},ba=wa,ka=Object(c["a"])(ba,ma,ga,!1,null,null,null);ka.options.__file="ConsoleIndex.vue";var ya=ka.exports,_a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{attrs:{row:"",wrap:""}},[n("v-flex",{attrs:{xs12:"",sm12:""}},[t.isTokenExpired?n("div",[n("h1",[t._v("Your token has expired")])]):n("div",[n("h1",[t._v("Your token will be expired @")]),n("v-time-picker",{attrs:{landscape:"",readonly:"",format:"24h"},model:{value:t.tokenExpiryTime,callback:function(e){t.tokenExpiryTime=e},expression:"tokenExpiryTime"}})],1),t.userData.rftoken?n("div",[t.isRefreshTokenExpired?n("div",[n("h1",[t._v("Your refresh token has expired")]),n("v-btn",{attrs:{to:{name:"login",params:{logout:!0}},color:"warning"}},[n("v-icon",[t._v("exit_to_app")]),t._v("Re-Login\n        ")],1)],1):n("div",[n("h1",[t._v("Your refresh token will be expired @")]),n("v-flex",{attrs:{md12:"",lg12:""}},[n("v-date-picker",{attrs:{readonly:"",color:"accent","header-color":"primary"},model:{value:t.rfTokenExpiryDate,callback:function(e){t.rfTokenExpiryDate=e},expression:"rfTokenExpiryDate"}}),n("v-time-picker",{attrs:{readonly:"",color:"primary",format:"24h"},model:{value:t.rfTokenExpiryTime,callback:function(e){t.rfTokenExpiryTime=e},expression:"rfTokenExpiryTime"}})],1),n("v-btn",{attrs:{color:"primary"},on:{click:t.refreshToken}},[n("v-icon",[t._v("refresh")]),t._v("Refresh\n        ")],1)],1)]):t._e()])],1)},xa=[];window.utils=A;var Da={props:["userData","toast"],data:function(){return{get loginToken(){return A.getLoginData().token},set loginToken(t){return 0},get rfToken(){return A.getLoginData().rftoken}}},computed:{tokenExpiryTime:function(){return this.getTimeOf(this.tokenExpiryDatetime)},tokenExpiryDatetime:function(){return A.getTokenExpiryTime(this.loginToken)},rfTokenExpiryDatetime:function(){return A.getTokenExpiryTime(this.rfToken)},rfTokenExpiryDate:function(){var t=this.rfTokenExpiryDatetime;return"".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate())},rfTokenExpiryTime:function(){var t=this.rfTokenExpiryDatetime;return this.getTimeOf(t)},isRefreshTokenExpired:function(){return this.rfTokenExpiryDatetime<new Date},isTokenExpired:function(){return this.tokenExpiryDatetime<new Date}},methods:{makeRedirect:function(t){A.setRedirect(this.$route.fullPath),A.redirectTo(t)},refreshToken:function(){var t=this;A.refreshToken().then(function(e){t.toast("+1h O..O","success"),++t.loginToken}).catch(function(e){t.toast(e,"error"),t.makeRedirect({name:"login"})})},getTimeOf:function(t){return"".concat(t.getHours(),":").concat(t.getMinutes())}}},Ca=Da,Ta=n("2e4b"),Pa=n("c964"),Sa=Object(c["a"])(Ca,_a,xa,!1,null,null,null);Sa.options.__file="TokenRefresh.vue";var La=Sa.exports;u()(Sa,{VBtn:q["a"],VDatePicker:Ta["a"],VFlex:W["a"],VIcon:kt["a"],VLayout:H["a"],VTimePicker:Pa["a"]});var Va=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("nav-bar",{attrs:{userData:t.userData,route:this.$route.fullPath}}),n("v-parallax",{attrs:{dark:"",src:t.config.images.timelineBannerImage}},[n("v-layout",{attrs:{"align-center":"",column:"","justify-center":""}},[n("h1",{staticClass:"display-2 font-weight-regular mb-3"},[t._v("Timeline")]),n("h2",{staticClass:"subheading"},[t._v("\n        The fate of a person, of course, depends on self-strengthening, but also on the journey of the history.\n      ")])])],1),n("v-container",[n("v-card-text",{staticClass:"py-0"},[n("v-timeline",{attrs:{"align-top":"",dense:t.$vuetify.breakpoint.smAndDown}},[n("v-slide-x-transition",{attrs:{group:""}},t._l(t.postData,function(e,a){return n("v-timeline-item",{key:a,attrs:{"fill-dot":"",color:"accent"}},[n("span",{staticClass:"headline font-weight-bold",attrs:{slot:"opposite"},slot:"opposite"},[n("h4",[t._v(t._s(e.datetime.toLocaleDateString()))]),n("h3",{staticClass:"secondary-text"},[t._v(t._s(e.author&&e.author.nickname))]),t._l(e.tags,function(e){return n("router-link",{key:e,attrs:{to:{name:"index",params:{tag:e},query:{tag:e}}}},[n("v-chip",[t._v(t._s(e))])],1)}),e.secret?n("v-chip",{attrs:{color:"success","text-color":"white"}},[n("v-avatar",[n("v-icon",[t._v("lock")]),t._v(t._s(e.secret)+"\n              ")],1),t._v("\n              Secret\n            ")],1):t._e()],2),n("div",{staticClass:"py-3"},[n("v-card",{attrs:{dark:"",color:"primary"}},[n("v-card-title",{staticClass:"title"},[t._v(t._s(e.title))]),n("v-card-text",[n("p",[t._v(t._s(e.subtitle))]),n("v-btn",{staticClass:"mx-0",attrs:{outline:"",color:"secondary",to:{name:"post",query:{p:e.id}}}},[n("v-icon",[t._v("unfold_more")])],1)],1)],1)],1)])}),1)],1),n("v-layout",{attrs:{"align-center":"",column:"","justify-center":""}},[n("div",{directives:[{name:"observe-visibility",rawName:"v-observe-visibility",value:t.loadNextPage,expression:"loadNextPage"}]},[t.currentPage<t.totalPages?n("div",[n("v-btn",{attrs:{loading:t.loading,small:"",block:"",color:"secondary",dark:""},on:{click:t.loadNextPage}},[n("v-icon",[t._v("keyboard_arrow_down")])],1)],1):t.loading?n("div",[n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}})],1):t.postData.length?n("div",[n("v-divider"),t._v("\n            Tiro finale\n          ")],1):t._e()])])],1)],1)],1)},Oa=[],Ea={data:function(){return{currentPage:1,totalPages:1,userData:A.getLoginData(),postData:[],loading:!1}},methods:{getPostData:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t=t||this.currentPage;var a={page:t,limit:6};this.loading=!0,A.fetchJSON(A.apiFor("posts"),"GET",a).then(function(t){var a=t.data.map(function(t){return Object(b["a"])({},t,{datetime:new Date(t.created)})});e.postData=n?e.postData.concat(a):a,e.totalPages=tt()(t.pages),e.loading=!1}).catch(function(t){console.error(t),e.loading=!1})},loadNextPage:function(){this.currentPage>=this.totalPages||this.getPostData(++this.currentPage)}},mounted:function(){var t=this;this.getPostData(1,!1),window.addEventListener("storage",function(e){"loginData"===e.key&&(t.userData=A.getLoginData())})},watch:{userData:function(){this.currentPage=1,this.totalPages=1,this.getPostData(1,!1)}}},$a=Ea,ja=Object(c["a"])($a,Va,Oa,!1,null,null,null);ja.options.__file="BlogTimeline.vue";var Na=ja.exports;u()(ja,{VAvatar:pt["a"],VBtn:q["a"],VCard:mt["a"],VCardText:gt["b"],VCardTitle:wt["a"],VChip:bt["a"],VContainer:M["a"],VDivider:J["a"],VIcon:kt["a"],VLayout:H["a"],VParallax:xt["a"],VProgressCircular:Y["a"],VSlideXTransition:f["e"],VTimeline:tn["a"],VTimelineItem:en["a"]});var Ua=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-card-action",[n("h2",{staticClass:"flex text--secondary"},[t._v("Set Nickname")]),n("v-form",{ref:"form",on:{submit:function(t){t.preventDefault()}},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[n("v-text-field",{attrs:{name:"nickname",label:"Nickname",type:"text",autofocus:"",rules:t.rules},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.changeNickname(e):null}},model:{value:t.nickname,callback:function(e){t.nickname=e},expression:"nickname"}})],1),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{color:"primary",loading:t.loading,disabled:!t.valid},on:{click:t.changeNickname}},[t._v("Set")])],1)],1)},Ra=[],Fa={name:"remote-login",props:["userData","toast"],data:function(){return{nickname:"",loading:!1,rules:[function(t){return!!t||"Required"}],valid:!1}},methods:{changeNickname:function(){var t=this;this.valid&&(this.loading=!0,A.fetchJSONWithSuccess(A.apiFor("user","set-nickname"),"POST",{nickname:this.nickname}).then(function(e){t.toast("Your nickname has changed!","success"),t.userData.nickname=t.nickname,A.updateLoginData(function(e){return Object(b["a"])({},e,{nickname:t.nickname})}),t.loading=!1}).catch(function(e){t.loading=!1,t.toast("Emmm... Something is strange","error")}))}}},Aa=Fa,Ia=(n("4a96"),Object(c["a"])(Aa,Ua,Ra,!1,null,"0e8eee63",null));Ia.options.__file="SetNickname.vue";var Ba=Ia.exports;u()(Ia,{VBtn:q["a"],VCardActions:gt["a"],VForm:$t["a"],VSpacer:Dt["a"],VTextField:Nt["a"]});var qa=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{attrs:{"align-center":"","justify-center":""}},[n("h4",[t._v("OAuth Accounts")]),n("v-spacer"),n("v-layout",{attrs:{row:"",wrap:""}},[n("v-card-actions",t._l(t.adapterList,function(e){var a=e.adapter;e.isBound,e.user;return n("v-btn",{key:a,attrs:{round:"",color:"accent",dark:""},on:{click:function(e){t.goToBind(a)}}},[t.$vuetify.icons.brand[a]?n("v-icon",[t._v(t._s(t.$vuetify.icons.brand[a]))]):n("span",[t._v(t._s(a))])],1)}),1)],1)],1)},Ma=[],Ja=n("db0c"),Wa=n.n(Ja),Ha={props:["userData","toast"],data:function(){return{adapters:[],myAdapters:[]}},methods:{getAdapters:function(){var t=this;A.fetchJSONWithSuccess(A.apiFor("login","oauth","adapters")).then(function(e){t.adapters=e}).catch(function(e){t.toast(e,"error")})},getMyAdapters:function(){var t=this;A.fetchJSONWithSuccess(A.apiFor("oauth","list-bind-adapters")).then(function(e){t.myAdapters=e}).catch(function(e){t.toast(e,"error")})},mergeAvailableAdapters:function(){var t=ct(this.adapters.map(function(t){return[t,{adapter:t,isBound:!1,bindUser:null}]}));return this.myAdapters.forEach(function(e){var n=e.adapter,a=e.user;t[n]&&(t[n]=Object(b["a"])({},t[n],{isBound:!0,bindUser:a}))}),Wa()(t)},goToBind:function(t){A.fetchJSONWithSuccess(A.apiFor("oauth","bind",t,"url")).then(function(t){location.href=t})}},computed:{adapterList:function(){return this.mergeAvailableAdapters()}},mounted:function(){this.getAdapters(),this.getMyAdapters(),this.$route.query.succeed&&(this.toast("Bind succeed: "+this.$route.query.succeed,"success"),this.$router.replace(Object(b["a"])({},this.$route,{query:Object(b["a"])({},this.$route.query,{succeed:void 0})})))}},Ya=Ha,za=Object(c["a"])(Ya,qa,Ma,!1,null,null,null);za.options.__file="OauthBind.vue";var Ga=za.exports;u()(za,{VBtn:q["a"],VCardActions:gt["a"],VIcon:kt["a"],VLayout:H["a"],VSpacer:Dt["a"]}),a["default"].use(m["a"]),a["default"].use(zn.a);var Xa=new m["a"]({mode:"history",base:C.urlPrefix,routes:[{path:"/hello",name:"HelloWorld",component:X},{path:"/",name:"index",component:Tt,meta:{title:C.title}},{path:"/login",name:"login",component:Bt,meta:{title:"Login"}},{path:"/post",name:"post",component:cn,children:[{path:":postLink",name:"postWithEternalLink",component:cn}]},{path:"/edit",alias:"/add",name:"edit",component:Pn},{path:"/userspace",alias:"/me",name:"userspace",component:Hn,meta:{title:"Console"},children:[{path:"change-password",name:"changePassword",component:ea},{path:"remote-login",name:"remoteLogin",component:ia},{path:"user-management",name:"userManagement",component:pa},{path:"token-refresh",name:"tokenRefresh",component:La},{path:"set-nickname",name:"setNickname",component:Ba},{path:"oauth-accounts",name:"oauthAccounts",component:Ga},{path:"/",name:"console-index",component:ya}]},{path:"/timeline",name:"timeline",component:Na,meta:{title:"Timeline"}},{path:"*",name:"notFound",alias:"/404",component:$n,meta:{title:"404 Not Found"}}]}),Za=n("fae4"),Ka=n.n(Za),Qa=n("bb71"),to=(n("da64"),n("25a2"));a["default"].use(Qa["a"],{theme:C.theme,customProperties:!0,iconfont:"md",lang:{locales:{zhHans:to["a"]},current:"zh-Hans"},icons:{brand:new Proxy({},{get:function(t,e){return Ka()(t,e)?he()(t,e):"string"===typeof e?"fab fa-".concat(e):void 0}})}}),a["default"].use(Me["a"]);var eo=new Me["a"].Store({state:{commentDraft:{}},mutations:{setCommentDraft:function(t,e){t.commentDraft=Object(b["a"])({},t.commentDraft,Object(et["a"])({},e.commentId,e.comment))},removeCommentDraft:function(t,e){t.commentDraft=Object(b["a"])({},t.commentDraft,Object(et["a"])({},e,void 0))}},actions:{},getters:{}}),no=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-snackbar",{attrs:{color:t.color,top:"",right:"",timeout:6e3},model:{value:t.showSelf,callback:function(e){t.showSelf=e},expression:"showSelf"}},[t._v("\n  "+t._s(t.text)+"\n  "),n("v-btn",{attrs:{flat:""},on:{click:function(e){t.showSelf=!1}}},[t._v("\n    Close\n  ")])],1)},ao=[],oo={name:"toast",props:["show","text","color"],computed:{showSelf:{get:function(){return this.show},set:function(t){this.$emit("showChange",t)}}}},ro=oo,so=(n("2984"),n("2db4")),io=Object(c["a"])(ro,no,ao,!1,null,"0095ef24",null);io.options.__file="toast.vue";var co=io.exports;u()(io,{VBtn:q["a"],VSnackbar:so["a"]});var lo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-footer",{attrs:{height:"auto",color:"primary lighten-1"}},[n("v-layout",{attrs:{"justify-center":"",row:"",wrap:""}},[n("v-flex",{attrs:{primary:"","lighten-2":"","py-3":"","text-xs-center":"","white--text":"",xs12:""}},[t._v("\n      ©"+t._s(t.year)+" — "),n("strong",[t._v("Somainer")])])],1)],1)},uo=[],ho={name:"blog-footer",data:function(){return{year:(new Date).getFullYear(),title:C.title,motto:C.motto}}},fo=ho,vo=(n("315b"),n("553a")),po=Object(c["a"])(fo,lo,uo,!1,null,"06001d0a",null);po.options.__file="BlogFooter.vue";var mo=po.exports;u()(po,{VFlex:W["a"],VFooter:vo["a"],VLayout:H["a"]});var go=n("26b9"),wo=n.n(go),bo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{directives:[{name:"scroll",rawName:"v-scroll",value:t.recordScroll,expression:"recordScroll"},{name:"resize",rawName:"v-resize",value:t.recordHeight,expression:"recordHeight"}]},[n("v-scale-transition",{attrs:{origin:"center center 0"}},[t.showButton?n("v-btn",{staticClass:"fixed-action-btn",style:{bottom:t.$vuetify.breakpoint.smOnly?"64px":""},attrs:{color:"secondary",fab:"",fixed:"",bottom:"",right:""},on:{click:t.goTop}},[n("v-icon",[t._v("keyboard_arrow_up")])],1):t._e()],1)],1)},ko=[],yo=n("9d93"),_o={name:"gotop-button",directives:yo["a"],data:function(){return{height:0,offsetTop:0}},methods:{recordHeight:function(){this.height=window.innerHeight},recordScroll:function(){this.offsetTop=window.pageYOffset||document.documentElement.scrollTop},goTop:function(){this.$vuetify.goTo(0)}},mounted:function(){this.recordHeight(),this.recordScroll()},computed:{showButton:function(){return this.offsetTop>=this.height}}},xo=_o,Do=(n("0353"),Object(c["a"])(xo,bo,ko,!1,null,"05127ca4",null));Do.options.__file="GotopButton.vue";var Co=Do.exports;u()(Do,{VBtn:q["a"],VIcon:kt["a"],VLayout:H["a"],VScaleTransition:f["d"]});n("15f5");var To=n("85fe");a["default"].prototype.config=C,a["default"].use(wo.a,{color:C.theme.secondary,failedColor:C.theme.error,thickness:"4px"}),a["default"].directive("observe-visibility",To["a"]),a["default"].component("toast",co),a["default"].component("nav-bar",mn),a["default"].component("blog-footer",mo),a["default"].component("go-top-btn",Co),a["default"].directive("focus",{update:function(t,e){var n=e.value;n&&t.focus()}}),a["default"].config.productionTip=!1;var Po=e["default"]=new a["default"]({router:Xa,store:eo,render:function(t){return t(p)}}).$mount("#black-shout")},d0f6:function(t,e,n){},d565:function(t,e,n){"use strict";var a=n("0a82"),o=n.n(a);o.a},d8c9:function(t,e,n){},ea98:function(t,e,n){"use strict";var a=n("4190"),o=n.n(a);o.a},efa2:function(t,e,n){},fe22:function(t,e,n){"use strict";var a=n("2738"),o=n.n(a);o.a},fffe:function(t,e,n){}});
//# sourceMappingURL=app.865167fd.js.map